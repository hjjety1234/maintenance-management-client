<?xml version="1.0" encoding="utf-8"?>
	<!--
		==
		============================================================================
		== | WonderTek [ 网络无处不在，沟通及时到达 ] ==
		============================================================================
		== | Copyright (c) 2012, WonderTek, Inc. All Rights Reserved. ==
		============================================================================
		== | Author: xxxx <xxxx@xxxx.com> ==
		============================================================================
		== | Desc: 页面描述 ==
		============================================================================
	-->
<root>
	<header />
	<body resolution="480,800" BuildChildrenFinished="bodyBuildChildrenFinished"
		OnSpriteEvent="bodyOnSpriteEvent" OnPluginEvent="bodyOnPluginEvent">
		<shadow rect="0,0,480,800" color="#e8e9ed" alpha="255"
			extendstyle="1111" />
		<node name="mainNode" rect="0,0,480,800" enable="true" active="true"
			OnKeyUp="mainNodeOnKeyUp" layouttype="1" extendstyle="1111">

			<node rect="0,0,480,66" extendstyle="1111">
				<image name="titleBg" rect="0,0,480,66" src="file://image/title_bg.png"
					extendstyle="1111" style="autosize" />
				<button name="backBtn" rect="0,10,75,45" normal="normal" sel="sel"
					OnSelect="doBack" extendstyle="1111">
					<image name="normal" rect="0,0,75,45" src="file://image/title_back_n.png"
						style="autosize" extendstyle="1111">
					</image>
					<image name="sel" rect="0,0,75,45" src="file://image/title_back_s.png"
						style="autosize" extendstyle="1111">
					</image>
					<label rect="15,0,60,45" text="返回" color="#ffffff"
						extendstyle="1111" style="autosize" h-align="center" v-align="center"
						font-size="24"></label>
				</button>

				<scrolltext name="title" rect="105,0,280,66" text="待办详情"
					extendstyle="1111" font-size="30" h-align="center" v-align="center"
					color="#ffffff" scroll="true"  step="2"></scrolltext>
				<button name="btnForget" rect="387,4,79,56" text="提交" color="#ffffff"
					extendstyle="1111" OnSelect="submitOnSelect"
					normal="src:file://image/btn_bg_n.png;style:sudoku-auto;sudoku:15,15,15,15;color:#ffffff"
					sel="src:file://image/btn_bg_s.png;style:sudoku-auto;sudoku:15,15,15,15;color:#000000"
					font-size="24" />
			</node>
			<node name="Codenode" rect="0,70,480,60" extendstyle="1111">
				<label name="label1" rect="0,0,150,60" border="false" text="工单编号："
					h-align="right" v-align="center" color="#000000" font-size="24"
					extendstyle="1111"></label>
				<label name="lblcode" v-align="center" h-align="left" rect="150,0,292,60" text="HFYDFGS20120800009" color="#000000" extendstyle="1111">
					
				</label>
			</node>
			<node name="titlenode" rect="0,120,480,60" extendstyle="1111">
				<label name="label1" rect="0,0,150,60" border="false" text="工单标题："
					h-align="right" v-align="center" color="#000000" font-size="24"
					extendstyle="1111"></label>
				<label name="lblcode" v-align="center" h-align="left" rect="150,0,292,60" text="护线宣传工单" color="#000000" extendstyle="1111">
					
				</label>
			</node>
			<node name="typenode" rect="0,180,480,60" extendstyle="1111">
				<label name="label1" rect="0,0,150,60" border="false" text="工单类型："
					h-align="right" v-align="center" color="#000000" font-size="24"
					extendstyle="1111"></label>
				<label name="lblcode" v-align="center" h-align="left" rect="150,0,292,60" text="护线宣传" color="#000000" extendstyle="1111">
					
				</label>
			</node>
			<node name="timenode" rect="0,240,480,60" extendstyle="1111">
				<label name="label1" rect="0,0,150,60" border="false" text="派发时间："
					h-align="right" v-align="center" color="#000000" font-size="24"
					extendstyle="1111"></label>
				<label name="lblcode" v-align="center" h-align="left" rect="150,0,292,60" text="2012-08-23 10:58:31" color="#000000" extendstyle="1111">
					
				</label>
			</node>
			<node name="contentnode" rect="0,300,480,60" extendstyle="1111">
				<label name="label1" rect="0,0,150,60" border="false" text="任务内容："
					h-align="right" v-align="center" color="#000000" font-size="24"
					extendstyle="1111"></label>
				
			</node>
			<node name="content" rect="10,360,460,120" extendstyle="1111">
				<image rect="0,0,460,120" src="file://image/input.png" style="sudoku-auto"
					extendstyle="1111" sudoku="15,15,15,15">
				</image>
				
					<label name="hideLabel" rect="10,10,360,120" text="2012护线宣传工作" color="#000000"
						extendstyle="1111" style="autosize" h-align="left" v-align="top"
						font-size="24"></label>
				
			</node>
			<node name="annexnode" rect="0,480,480,60" extendstyle="1111">
				<label name="label1" rect="0,0,150,60" border="false" text="附&nbsp;&nbsp;件："
					h-align="right" v-align="center" color="#000000" font-size="24"
					extendstyle="1111"></label>
				<label name="lblcode" v-align="center" h-align="center" rect="150,0,292,60" text="2012护线宣传工作要求.doc" color="#0000FF" extendstyle="1111">
					
				</label>
			</node>
			<node name="itemNode" rect="0,540,480,60" extendstyle="1111" >
				<label name="errorTitle" rect="0,0,150,60" border="false" text="签收结果："
					h-align="right" v-align="center" color="#000000" font-size="24"
					extendstyle="1111"></label>
				<button name="errorBtn" rect="150,0,160,52" border="false"
						text="button1" color="#ffffff" OnSelect="errorOnSelect"
						extendstyle="1111" data="01">
						<image rect="0,0,160,52" src="file://image/input.png" style="autosize"
							extendstyle="1111">
							<image rect="117,0,43,52" src="file://image/dropdown_arrow.png"
								style="autosize" extendstyle="1111" />
						</image>
						<label name="errorTypeName" rect="7,0,112,50" text="签收"
							color="#0" extendstyle="1111" style="autosize" h-align="center"
							v-align="center" font-size="24"></label>
					</button>
				
				
			</node>
       <node name="xunjianNode" rect="0,600,480,60" extendstyle="1111">
					<label name="label1" rect="0,0,150,60" border="false" text="&nbsp;巡检组："
						h-align="right" v-align="center" color="#000000" font-size="24"
						extendstyle="1111"></label>
					<button name="xunjianBtn" rect="150,0,292,52" border="false"
						text="button1" color="#ffffff" OnSelect="xunjianOnSelect"
						extendstyle="1111" data="01">
						<image rect="0,0,292,52" src="file://image/input.png" style="autosize"
							extendstyle="1111">
							<image rect="249,0,43,52" src="file://image/dropdown_arrow.png"
								style="autosize" extendstyle="1111" />
						</image>
						<label name="xunjianName" rect="7,0,212,52" text="请选择巡检组"
							color="#000000" extendstyle="1111" style="autosize" h-align="center"
							v-align="center" font-size="24"></label>
					</button>
					
				</node>
			<node name="chulicontent" rect="0,660,460,120" extendstyle="1111" visible="true" enable="true">
				<image rect="150,0,310,120" src="file://image/input.png" style="sudoku-auto"
					extendstyle="1111" sudoku="15,15,15,15">
				</image>
				<label name="label1" rect="0,0,150,60" border="false" text="说&nbsp;&nbsp;明："
					h-align="right" v-align="center" color="#000000" font-size="24"
					extendstyle="1111"></label>
					
					<edit name="edit" rect="160,10,300,120" border="false"
					extendstyle="1111">
					<label name="hideLabel" rect="0,0,300,120" text="" color="#c0c0c0"
						extendstyle="1111" style="autosize" h-align="left" v-align="top"
						font-size="24"></label>
				</edit>
				
			</node>
		  <node name="juqian" rect="0,540,480,240" extendstyle="1111" visible="false" enable="false">
				
				<node name="resultNode" rect="0,0,480,60" extendstyle="1111">
				<label name="errorTitle" rect="0,0,150,60" border="false" text="确认结果："
					h-align="right" v-align="center" color="#000000" font-size="24"
					extendstyle="1111"></label>
				<button name="resultBtn" rect="150,0,160,52" border="false"
						text="button1" color="#ffffff" OnSelect="resultOnSelect"
						extendstyle="1111" data="01">
						<image rect="0,0,160,52" src="file://image/input.png" style="autosize"
							extendstyle="1111">
							<image rect="117,0,43,52" src="file://image/dropdown_arrow.png"
								style="autosize" extendstyle="1111" />
						</image>
						<label name="resultTypeName" rect="7,0,112,50" text="通过"
							color="#0" extendstyle="1111" style="autosize" h-align="center"
							v-align="center" font-size="24"></label>
					</button>
				
				
			</node>
       <node name="xunjianNode" rect="0,600,480,60" extendstyle="1111">
					<label name="label1" rect="0,0,150,60" border="false" text="&nbsp;转审人"
						h-align="center" v-align="center" color="#000000" font-size="24"
						extendstyle="1111"></label>
					<button name="xunjianBtn" rect="150,0,292,52" border="false"
						text="button1" color="#ffffff" OnSelect="xunjianOnSelect"
						extendstyle="1111" data="01">
						<image rect="0,0,292,52" src="file://image/input.png" style="autosize"
							extendstyle="1111">
							<image rect="249,0,43,52" src="file://image/dropdown_arrow.png"
								style="autosize" extendstyle="1111" />
						</image>
						<label name="xunjianName" rect="7,0,212,52" text="请选择转审人"
							color="#000000" extendstyle="1111" style="autosize" h-align="center"
							v-align="center" font-size="24"></label>
					</button>
					
				</node>
			<node name="chulicontent" rect="0,660,460,120" extendstyle="1111">
				<image rect="150,0,310,120" src="file://image/input.png" style="sudoku-auto"
					extendstyle="1111" sudoku="15,15,15,15">
				</image>
				<label name="label1" rect="0,0,150,60" border="false" text="说&nbsp;&nbsp;明："
					h-align="right" v-align="center" color="#000000" font-size="24"
					extendstyle="1111"></label>
					
					<edit name="edit" rect="160,10,300,120" border="false"
					extendstyle="1111">
					<label name="hideLabel" rect="0,0,300,120" text="" color="#c0c0c0"
						extendstyle="1111" style="autosize" h-align="left" v-align="top"
						font-size="24"></label>
				</edit>
				
			</node>
			</node>
			<!--巡检组列表-->
			<node name="xunjianSelectNode" rect="0,0,480,800" visible="false"
				enable="false">
				<button name="button" rect="0,0,480,800" border="false" text=""
					color="#ffffff" OnSelect="hideXunjianSelected"></button>
				<image rect="70,170,340,250" src="file://image/input.png" style="sudoku-auto"
					extendstyle="1111" sudoku="15,15,15,15">
				</image>
				<button name="" rect="100,200,280,56" text="毫州巡检组" color="#ffffff"
					extendstyle="1111" OnSelect="xunjianGroupOnSelect"
					normal="src:file://image/btn_bg_n.png;style:sudoku-auto;sudoku:15,15,15,15;color:#ffffff"
					sel="src:file://image/btn_bg_s.png;style:sudoku-auto;sudoku:15,15,15,15;color:#000000"
					font-size="24" data="01" />
				<button name="" rect="100,270,280,56" text="芜湖巡检组" color="#ffffff"
					extendstyle="1111" OnSelect="xunjianGroupOnSelect"
					normal="src:file://image/btn_bg_n.png;style:sudoku-auto;sudoku:15,15,15,15;color:#ffffff"
					sel="src:file://image/btn_bg_s.png;style:sudoku-auto;sudoku:15,15,15,15;color:#000000"
					font-size="24" data="02" />
					<button name="" rect="100,340,280,56" text="安庆巡检组" color="#ffffff"
					extendstyle="1111" OnSelect="xunjianGroupOnSelect"
					normal="src:file://image/btn_bg_n.png;style:sudoku-auto;sudoku:15,15,15,15;color:#ffffff"
					sel="src:file://image/btn_bg_s.png;style:sudoku-auto;sudoku:15,15,15,15;color:#000000"
					font-size="24" data="03" />
			</node>
			<!--拒签处理列表-->
			<node name="resultSelectNode" rect="0,0,480,800" visible="false"
				enable="false">
				<button name="button" rect="0,0,480,800" border="false" text=""
					color="#ffffff" OnSelect="hideResultSelected"></button>
				<image rect="70,170,340,250" src="file://image/input.png" style="sudoku-auto"
					extendstyle="1111" sudoku="15,15,15,15">
				</image>
				<button name="" rect="100,200,280,56" text="通过" color="#ffffff"
					extendstyle="1111" OnSelect="resultGroupOnSelect"
					normal="src:file://image/btn_bg_n.png;style:sudoku-auto;sudoku:15,15,15,15;color:#ffffff"
					sel="src:file://image/btn_bg_s.png;style:sudoku-auto;sudoku:15,15,15,15;color:#000000"
					font-size="24" data="01" />
				<button name="" rect="100,270,280,56" text="不通过" color="#ffffff"
					extendstyle="1111" OnSelect="resultGroupOnSelect"
					normal="src:file://image/btn_bg_n.png;style:sudoku-auto;sudoku:15,15,15,15;color:#ffffff"
					sel="src:file://image/btn_bg_s.png;style:sudoku-auto;sudoku:15,15,15,15;color:#000000"
					font-size="24" data="02" />
					<button name="" rect="100,340,280,56" text="转审" color="#ffffff"
					extendstyle="1111" OnSelect="resultGroupOnSelect"
					normal="src:file://image/btn_bg_n.png;style:sudoku-auto;sudoku:15,15,15,15;color:#ffffff"
					sel="src:file://image/btn_bg_s.png;style:sudoku-auto;sudoku:15,15,15,15;color:#000000"
					font-size="24" data="03" />
			</node>
      <node name="errorTypeSelectNode" rect="0,0,480,800" visible="false"
				enable="false">
				<button name="button" rect="0,0,480,800" border="false" text=""
					color="#ffffff" OnSelect="hideErrorSelected"></button>
				<image rect="70,270,340,180" src="file://image/input.png" style="sudoku-auto"
					extendstyle="1111" sudoku="15,15,15,15">
				</image>
				<button name="" rect="100,300,280,56" text="签收" color="#ffffff"
					extendstyle="1111" OnSelect="errorTypeOnSelect"
					normal="src:file://image/btn_bg_n.png;style:sudoku-auto;sudoku:15,15,15,15;color:#ffffff"
					sel="src:file://image/btn_bg_s.png;style:sudoku-auto;sudoku:15,15,15,15;color:#000000"
					font-size="24" data="01" />
				<button name="" rect="100,370,280,56" text="拒签" color="#ffffff"
					extendstyle="1111" OnSelect="errorTypeOnSelect"
					normal="src:file://image/btn_bg_n.png;style:sudoku-auto;sudoku:15,15,15,15;color:#ffffff"
					sel="src:file://image/btn_bg_s.png;style:sudoku-auto;sudoku:15,15,15,15;color:#000000"
					font-size="24" data="02" />
			</node>
		</node>
	</body>
    <![CDATA[

    require 'com_wondertek_dw.common.framework'
    local rootSprite
    local errorListTotalHeight = 0
    local curErrorBtn
    local curXunjianBtn
    local curresult
    regHandle=Reg:create('daiban')
    local tempid= Reg:getString(regHandle,'id') 
    Log:write('tempid===', tempid)

    ---------------------------------------callbacks--------------------------------
    -- @brief root子节点创建完事件
    function bodyBuildChildrenFinished(sprite)
        rootSprite = sprite
       --@ local xunjianNode = Sprite:findChild(rootSprite, 'xunjianNode')
        --@setAllShoworHide(xunjianNode, 1)
    end
    -- @brief root节点消息方法
    function bodyOnSpriteEvent(msg, param)
        if msg == MSG_ACTIVATE then -- 页面激活
            elseif msg == MSG_DEACTIVATE then
        end
    end
    -- @brief 插件消息方法
    function bodyOnPluginEvent(msg)
        if msg == 101 then
            elseif msg == 101 + MSG_CACHEDATA_RELOAD then -- 101请求的数据有更新
            elseif msg == MSG_NETWORK_ERROR then -- 拨号失败
            Log:write('拨号失败')
            elseif msg > MSG_NETWORK_ERROR then -- 请求超时
            Log:write('请求超时')
        end
    end
    -- @brief 按键响应处理
    function mainNodeOnKeyUp(sprite, kc)
        if kc == Key.F2 then -- 按下返回键
            Scene:back()
            return 1
        end
    end
    ---------------------------------------util functions---------------------------
     function errorOnSelect(sprite)
        local btnData = Sprite:getData(sprite)
        curErrorBtn = sprite
        setAllShoworHide(Sprite:findChild(rootSprite, 'errorTypeSelectNode'), 1)
    end
    function xunjianOnSelect(sprite)
        --@Log:write('tempid===', tempid)
        local xunjianData = Sprite:getData(sprite)
        curXunjianBtn = sprite
         --@Log:write('tempid===', tempid)
        setAllShoworHide(Sprite:findChild(rootSprite, 'xunjianSelectNode'), 1)
    end
    --@拒签签收 确认结果下拉列表触发
    function resultOnSelect(sprite)
        curresult=sprite
        setAllShoworHide(Sprite:findChild(rootSprite, 'resultSelectNode'), 1)
    end
    function errorTypeOnSelect(sprite)
        local btnData = Sprite:getData(sprite)
        local errorText = Sprite:findChild(curErrorBtn, 'errorTypeName')
        Sprite:setProperty(curErrorBtn, 'data', btnData)
        if btnData == '01' then
            --签收
            Sprite:setProperty(errorText, 'text', '签收')
            setAllShoworHide(Sprite:findChild(rootSprite, 'xunjianNode'), 1)
            Sprite:setRect(Sprite:findChild(rootSprite, 'chulicontent'), 0, 660, 460, 120) 
            elseif btnData == '02' then
            --拒签
            Sprite:setProperty(errorText, 'text', '拒签')
             setAllShoworHide(Sprite:findChild(rootSprite, 'xunjianNode'), 0)
             Sprite:setRect(Sprite:findChild(rootSprite, 'chulicontent'), 0, 600, 460, 120) 
        end
        --@doChangeListHeight(curErrorBtn)
        setAllShoworHide(Sprite:findChild(rootSprite, 'errorTypeSelectNode'), 0)
    end
    function xunjianGroupOnSelect(sprite)
        local xunjianData = Sprite:getData(sprite)
        local xunjianText = Sprite:findChild(curXunjianBtn, 'xunjianName')
        Sprite:setProperty(curXunjianBtn, 'data', xunjianData)
        if xunjianData == '01' then    
            Sprite:setProperty(xunjianText, 'text', '毫州巡检组')
            elseif xunjianData == '02' then
            
            Sprite:setProperty(xunjianText, 'text', '芜湖巡检组')
            elseif xunjianData == '03' then
            
            Sprite:setProperty(xunjianText, 'text', '安庆巡检组')
             
        end
        --@doChangeListHeight(curXunjianBtn)
        setAllShoworHide(Sprite:findChild(rootSprite, 'xunjianSelectNode'), 0)
    end
    function hideErrorSelected(sprite)
        setAllShoworHide(Sprite:findChild(rootSprite, 'errorTypeSelectNode'), 0)
    end
   function hideXunjianSelected(sprite)
        setAllShoworHide(Sprite:findChild(rootSprite, 'xunjianSelectNode'), 0)
    end
    function submitOnSelect(sprite)	  
      Dialog:show('工单处理提示：','是否确定提交此工单？','ok_cancel','okCallback','cancelCallback')
     end
     function okCallback()
           Scene:setReturn(Alias.home, Alias.daibangongdan)
           Scene:go(Alias.daibangongdan)
     end
     function cancelCallback()
           if Dialog:isShow() then
           Dialog:close() 
           end
     end
    function doBack()
       Dialog:show('工单处理提示：','是否暂存此工单？','ok_cancel','okZancun','cancelZancun')
       
    end
    function okZancun()
       Loading:show()
       local taskidnode= Sprite:findChild(rootSprite, 'Codenode')
       local taskid=Sprite:getText(Sprite:findChild(taskidnode, 'lblcode')) 
       local titlenode= Sprite:findChild(rootSprite, 'titlenode')
       local titlename=Sprite:getText(Sprite:findChild(titlenode, 'lblcode')) 
       local timenode= Sprite:findChild(rootSprite, 'timenode')
       local datetime=Sprite:getText(Sprite:findChild(timenode, 'lblcode')) 
       Config:set('daiban', taskid)
       Config:set('title', titlename)
       Config:set('shijian', datetime)
       Log:write('taskid===', taskid)
       Log:write('titlename===', titlename)
       Log:write('datetime===', datetime)
       Loading:close()
       Scene:back()
        
    end
    function cancelZancun()
      Scene:back()
    end
    
]]>
</root>
