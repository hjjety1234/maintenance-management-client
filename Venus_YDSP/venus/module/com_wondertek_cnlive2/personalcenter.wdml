<?xml version="1.0" encoding="utf-8"?>
<!--
 == ============================================================================
 == | WonderTek [ 网络无处不在，沟通及时到达 ]
 == ============================================================================
 == | Copyright (c) 2012, WonderTek, Inc. All Rights Reserved.
 == ============================================================================
 == | Author: yaoxiangyin <yaoxiangyin@wdit.com.cn>
 == ============================================================================
 == | Desc: 个人中心页
 == ============================================================================
-->
<root>
    <header/>
    <body resolution="640,960" BuildChildrenFinished="bodyBuildChildrenFinished" OnSpriteEvent="bodyOnSpriteEvent" OnPluginEvent="bodyOnPluginEvent">
        <node name="mainNode" rect="0,0,640,960" enable="true" active="true" OnKeyUp="mainNodeOnKeyUp" layouttype="1" extendstyle="1111">
            <image rect="0,0,640,960" extendstyle="1111" style="autosize" src="file://image/background_nofont.png" />
            <image rect="0,0,640,70" style="tile" src="file://image/top_bg.png" extendstyle="1111" />
            <button name="topReturnButton" sel="sel" normal="normal" rect="0,0,130,70" extendstyle="1111" OnSelect="returnOnSelect" >
                <image name="normal" rect="23,10,84,50" extendstyle="1111" style="autosize" src="file://image/goback_bg.png" />
                <image name="sel" rect="23,10,84,50" extendstyle="1111" style="autosize" src="file://image/goback_bg_f.png" />
                <label rect="33,10,79,50" extendstyle="1111" text="返回" h-align="center" v-align="center" color="#ffffff" font-size="24" font-style="bold" />
            </button>
            <label name="totaltitle" rect="100,0,440,70" text="个人中心" color="#a40c0c" v-align="center" h-align="center" font-size="30" font-style="bold" extendstyle="1111" />
            <listview name='bigListview' rect="0,70,640,920" extendstyle="1111">
            	<list-item rect="0,0,640,920">
            		<node name="area0" rect="0,-70,640,920">
		                <image rect="18,110,604,368" extendstyle="1111" style="sudoku-auto" sudoku="15,15,15,15" src="file://image/person_item_bg.png" />
		                <image rect="18,518,604,92" extendstyle="1111" style="sudoku-auto" sudoku="15,15,15,15" src="file://image/person_item_bg.png" />
		                <image rect="18,650,604,184" extendstyle="1111" style="sudoku-auto" sudoku="15,15,15,15" src="file://image/person_item_bg.png" />
		                <list rect="18,110,604,368" line="4" col="1" extendstyle="1111" auto-adjust="true" >
		                    <list-item rect="18,40,604,92" extendstyle="1111" >
		                        <button rect="0,0,604,92" extendstyle="1111" sel="sel" normal="normal" OnSelect="$(fun)" >
		                            <node name="normal" rect="0,0,604,92">
		                                <label name="aaa" rect="24,0,580,92" extendstyle="1111" font-size="24" v-align="center" text="$(txt)" />
		                            </node>
		                            <node name="sel" rect="0,0,604,92">
		                            	<image rect="0,0,604,92" extendstyle="1111" style="autosize" alpha="200" src="file://image/person_item_bg2.png"/>
		                            	<label rect="24,0,580,92" extendstyle="1111" color="#ffffff" font-style="bold" font-size="24" v-align="center" text="$(txt)" />
		                            </node>
		                            <image rect="570,32,19,28" extendstyle="1111" style="autosize" src="file://image/person_item_arrow.png" />
		                        </button>
		                        <image rect="0,90,600,2" extendstyle="1114" visible="$(visible)" style="autosize" src="file://image/person_item_line.png" />
		                    </list-item>
		                    <dataset>
		                        <set txt="我的帐户" visible="1" fun="myAccountOnSelect" />
		                        <set txt="播放记录" visible="1" fun="showPlayRecord" />
		                        <set txt="我的预约" visible="1" fun="showMyBooking" />
		                        <set txt="我的评论" visible="0" fun="showMyComment" />
		                    </dataset>
		                </list>
		                <list rect="18,518,604,92" line="1" col="1" extendstyle="1111" auto-adjust="true" >
		                    <list-item rect="18,40,604,92" extendstyle="1111" >
		                        <button rect="0,0,604,92" extendstyle="1111" sel="sel" normal="normal" OnSelect="$(fun)" >	                         
		                            <node name="normal" rect="0,0,604,92">
		                                <label name="normal" rect="24,0,580,92" extendstyle="1111" font-size="24" v-align="center" text="$(txt)" />
		                            </node>
		                            <node name="sel" rect="0,0,580,92">
		                            	<image rect="0,0,605,92" extendstyle="1111" style="autosize" alpha="200" src="file://image/person_item_bg2.png"/>
		                            	<label rect="24,0,580,92" extendstyle="1111" color="#ffffff" font-style="bold" font-size="24" v-align="center" text="$(txt)" />		                        	
		                            </node>
		                            <image rect="560,32,19,28" extendstyle="1111" style="autosize" src="file://image/person_item_arrow.png" />
		                        </button>
		                    </list-item>
		                    <dataset>
		                        <set txt="皮肤设置" fun="setMySkin" />
		                    </dataset>
		                </list>
		                <list rect="18,650,604,184" line="2" col="1" extendstyle="1111" auto-adjust="true" >
		                    <list-item rect="18,40,604,92" extendstyle="1111" >
		                        <button rect="0,0,604,92" extendstyle="1111" sel="sel" normal="normal" OnSelect="$(fun)" >		                            
		                            <node name="normal" rect="0,0,604,92">
		                                <label name="normal" rect="24,0,580,92" extendstyle="1111" font-size="24" v-align="center" text="$(txt)" />
		                            </node>
		                            <node name="sel" rect="0,0,580,92">
		                            	<image rect="0,0,605,92" extendstyle="1111" style="autosize" alpha="200" src="file://image/person_item_bg2.png"/>
		                            	<label rect="24,0,580,92" extendstyle="1111" color="#ffffff" font-style="bold" font-size="24" v-align="center" text="$(txt)" />		                      	
		                            </node>
		                            <image rect="560,32,19,28" extendstyle="1111" style="autosize" src="file://image/person_item_arrow.png" />
		                        </button>
		                        <image rect="0,90,600,2" extendstyle="1114" visible="$(visible)" style="autosize" src="file://image/person_item_line.png" />
		                    </list-item>
		                    <dataset>
		                        <set txt="帮助" visible="1" fun="helpBtnOnSelect" />
		                        <set txt="关于" visible="0" fun="aboutBtnOnSelect" />
		                    </dataset>
		                </list>
		            </node>
            	</list-item>
            </listview>
            <node name="area1" visible="false" enable="false" >
                <node name="topStatusBar" >
                    <image rect="0,0,640,70" style="tile" src="file://image/top_bg.png" extendstyle="1111" />
                    <button name="topBarRetBtn" sel="sel" normal="normal" rect="0,0,130,70" extendstyle="1111" OnSelect="topBarRetBtnOnSelect" >
                        <image name="normal" rect="23,10,84,50" extendstyle="1111" style="autosize" src="file://image/goback_bg.png" />
                        <image name="sel" rect="23,10,84,50" extendstyle="1111" style="autosize" src="file://image/goback_bg_f.png" />
                        <label rect="33,10,79,50" extendstyle="1111" text="返回" h-align="center" v-align="center" color="#ffffff" font-size="24" font-style="bold" />
                    </button>
                    <button name="topBarCanBtn" sel="sel" normal="normal" visible="0" enable="0" rect="0,0,130,70" extendstyle="1111" OnSelect="topBarCanBtnOnSelect" >
                        <image name="normal" rect="23,10,84,50" extendstyle="1111" style="autosize" src="file://image/goback_bg.png" />
                        <image name="sel" rect="23,10,84,50" extendstyle="1111" style="autosize" src="file://image/goback_bg_f.png" />
                        <label rect="33,10,79,50" extendstyle="1111" text="取消" h-align="center" v-align="center" color="#ffffff" font-size="24" />
                    </button>
                    <label name="topBartitle" rect="100,0,440,70" color="#a40c0c" v-align="center" h-align="center" font-size="30" font-style="bold" extendstyle="1111" />
                    <button name="topBarEdtBtn" normal="normal" sel="sel" visible="1" enable="1" rect="515,8,106,53" extendstyle="1111" OnSelect="topBarEdtBtnOnSelect" >
                        <image rect="0,0,106,53" name="normal" extendstyle="1111" style="autosize" src="file://image/panel_button_n.png" />
                        <image rect="0,0,106,53" name="sel" extendstyle="1111" style="autosize" src="file://image/panel_button_f.png" />
                        <label rect="0,0,106,53" text="编辑" color="#ffffff" v-align="center" h-align="center" font-size="24" extendstyle="1111" />
                    </button>
                    <button name="topBarFinBtn" normal="normal" sel="sel" visible="0" enable="0" rect="515,8,106,53" extendstyle="1111" OnSelect="topBarFinBtnOnSelect" >
                        <image rect="0,0,106,53" name="normal" extendstyle="1111" style="autosize" src="file://image/panel_button_n.png" />
                        <image rect="0,0,106,53" name="sel" extendstyle="1111" style="autosize" src="file://image/panel_button_f.png" />
                        <label  rect="0,0,106,53" text="完成" color="#ffffff" v-align="center" h-align="center" font-size="24" extendstyle="1111" />
                    </button>
                    <button name="topBarPsdBtn" normal="normal" sel="sel" rect="515,8,106,53" extendstyle="1111" OnSelect="findPassWordBtnOnSelect" >
                        <image rect="0,0,106,53" name="normal" extendstyle="1111" style="autosize" src="file://image/panel_button_n.png" />
                        <image rect="0,0,106,53" name="sel" extendstyle="1111" style="autosize" src="file://image/panel_button_f.png" />
                        <label rect="0,0,106,53" text="找密码" color="#ffffff" extendstyle="1111" font-size="24" v-align="center" h-align="center" />
                    </button>
                </node>
                <listview name="contentListview" rect="0,70,640,890" extendstyle="1111" limit="true" />
                <node name="accountLoginNode" rect="0,0,640,890" extendstyle="1111" visible="false" enable="false" >
                    <label rect="50,40,110,60" extendstyle="1111" font-size="30" v-align="center" h-align="center" text="帐户:" />               
                    <image rect="160,40,420,62" extendstyle="1111" style="autosize" src="file://image/panel_edit.png" />
                    <label name="chatTips1" rect="180,60,300,54" extendstyle="1111" text="手机号或邮箱" color="#777777" font-size="22" />
                    <edit name="accountInput" rect="180,50,380,40" extendstyle="1111" text="" color="#777777" font-size="30" OnTextChanged="chatDetailOnTextChanged1" OnKeyboardSizeChanged="chatOnKeyboardSizeChanged1"/>
                    
                    <label rect="50,130,110,60" extendstyle="1111" font-size="30" v-align="center" h-align="center" text="密码:" />
                    <image rect="160,130,420,62" extendstyle="1111" style="autosize" src="file://image/panel_edit.png" />
                    <label name="chatTips2" rect="180,150,300,54" extendstyle="1111" text="请输入密码" color="#777777" font-size="22" />
                    <edit name="passwordInput" rect="180,140,380,40" text="" max-size="18" extendstyle="1111" color="#777777" font-size="30" password="true" OnTextChanged="chatDetailOnTextChanged2" OnKeyboardSizeChanged="chatOnKeyboardSizeChanged2"/>
                    <node name="unBindNode" visible="1" enable="1">
		                    <button normal="normal" sel="sel" rect="160,230,156,56" extendstyle="1111" OnSelect="loginBtnOnSelect" >
		                        <image name="normal" rect="0,0,156,56" extendstyle="1111" style="autosize" src="file://image/account_log_btn_n.png" />
		                        <image name="sel" rect="0,0,156,56" extendstyle="1111" style="autosize" src="file://image/account_log_btn_f.png" />
		                        <label rect="0,0,156,56" extendstyle="1111" font-size="24" color="#ffffff" v-align="center" h-align="center" text="登录" />
		                    </button>
		                    <button normal="normal" sel="sel" rect="340,230,156,56" extendstyle="1111" OnSelect="registerNewAccentOnSelect" >
		                        <image name="normal" rect="0,0,156,56" extendstyle="1111" style="autosize" src="file://image/account_log_btn_n.png" />
		                        <image name="sel" rect="0,0,156,56" extendstyle="1111" style="autosize" src="file://image/account_log_btn_f.png" />
		                        <label rect="0,0,156,56" extendstyle="1111" font-size="24" color="#ffffff" v-align="center" h-align="center" text="注册新帐号" />
		                    </button>
		                    <shadow rect="0,340,640,2" extendstyle="1114" color="#000000"/>
		                    <label rect="60,380,500,30" extendstyle="1111" font-size="22" v-align="center" text="使用合作帐号登录" />
		                    <list name="cooperatorList" rect="100,480,480,80" extendstyle="1111" line="1" col="4" auto-adjust="true" offset="25,0" />
		                    <node name="cooperatorItem" rect="0,0,80,80" extendstyle="1111" visible="false" enable="false" >
		                        <button  rect="0,0,80,80" extendstyle="1111" OnSelect="loginBycooperator" >
		                            <image name="pic" rect="0,0,80,80" extendstyle="1111" style="autosize" />
		                        </button>
		                    </node>
		                </node>
		                <node name="bindNode" visible="0" enable="0">
		                    <button normal="normal" sel="sel" rect="160,230,156,56" extendstyle="1111" OnSelect="panelUserBindOnSelect" >
		                        <image name="normal" rect="0,0,156,56" extendstyle="1111" style="autosize" src="file://image/account_log_btn_n.png" />
		                        <image name="sel" rect="0,0,156,56" extendstyle="1111" style="autosize" src="file://image/account_log_btn_f.png" />
		                        <label rect="0,0,156,56" extendstyle="1111" font-size="24" color="#ffffff" v-align="center" h-align="center" text="绑定" />
		                    </button>
		                </node>
                </node>
                <node name="accountLoginImfoNode" rect="0,0,640,890" extendstyle="1111" visible="false" enable="false" >
                    <label name="userNameLabel" rect="50,40,580,60" extendstyle="1111" font-size="30" v-align="center" text="帐户:" />
                    <label rect="50,130,100,60" extendstyle="1111" font-size="30" v-align="center" text="昵  称:" />
                    <scrolltext name="nickname" rect="170,130,450,60" step="2" scroll="true" extendstyle="1111" font-size="30" v-align="center" text="昵称:"/>
                    <button normal="normal" sel="sel" rect="130,230,156,56" extendstyle="1111" OnSelect="loginOffBtnOnSelect" >
                        <image name="normal" rect="0,0,156,56" extendstyle="1111" style="autosize" src="file://image/account_log_btn_n.png" />
                        <image name="sel" rect="0,0,156,56" extendstyle="1111" style="autosize" src="file://image/account_log_btn_f.png" />
                        <label rect="0,0,156,56" extendstyle="1111" font-size="24" color="#ffffff" v-align="center" h-align="center" text="登出" />
                    </button>
                    <button normal="normal" sel="sel" rect="370,230,156,56" extendstyle="1111" OnSelect="userInfoManaBtnOnSelect" >
                        <image name="normal" rect="0,0,156,56" extendstyle="1111" style="autosize" src="file://image/account_log_btn_n.png" />
                        <image name="sel" rect="0,0,156,56" extendstyle="1111" style="autosize" src="file://image/account_log_btn_f.png" />
                        <label rect="0,0,156,56" extendstyle="1111" font-size="24" color="#ffffff" v-align="center" h-align="center" text="帐户管理" />
                    </button>
                </node>
                <node name="accountRegisterNode" rect="0,0,640,890" extendstyle="1111" visible="false" enable="false" >
                    <label rect="50,40,110,60" extendstyle="1111" font-size="26" v-align="center" h-align="center" text="帐户:" />
                    <image rect="160,40,420,62" extendstyle="1111" style="autosize" src="file://image/panel_edit.png" />
                    <label name="chatTips3" rect="180,60,300,54" extendstyle="1111" text="手机号或邮箱" color="#777777" font-size="22" />
                    <edit name="accountInput" rect="180,50,380,40" extendstyle="1111" color="#777777" font-size="30" OnTextChanged="chatDetailOnTextChanged3" OnKeyboardSizeChanged="chatOnKeyboardSizeChanged3"/>
                    
                    <label rect="50,130,110,60" extendstyle="1111" font-size="26" v-align="center" h-align="center" text="密码:" />
                    <image rect="160,130,420,62" extendstyle="1111" style="autosize" src="file://image/panel_edit.png" password="true" />
                    <label name="chatTips4" rect="180,150,300,54" extendstyle="1111" text="6-18个字符" color="#777777" font-size="22" />
                    <edit name="passwordInput" rect="180,140,380,40" max-size="18" extendstyle="1111" color="#777777" font-size="30" password="true" OnTextChanged="chatDetailOnTextChanged4" OnKeyboardSizeChanged="chatOnKeyboardSizeChanged4"/>
                    
                    <label rect="20,220,140,60" extendstyle="1111" font-size="26" v-align="center" h-align="center" text="确认密码:" />
                    <image rect="160,220,420,62" extendstyle="1111" style="autosize" src="file://image/panel_edit.png" password="true" />
                    <label name="chatTips5" rect="180,240,300,54" extendstyle="1111" text="请再次输入密码" color="#777777" font-size="22" />
                    <edit name="passwordInput2" rect="180,230,380,40" max-size="18" extendstyle="1111" color="#777777" font-size="30" password="true" OnTextChanged="chatDetailOnTextChanged5" OnKeyboardSizeChanged="chatOnKeyboardSizeChanged5"/>
                    
                    <button normal="normal" sel="sel" rect="160,310,156,56" extendstyle="1111" OnSelect="registerBtnOnSelect" >
                        <image name="normal" rect="0,0,156,56" extendstyle="1111" style="autosize" src="file://image/account_log_btn_n.png" />
                        <image name="sel" rect="0,0,156,56" extendstyle="1111" style="autosize" src="file://image/account_log_btn_f.png" />
                        <label rect="0,0,156,56" extendstyle="1111" font-size="24" color="#ffffff" v-align="center" h-align="center" text="注册" />
                    </button>
                </node>
                <!--<node name="accountFindPasswordNode" rect="0,0,640,890" extendstyle="1111" visible="false" enable="false" >
                    <label rect="50,40,110,60" extendstyle="1111" font-size="30" v-align="center" h-align="center" text="帐户:" />
                    <image rect="160,40,420,62" extendstyle="1111" style="autosize" src="file://image/panel_edit.png" />
                    <edit name="accountInput" rect="180,50,380,40" extendstyle="1111" color="#777777" font-size="30" />
                    <button normal="normal" sel="sel" rect="160,130,156,56" extendstyle="1111" OnSelect="submitAccount" >
                        <image name="normal" rect="0,0,156,56" extendstyle="1111" style="autosize" src="file://image/account_log_btn_n.png" />
                        <image name="sel" rect="0,0,156,56" extendstyle="1111" style="autosize" src="file://image/account_log_btn_f.png" />
                        <label rect="0,0,156,56" extendstyle="1111" font-size="24" color="#ffffff" v-align="center" h-align="center" text="提交" />
                     </button>
                </node>-->
                <node name="accountFindPasswordNode" rect="0,0,640,890" extendstyle="1111" visible="false" enable="false" >
                	<label rect="30,40,140,70" extendstyle="1111" font-size="30" v-align="center" h-align="left" text="方式一：" />
                	<label rect="30,110,150,70" extendstyle="1111" font-size="30" v-align="top" h-align="left" text="手机号码：" />
                	<textarea rect="180,110,450,150" extendstyle="1111" autoextend="true" font-size="30" v-align="top" h-align="left" text="用户用已注册手机号码编辑短信“视频中国#1”发送至“12114”，找回密码。" />
                    <label rect="30,200,140,70" extendstyle="1111" font-size="30" v-align="center" h-align="left" text="方式二：" />
                    <label rect="30,270,150,60" extendstyle="1111" font-size="30" v-align="center" h-align="left" text="邮箱：" />
                    <image rect="180,270,420,62" extendstyle="1111" style="autosize" src="file://image/panel_edit.png" />
                    <label name="findPassWordOnSelecttips" rect="190,270,420,62" extendstyle="1111" color="" font-size="30" v-align="center" h-align="left" text="输入邮箱地址" />
                    <edit name="accountInput" rect="190,280,380,40" extendstyle="1111" color="#777777" font-size="30" OnKeyboardSizeChanged="zhaomimachatOnKeyboardSizeChanged" OnTextChanged="zhaomimaeditOnTextChanged"/>
                    <button normal="normal" sel="sel" rect="180,380,156,56" extendstyle="1111" OnSelect="submitAccount" >
                        <image name="normal" rect="0,0,156,56" extendstyle="1111" style="autosize" src="file://image/account_log_btn_n.png" />
                        <image name="sel" rect="0,0,156,56" extendstyle="1111" style="autosize" src="file://image/account_log_btn_f.png" />
                        <label rect="0,0,156,56" extendstyle="1111" font-size="24" color="#ffffff" v-align="center" h-align="center" text="提交" />
                    </button>
                </node>
                <node name="accountFindResultNode" rect="0,0,640,890" extendstyle="1111" visible="false" enable="false" >
                    <scrolltext scroll="true" step="1" rect="50,40,540,30" extendstyle="1111" font-size="28" v-align="center" h-align="center" text="新密码已发送到您的手机或邮箱，请查收。" />
                </node>
                <node name="accountAuthorityNode" rect="0,0,640,890" extendstyle="1111" visible="false" enable="false" >
                    <label rect="50,40,50,40" extendstyle="1111" font-size="24" v-align="center" text="授权" />
                    <label rect="110,40,220,40" extendstyle="1111" font-size="24" v-align="center" color="#B32D2B" text="视频中国 互动电视" />
                    <label rect="330,40,250,40" extendstyle="1111" font-size="24" v-align="center" text="访问你的微博帐号" />
                    <textarea rect="50,130,540,0" extendstyle="1111" line-height="45" font-size="24" autoextend="true" text="获得你的个人信息，好友关系\n分享内容到你的微博\n获得你的评论" />
                    <image rect="283,300,74,39" extendstyle="1111" style="autosize" src="file://image/panel_arrow_down.png" />
                    <image rect="254,360,132,132" extendstyle="1111" style="autosize" src="file://image/panel_logo.png" />
                    <label rect="50,520,110,60" extendstyle="1111" font-size="30" v-align="center" h-align="center" text="帐户:" />
                    <image rect="160,520,420,62" extendstyle="1111" style="autosize" src="file://image/panel_edit.png" />
                    <edit name="accountInput" rect="180,530,380,40" extendstyle="1111" color="#777777" font-size="30" />
                    <label rect="50,620,110,60" extendstyle="1111" font-size="30" v-align="center" h-align="center" text="密码:" />
                    <image rect="160,620,420,62" extendstyle="1111" style="autosize" src="file://image/panel_edit.png" />
                    <edit name="passwordInput" rect="180,630,380,40" extendstyle="1111" color="#777777" font-size="30" password="true" />
                    <button sel="sel" normal="normal" rect="160,720,156,56" extendstyle="1111" >
                        <image name="normal" rect="0,0,156,56" extendstyle="1111" style="autosize" src="file://image/account_log_btn_n.png" />
                        <image name="sel" rect="0,0,156,56" extendstyle="1111" style="autosize" src="file://image/account_log_btn_f.png" />
                        <label rect="0,0,156,56" extendstyle="1111" font-size="24" color="#ffffff" v-align="center" h-align="center" text="授权" />
                    </button>
                </node>
                <node name="Accountauthoritynode1" rect="0,0,640,890" extendstyle="1111" visible="false" enable="false" >
                </node>
                <node name="playRecordItem" rect="0,0,640,110" extendstyle="1111" visible="false" enable="false" >
                    <node name="normalStatus" >
                        <label name="recordName" rect="30,25,480,40" text="" postfix="..." extendstyle="1111" font-size="26" v-align="top" />
                        <label name="recordPoint" rect="30,65,480,30" text="" postfix="..." extendstyle="1111" font-size="22" v-align="top" />
                        <image rect="0,100,640,2" extendstyle="1111" style="tile" src="file://image/detail_greyline.png"/>
                        <button name="panelPlayBtn" normal="normal" sel="sel" rect="485,28,136,53" extendstyle="1111" OnSelect="panelPlayBtnOnSelect">
                            <image name="sel" rect="0,0,136,53" extendstyle="1111" style="autosize" src="file://image/panel_button_f.png" />
                            <image name="normal" rect="0,0,136,53" extendstyle="1111" style="autosize" src="file://image/panel_button_n.png" />
                            <label name="historyStatus" rect="0,0,136,53" text="" color="#ffffff" extendstyle="1111" font-size="24" v-align="center" h-align="center" />
                        </button>
                    </node>
                    <node name="editStatus" visible="false" enable="false" >
                        <button name="editIco" rect="30,26,58,58" data="0" extendstyle="1111" OnSelect="showOrHideDelBtn" >
                           <image rect="0,0,58,58" extendstyle="1111" style="autosize" src="file://image/panel_edit_off.png" />
                        </button>
                        <label name="recordName" rect="130,25,380,40" text="" postfix="..." extendstyle="1111" font-size="26" v-align="top" />
                        <label name="recordPoint" rect="130,65,380,30" text="" postfix="..." extendstyle="1111" font-size="22" v-align="top" />
                        <image rect="0,100,640,2" extendstyle="1111" style="tile" src="file://image/detail_greyline.png"/>
                        <button name="panelDeleteBtn" normal="normal" sel="sel" rect="515,28,106,53" extendstyle="1111" visible="false" enable="false" OnSelect="deleteHistoryBtnOnSelect" >
                            <image name="sel" rect="0,0,106,53" extendstyle="1111" style="autosize" src="file://image/panel_button_f.png" />
                            <image name="normal" rect="0,0,106,53" extendstyle="1111" style="autosize" src="file://image/panel_button_n.png" />
                            <label rect="0,0,106,53" text="删除" color="#ffffff" extendstyle="1111" font-size="24" v-align="center" h-align="center" />
                        </button>
                    </node>
                    <image rect="0,108,640,2" extendstyle="1114" style="tile" src="file://image/panel_split_dot.png" />
                </node>
                <node name="myBookingItem" rect="0,0,640,110" extendstyle="1111" visible="false" enable="false" >
                    <node name="normalStatus" >
                        <label name="bookingName" rect="30,25,480,30" text="" postfix="..." extendstyle="1111" font-size="26" v-align="top" />
                        <label name="recordPoint" rect="30,55,480,30" text="" postfix="..." extendstyle="1111" font-size="22" v-align="top" />
                   		<image rect="0,100,640,2" extendstyle="1111" style="tile" src="file://image/detail_greyline.png"/>
                    </node>
                    <node name="editStatus" visible="false" enable="false" >
                        <button name="editIco" rect="30,26,58,58" data="0" extendstyle="1111" OnSelect="showOrHideDelBtn" >
                            <image rect="0,0,58,58" extendstyle="1111" style="autosize" src="file://image/panel_edit_off.png" />
                        </button>
                        <label name="bookingName" rect="130,25,380,30" text="" postfix="..." extendstyle="1111" font-size="26" v-align="top" />
                        <label name="recordPoint" rect="130,55,380,30" text="" postfix="..." extendstyle="1111" font-size="22" v-align="top" />
                        <image rect="0,100,640,2" extendstyle="1111" style="tile" src="file://image/detail_greyline.png"/>
                        <button name="panelDeleteBtn" sel="sel" normal="normal" rect="515,28,106,53" extendstyle="1111" visible="false" enable="false" OnSelect="deleteBookingBtnOnSelect" >
                            <image name="sel" rect="0,0,106,53" extendstyle="1111" style="autosize" src="file://image/panel_button_f.png" />
                            <image name="normal" rect="0,0,106,53" extendstyle="1111" style="autosize" src="file://image/panel_button_n.png" />
                            <label rect="0,0,106,53" text="删除" color="#ffffff" extendstyle="1111" font-size="24" v-align="center" h-align="center" />
                        </button>
                    </node>
                    <image rect="0,108,640,2" extendstyle="1114" style="tile" src="file://image/panel_split_dot.png" />
                </node>
                <node name="myCommentItem" rect="0,0,640,100" extendstyle="1111" visible="false" enable="false" >
                    <node name="normalStatus" >
                        <label name="commentName" rect="30,10,380,40" text="" postfix="..." extendstyle="1111" font-size="26" v-align="top" />
                        <label name="programName" rect="30,50,350,30" text="" postfix="..." extendstyle="1111" font-size="24" v-align="top" />
                        <label name="commentTime" rect="385,50,230,30" text="" postfix="..." extendstyle="1111" font-size="24" v-align="top" h-align="right" />
                        <image rect="0,90,640,2" extendstyle="1111" style="autosize" src="file://image/personalcenter_fgx.png"/>
                    </node>
                    <node name="editStatus" visible="false" enable="false" >
                        <button name="editIco" rect="30,10,58,58" data="0" extendstyle="1111" OnSelect="showOrHideDelBtn" >
                            <image rect="0,0,58,58" extendstyle="1111" style="autosize" src="file://image/panel_edit_off.png" />
                        </button>
                        <label name="commentName" rect="130,10,380,40" text="" postfix="..." extendstyle="1111" font-size="26" v-align="top" />
                        <label name="programName" rect="130,50,380,30" text="" postfix="..." extendstyle="1111" font-size="24" v-align="top" />
                        <label name="commentTime" rect="385,50,130,30" text="" postfix="..." extendstyle="1111" font-size="24" v-align="top" h-align="right" />
                        <image rect="0,90,640,2" extendstyle="1111" style="autosize" src="file://image/personalcenter_fgx.png"/>
                        <button name="panelDeleteBtn" sel="sel" normal="normal" rect="515,10,106,53" extendstyle="1111" visible="false" enable="false" OnSelect="deleteCommentBtnOnSelect" >
                            <image name="sel" rect="0,0,106,53" extendstyle="1111" style="autosize" src="file://image/panel_button_f.png" />
                            <image name="normal" rect="0,0,106,53" extendstyle="1111" style="autosize" src="file://image/panel_button_n.png" />
                            <label rect="0,0,106,53" text="删除" color="#ffffff" extendstyle="1111" font-size="24" v-align="center" h-align="center" />
                        </button>
                    </node>
                    <image rect="0,90,640,2" extendstyle="1114" style="tile" src="file://image/panel_split_dot.png" />
                </node>
                <node name="skinAreaNode" rect="0,0,640,0" extendstyle="1111" >
                    <list name="skinTypeList" rect="75,20,530,0" extendstyle="1111" line="2" col="2" auto-adjust="true" offset="35,0" />
                    <node name="skinTypeItem" rect="0,0,230,230" extendstyle="1111" visible="false" enable="false" >
                        <button name="panelSkinTypeBtn" disabled="disabled" rect="0,0,230,230" extendstyle="1111" OnSelect="panelSkinTypeBtnOnSelect" >
                            <!--<image name="disabled" rect="0,0,229,146" extendstyle="1111" style="autosize" src="file://image/skin_focus.png" />-->
                            <image name="skinImage" rect="2,2,225,142" extendstyle="1100" style="autosize" src="file://image/skin_blue.png" />
                            <image name="skinselect" rect="185,100,42,43" extendstyle="1111" style="autosize" src="file://image/detail_select.png" />
                            <label rect="0,146,230,84" extendstyle="1111" font-size="24" v-align="center" h-align="center" />
                        </button>
                    </node>
                </node>
                <node name="aboutAreaNode" rect="0,0,640,0" extendstyle="1111" visible="false" enable="false" >
                    <node name="desArea" >
                    	<image name="aboutAreaLogo" rect="40,10,194,29" extendstyle="1100" style="autosize" src="file://image/logo.png" />
                        <textarea rect="40,60,560,0" extendstyle="1111" line-height="40" font-size="22" autoextend="true" />
                        <node name="buttonArea" rect="170,0,297,164" extendstyle="1111" >
                            <button normal="normal" sel="sel" rect="0,0,297,72" extendstyle="1111" OnSelect="advBtnOnSelect" >
                                <image name="normal" rect="0,0,297,72" extendstyle="1111" style="autosize" src="file://image/about_btn_n.png" />
                                <image name="sel" rect="0,0,297,72" extendstyle="1111" style="autosize" src="file://image/about_btn_f.png" />
                                <label rect="0,0,297,72" extendstyle="1111" text="意见反馈" font-size="30" v-align="center" h-align="center" color="#ffffff" />
                            </button>
                           <!-- <button name="updateBtn" normal="normal" sel="sel" rect="0,92,297,72" extendstyle="1111" OnSelect="updataBtnOnSelect">
                                <image name="normal" rect="0,0,297,72" extendstyle="1111" style="autosize" src="file://image/about_btn_n.png" />
                                <image name="sel" rect="0,0,297,72" extendstyle="1111" style="autosize" src="file://image/about_btn_f.png" />
                                <label rect="0,0,297,72" extendstyle="1111" text="检查更新" font-size="30" v-align="center" h-align="center" color="#ffffff" />
                             </button>-->
                        </node>
                    </node>
                    <node name="advArea" visible="false" enable="false" >
                        <image rect="20,20,600,370" extendstyle="1111" style="sudoku-auto" sudoku="7,7,7,7" src="file://image/txtarea_bg.png" />
                        <label name="advTips" rect="30,30,580,330" extendstyle="1111" text="感谢您对视频中国的支持，请输入您的反馈信息！" color="#777777" font-size="20" />
                        <edit name="advInput" rect="30,30,580,350" extendstyle="1111" direction="vertical" multiline="true" font-size="24" text="" color="#777777" OnTextChanged="advInputOnTextChanged"  OnKeyboardSizeChanged="chatOnKeyboardSizeChanged6" max-size="250"/>                   	 
                    </node>
                </node> 
            </node>
            <panorama name="panoramaNew" rect="0,0,640,960" visible="false" enable="false" foreground="foreground" extendstyle="1111">
            <panoramaitem rect="0,0,640,960" extendstyle="1111" OnSelect = "panoramaItemOnSelect" >
                <button name="recommendImg" rect="0,0,640,960" style="autosize" src="$(pimage)" extendstyle="1111" OnMouseDown="panoramaOnMouseDown" OnMouseMove="panoramaOnMouseMove" OnMouseUp="panoramaOnMouseUp" />
                <button name="startUse" enable="false" visible="false" OnSelect = 'startUseOnSelect' rect="330,700,300,240" extendstyle="1111" />
            </panoramaitem>
            <dataset>
                <set pimage="file://image/guidepage01.jpg"/>
                <set pimage="file://image/guidepage02.jpg"/>
                <set pimage="file://image/guidepage03.jpg"/>
            </dataset>
            <panoramaitem name="foreground" rect="0,910,640,150" extendstyle="1111">
                <list name="foregroundList" rect="180,0,281,12" extendstyle="0000" line="1" col="3" auto-adjust="true" offset="15,10" />
            </panoramaitem>
        </panorama>
        </node>
    </body>
    <![CDATA[

require 'com_wondertek_cnlive2.common.framework'
local rootSprite
local preButton = 0  --用于记住上一个处于编辑状态的列表项的“显示删除”按钮
local curSubAreaIndex = 0  -- 当前显区域索引  1-我的帐户 2-播放记录 3-我的预约 4-我的评论 5-皮肤设置 6-帮助 7-关于
local aboutContent = '      《视频中国•互动电视》是在国务院新闻办公室领导下中国互联网新闻中心（中国网）推出的国家新媒体平台，基于无线互联网通过手机、pad等移动智能终端，以融和网络特性与电视特色于一体的全球化、全互动、多终端的传播方式，为全球用户展示新媒体时代的"电视新看法"！\n      《视频中国•互动电视》同时承担着“中国网”作为国家级对外传播网站在新媒体领域的外宣职责，向全球传播中华文化。\n\n当前版本：v1.1.1\n北京中投视讯文化传媒有限公司版权所有\nWEB网址：www.CnliveTV.com\nWAP网址：wap.CnliveTV.com\n客服QQ：1994287328\n客服电话：010-52487808\n客服邮件：service01@cnlive.com'
local curAccountStep = 1  -- 1-注册 2-登录 3-已登录 4-找回密码 5-找回密码结果 6-关联新浪微博
local guanlian = 0 -- 是否点击关联微博按钮
local PersonalPanel = {}
local commentListDataTable = {}
local isExsit = 0
local isBindUser = 0
local currToken = ''
local currUid = ''
local historyStatus1 = 0 -- 0、正常 1、编辑
local myAccountflag 
local nickNameNode
local haveloginFlag = 0
---------------------------------------callbacks--------------------------------
-- @brief root子节点创建完事件
function bodyBuildChildrenFinished(sprite)
    rootSprite = sprite
    area0 = Sprite:findChild(rootSprite, 'area0')
    area1 = Sprite:findChild(rootSprite, 'area1')
    topStatusBar = Sprite:findChild(rootSprite, 'topStatusBar')
    contentListview = Sprite:findChild(rootSprite, 'contentListview')
    accountLoginNode = Sprite:findChild(rootSprite, 'accountLoginNode')
    accountLoginImfoNode = Sprite:findChild(rootSprite, 'accountLoginImfoNode')
    bigListview = Sprite:findChild(rootSprite, 'bigListview')
    accountRegisterNode = Sprite:findChild(rootSprite, 'accountRegisterNode')
    accountFindPasswordNode = Sprite:findChild(rootSprite, 'accountFindPasswordNode')
    accountFindResultNode = Sprite:findChild(rootSprite, 'accountFindResultNode')
    accountAuthorityNode = Sprite:findChild(rootSprite, 'accountAuthorityNode')
    accountAuthorityNode1 = Sprite:findChild(rootSprite, 'accountAuthorityNode1')
    playRecordItem = Sprite:findChild(rootSprite, 'playRecordItem')
    myBookingItem = Sprite:findChild(rootSprite, 'myBookingItem')
    myCommentItem = Sprite:findChild(rootSprite, 'myCommentItem')
    skinAreaNode = Sprite:findChild(rootSprite, 'skinAreaNode')
    aboutAreaNode = Sprite:findChild(rootSprite, 'aboutAreaNode')
    updateBtn = Sprite:findChild(rootSprite, 'updateBtn')
    panoramaNew = Sprite:findChild(rootSprite, 'panoramaNew')
    foregroundList = Sprite:findChild(rootSprite, 'foregroundList')
    createPanoramaForeground(foregroundList, 3)
    
    chatTips1 = Sprite:findChild(rootSprite, 'chatTips1')
	chatTips2 = Sprite:findChild(rootSprite, 'chatTips2')
	topReturnButton = Sprite:findChild(rootSprite, 'topReturnButton')
end

-- @brief root节点消息方法
function bodyOnSpriteEvent(msg, param)
    if msg == MSG_ACTIVATE then -- 页面激活
    	local reg = Reg:create(Reg.com_wondertek_cnlive2.personalcenter)
        myAccountflag = Reg:getNumber(reg,'myAccountflag')
        Log:write('myAccountflag=======',myAccountflag)
        if myAccountflag == 1 then
		    curSubAreaIndex = 1
		    setCommonMenuStatus(0)
		    Sprite:setEnable(area1, 1)
		    Sprite:setVisible(area1, 1)
		    Sprite:setEnable(area0, 0)
		    Sprite:setVisible(area0, 0)
		    Sprite:setEnable(topReturnButton , 0)
		    local account, password = getAccountAndPasswordFromLocal()
		    if account and account ~= '' then
		        --setTopButtonStatus({1,0,0,0,0}, '已登录')
		        Log:write('3333333333333333333333',account)
		        checkAccountAndPassword(account,password)
		    else
		        setTopButtonStatus({0,1,0,0,1}, '登录')
		        setCurAccountStep(2)
		    end
        end
        --Menu:load(rootSprite, Menu.TYPE.home)
        --setTopMenuStatus({'topReturnButton'}, 1, '个人中心')
        preButton = 0
        curSubAreaIndex = 0
        
        local sinaUrl = Util:getServer() .. 'clt/sinaAuthUrl.msp'
        Http:request('sinaAuthUrl', sinaUrl, 102, {useCache = false,method = 'post',postData=Util:getRequestTail()})
        
        local qqUrl = Util:getServer() .. 'clt/qqAuthUrl.msp'
        Http:request('qqAuthUrl', qqUrl, 103, {useCache = false,method = 'post',postData=Util:getRequestTail()})
        
        
        local returnDadaHandel = Reg:create("return_data")
        local return_name = Reg:getString(returnDadaHandel, 'return_name')
        
        if return_name ~= nil and return_name ~= "" then
            Sprite:setProperty(nickNameNode,'text', return_name)
        end
        
        Reg:setString(returnDadaHandel, 'return_name', '')
        
        --local account,password = getAccountAndPasswordFromLocal()
        --if account ~= '' then
           -- local getHistoryurl = Util:getServer()..'clt/myHistory.msp'
    	    --local postData = 'loginName='..account..Util:getRequestTail()
    	   -- Http:request('historyData',getHistoryurl,111,{useCache=false,method = "post",postData=postData})
        --end
    elseif msg == MSG_DEACTIVATE then
        Tips:close()
        if Loading:isShow() then Loading:close() end
    else
        Util:onSpriteEvent(msg, param)
    end
end

-- @brief 插件消息方法
function bodyOnPluginEvent(msg, param)
    if msg == 101 then
        local advData = Http:jsonDecode('submit_adv')
        Log:write('advData', advData)
        if advData and advData.resultCode == '1' then
            Tips:show(advData.resultMsg)
            Sprite:setProperty(advInput, 'text', '')
        else
            Tips:show(advData.resultMsg)
        end
    elseif msg == 102 then
        sinaAuthUrl = Http:jsonDecode('sinaAuthUrl')
        Log:write('2222222222222222222',sinaAuthUrl)
    elseif msg == 103 then
        qqAuthUrl = Http:jsonDecode('qqAuthUrl')
        Log:write('3333333333333333333',qqAuthUrl)
    elseif msg == Msg.weiboAuth then
        local weiboAuthData = Http:jsonDecode('get_auth_url')
        Log:write('weiboAuthData', weiboAuthData)
        if weiboAuthData.resultCode == '1' then
            if isExsit == 0 then
                Log:write('WebBrowser:create前')
                WebBrowser:create(0, 70, 640, 890)
                Log:write('WebBrowser:create后')
                isExsit = 1
            end
            local reg_weibo = Reg:create(Reg.com_wondertek_cnlive2.weibo)
            local fromWhere = Reg:getInteger(reg_weibo, 'fromWhere')
            --local callbackNum = WebBrowser:openUrl('http://p.10086.cn')
            --Log:write('callbackNum',callbackNum)
            --Plugin:invoke(WebBrowser:_getHandle(), 'OpenUrl', 'http://p.10086.cn')
            WebBrowser:removeCookie()
            Plugin:invoke(WebBrowser:_getHandle(), 'OpenUrl', fromWhere == 1 and weiboAuthData.authUrl or weiboAuthData.authUrl .. '&wap=2' , Plugin:getObserver(), Msg.weiboBanding)
            WebBrowser:showWebBrowser(1)
        else
            Tips:show('获取微博授权地址失败！')
        end
    elseif msg == Msg.weiboBanding then
        local rtn = Param:getString(param, 0)
        Log:write('rtn=======Msg.weiboBanding=========',rtn)
        local _, _, result = string.find(rtn, 'resultCode=(%d)')
        if result then
            if result == '1' then
                WebBrowser:showWebBrowser(0)
                local reg_weibo = Reg:create(Reg.com_wondertek_cnlive2.weibo)
                local fromWhere = Reg:getInteger(reg_weibo, 'fromWhere')
                if fromWhere == 1 then
                    saveWeiboToLocal('isBandingSina', '1')
                    local _, _, sinaaccessToken = string.find(rtn, 'accessToken=([%w_\.]*)')
                    local _, _, sinauid = string.find(rtn, 'uid=([%w\.]*)')
                    local _, _, loginName = string.find(rtn, 'loginName=([%w\_.]*)')
                    local _, _, sname = string.find(rtn, 'sname=([%w_\.]*)')
                    currToken = sinaaccessToken
                    currUid = sinauid
                    
                    saveWeiboToLocal('sinaaccessToken', sinaaccessToken)
                    saveWeiboToLocal('sinauid', sinauid)
                    
                    if loginName ~= nil and loginName ~= '' then
                        setCurAccountStep(2)
                        setTopButtonStatus({0,1,0,0,1}, '登录')
                        loginData = {}
                        Sprite:setEnable(contentListview, 1)
                        Sprite:setVisible(contentListview, 1)
                        local accountInput = Sprite:findChild(rootSprite, 'accountInput')
                        local passwordInput = Sprite:findChild(rootSprite, 'passwordInput')
                        local chatTips1 = Sprite:findChild(rootSprite, 'chatTips1')
                        local chatTips2 = Sprite:findChild(rootSprite, 'chatTips2')
                        Sprite:setProperty(accountInput,'text',loginName)
            		    Sprite:setProperty(passwordInput,'text','')
            		    Sprite:setVisible(chatTips1, 0)
            		    Sprite:setVisible(chatTips2, 1)
            		    Tips:show('该微博已被“'..loginName..'”用户绑定,请直接登录！')
                        return
                    end
                    Tips:show('新浪微博授权成功！')
                else
                    saveWeiboToLocal('isBandingQQ', '1')
                    local _, _, qqaccessToken = string.find(rtn, 'accessToken=([%w\.]*)')
                    local _, _, qqopenId = string.find(rtn, 'uid=([%w\.]*)')
                    local _, _, loginName = string.find(rtn, 'loginName=([%w\_.]*)')
                    local _, _, sname = string.find(rtn, 'sname=([%w_\.]*)')
                    currToken = qqaccessToken
                    currUid = qqopenId
                    
                    saveWeiboToLocal('qqaccessToken', qqaccessToken)
                    saveWeiboToLocal('qquid', qqopenId)
                    
                    if loginName ~= nil and loginName ~= '' then
                        setCurAccountStep(2)
                        setTopButtonStatus({0,1,0,0,1}, '登录')
                        loginData = {}
                        Sprite:setEnable(contentListview, 1)
                        Sprite:setVisible(contentListview, 1)
                        local accountInput = Sprite:findChild(rootSprite, 'accountInput')
                        local passwordInput = Sprite:findChild(rootSprite, 'passwordInput')
                        local chatTips1 = Sprite:findChild(rootSprite, 'chatTips1')
                        local chatTips2 = Sprite:findChild(rootSprite, 'chatTips2')
                        Sprite:setProperty(accountInput,'text',loginName)
            		    Sprite:setProperty(passwordInput,'text','')
            		    Sprite:setVisible(chatTips1, 0)
            		    Sprite:setVisible(chatTips2, 1)
            		    Tips:show('该微博已被“'..loginName..'”用户绑定,请直接登录！')
                        return
                    end
                    Tips:show('腾讯微博授权成功!')
                end 
            else
                Tips:show('绑定微博失败！')
            end
            setTopButtonStatus({1,0,0,0,0}, '绑定')
            Sprite:setEnable(contentListview, 1)
            Sprite:setVisible(contentListview, 1)
            isBindUser = 1
            setCurAccountStep(2)
        end
    elseif msg == Msg.bindUser then
        bindUserData = Http:jsonDecode('bindUserData')
        Log:write('bindUserData===3333333333',bindUserData)
        if bindUserData and bindUserData.resultMsg then
            checkAccountAndPassword(g_account, g_password)
            Tips:show('微博绑定成功！')
        end
    elseif msg == 105 then
    		createCommentList()
    elseif msg == 106 then
    	delData = Http:jsonDecode('delData')
    	if delData and delData.resultCode == '1' then
    		Tips:show('删除成功！') 
    		
    		local myCommentUrl = Util:getServer()..'clt/userComment.msp'
		    local account, password = getAccountAndPasswordFromLocal()
		    Http:request('myCommentData',myCommentUrl,116,{useCache = false,method = 'post',postData = 'loginName='..account..Util:getRequestTail()})
		    	
	    end
		elseif msg == 116 then
			preButton = 0
			createCommentList()
			changeListItemStatus('edit')
		elseif msg == 107 then
			preButton = 0
		    createHistoryList()
		    changeListItemStatus('edit') 
		elseif msg == 111 then
    		playRecordTable = Http:jsonDecode('historyData')
    		if playRecordTable.playHistorys then
        		Log:write('ppppppppppppppppppppppppp',playRecordTable)
        		ListView:removeAllItems(contentListview)
        	    ListView:loadItem(contentListview, playRecordItem, #playRecordTable.playHistorys+1, 'playRecordItemOnLoad')
        	    ListView:adjust(contentListview)
    	    end
		elseif msg == Msg.delHistory then
			delHistoryData = Http:jsonDecode('delHistoryData')
			local account,password = getAccountAndPasswordFromLocal()
			if delHistoryData and delHistoryData.resultCode == '1' then
	            local getHistoryurl = Util:getServer()..'clt/myHistory.msp'
	            local postData = 'loginName='..account..Util:getRequestTail()
	            Http:request('historyData',getHistoryurl,107,{useCache=false,method ="post",postData=postData})
	            Tips:show('删除成功！')
	        end
    elseif msg == 110 then
    	  checkResultData = Http:jsonDecode('index_checkVersionData')
    	  Log:write('12121212121212',checkResultData)
        if not checkResultData or type(checkResultData) ~= 'table' then
        	  --enterApp()
        	  --Timer:set(3, 3000, 'enterApp')
        	  Tips:show('没有发现新版本！')
            return
        end
        local flag = checkResultData.flag
        if flag == '0' then
            --enterApp()
            Tips:show('没有发现新版本！')
        elseif flag == '1' then
            Dialog:show('','发现新版客户端，是否立即升级？', 'ok_cancel', 'downloadClientPackage', 'cancelDownload')
        elseif flag == '2' then
            Dialog:show('','当前客户端版本过低，请立即升级！', 'ok', 'downloadClientPackage')
        else
        	  --enterApp()
        	  Tips:show('没有发现新版本！')
        end
    elseif msg == 101 + MSG_CACHEDATA_RELOAD then -- 101请求的数据有更新
    elseif msg == 101 + MSG_NETWORK_ERROR then -- 101请求的数据超时
    
    elseif msg == Msg.register then
        local registerData = Http:jsonDecode('per_reg')
        Log:write('registerData', registerData)
        if registerData.resultCode == '1' then
            saveUserAccountAndPassword(g_account, g_password)
            checkAccountAndPassword(g_account,g_password)
            delWeibo('sinaaccessToken') -- 删除本地微博绑定记录
            delWeibo('qqaccessToken')
            delWeibo('sinauid')
            delWeibo('qquid')
        else
            Tips:show(registerData.resultMsg)
        end
    elseif msg == Msg.loginout then
        local logoutData = Http:jsonDecode('logoutData')
        Log:write('logoutData', logoutData)
        haveloginFlag = 0
        if logoutData.resultCode == '1' then
            local reg_authority = Reg:create('authority')
            Reg:setInteger(reg_authority, 'userStatus', 0)
            setTopButtonStatus({0,1,0,0,1}, '登录')
            setCurAccountStep(2)
            loginData = {}
            local account = getAccountAndPasswordFromLocal()
            delWeibo(account..'sinaaccessToken') -- 删除本地微博绑定记录
            delWeibo(account..'qqaccessToken')
            delWeibo(account..'sinauid')
            delWeibo(account..'qquid')
            delAccount('account','password')
            local accountInput = Sprite:findChild(rootSprite, 'accountInput')
            local passwordInput = Sprite:findChild(rootSprite, 'passwordInput')
            local chatTips1 = Sprite:findChild(rootSprite, 'chatTips1')
            local chatTips2 = Sprite:findChild(rootSprite, 'chatTips2')
            Sprite:setProperty(accountInput,'text','')
		    Sprite:setProperty(passwordInput,'text','')
		    Sprite:setVisible(chatTips1, 1)
		    Sprite:setVisible(chatTips2, 1)
        else
            Tips:show(logoutData.resultMsg)
        end
    elseif msg == Msg.login then
        loginData = Http:jsonDecode('per_login')
        Log:write('loginData========555555555555',loginData)
        haveloginFlag = 1
        if loginData.resultCode == '1' then
        	local reg_authority = Reg:create('authority')
            Reg:setInteger(reg_authority, 'userStatus', 1)
            local account = getAccountAndPasswordFromLocal()
            if account == '' then
                delWeibo('sinaaccessToken') -- 删除本地微博绑定记录
                delWeibo('qqaccessToken')
                delWeibo('sinauid')
                delWeibo('qquid')
            end
            saveUserAccountAndPassword(g_account, g_password)
            Reg:setString(reg_authority, 'loginName', g_account)
            if loginData.weibo then
                for i=0,#loginData.weibo do
                    if loginData.weibo[i].type == 1 then
                        Log:write('33333333333333333333')
                        saveWeiboToLocal(g_account..'sinaaccessToken', loginData.weibo[i].token)
                        saveWeiboToLocal(g_account..'sinauid', loginData.weibo[i].uid)
                    elseif loginData.weibo[i].type == 2 then
                        Log:write('444444444444444444444')
                        saveWeiboToLocal(g_account..'qqaccessToken', loginData.weibo[i].token)
                        saveWeiboToLocal(g_account..'qquid', loginData.weibo[i].uid)
                    end
                end
            end
            setCurAccountStep(3)
            setTopButtonStatus({1,0,0,0,0},'已登录')
            -- Jlc登录成功后发送播放历史请求
            --local getHistoryurl = Util:getServer()..'clt/myHistory.msp'
	        --local postData = 'loginName='..g_account..Util:getRequestTail()
	        --Http:request('historyData',getHistoryurl,111,{useCache=false,method = "post",postData=postData})
        else
            Tips:show(loginData.resultMsg)
            setTopButtonStatus({0,1,0,0,1}, '登录')
            setCurAccountStep(2)
            local chatTips1 = Sprite:findChild(rootSprite, 'chatTips1')
            local chatTips2 = Sprite:findChild(rootSprite, 'chatTips2')
            Sprite:setVisible(chatTips2,0)
            Sprite:setVisible(chatTips1,0)
        end
    elseif msg == Msg.findPassword then
        local findPassword = Http:jsonDecode('findPassword')
        Log:write('4343434443333',findPassword)
        if findPassword and findPassword.resultCode == '1' then
            setTopButtonStatus({1,0,0,0,0}, '找回密码')
            setCurAccountStep(5)
        else
            Tips:show(findPassword.resultMsg)
            local accountEdit = Sprite:findChild(accountFindPasswordNode,'accountInput')
            Sprite:setProperty(accountEdit,'text','')
        end
    else
        Util:onPluginEvent(msg, param)
    end
end

-- @brief 返回
function returnOnSelect(sprite)
    Sprite:killFocus(sprite)
    Sprite:releaseCapture(sprite)
    Scene:back()
end

-- @brief 按键响应处理
function mainNodeOnKeyUp(sprite, kc)
    if kc == Key.F2 then -- 按下返回键
        if WebBrowserIsShow == 1 then
            WebBrowser:showWebBrowser(0)
            WebBrowserIsShow = 0
            return
        end
        if Loading:isShow() then 
        	Loading:close()
        	return 
        end
        Scene:back()
        return 1
    end
end

function setCommonMenuStatus(flag)
    local spriteMenu = Sprite:findChild(rootSprite, 'spriteMenu')
    Sprite:setEnable(spriteMenu, flag)
    Sprite:setVisible(spriteMenu, flag)
end

function myAccountOnSelect(sprite)
    curSubAreaIndex = 1
    setCommonMenuStatus(0)
    Sprite:setEnable(area1, 1)
    Sprite:setVisible(area1, 1)
    Sprite:setEnable(area0, 0)
    Sprite:setVisible(area0, 0)
    Sprite:setEnable(topReturnButton , 0)
    local account, password = getAccountAndPasswordFromLocal()
    if account and account ~= '' then
        --setTopButtonStatus({1,0,0,0,0}, '已登录')
        Log:write('3333333333333333333333',account)
        if haveloginFlag == 0 then
        	checkAccountAndPassword(account,password)
        else
        	local reg_authority = Reg:create('authority')
            Reg:setInteger(reg_authority, 'userStatus', 1)
            saveUserAccountAndPassword(g_account, g_password)
            Reg:setString(reg_authority, 'loginName', g_account)
            if loginData.weibo then
                for i=0,#loginData.weibo do
                    if loginData.weibo[i].type == 1 then
                        Log:write('33333333333333333333')
                        saveWeiboToLocal(g_account..'sinaaccessToken', loginData.weibo[i].token)
                        saveWeiboToLocal(g_account..'sinauid', loginData.weibo[i].uid)
                    elseif loginData.weibo[i].type == 2 then
                        Log:write('444444444444444444444')
                        saveWeiboToLocal(g_account..'qqaccessToken', loginData.weibo[i].token)
                        saveWeiboToLocal(g_account..'qquid', loginData.weibo[i].uid)
                    end
                end
            end
            setCurAccountStep(3)
            setTopButtonStatus({1,0,0,0,0},'已登录')
        end
    else
        setTopButtonStatus({0,1,0,0,1}, '登录')
        setCurAccountStep(2)
    end
end

-- 播放记录按钮
function showPlayRecord(sprite)
    historyStatus1 = 0
    Sprite:setEnable(topReturnButton , 0)
    preButton = 0
    curSubAreaIndex = 2
    setCommonMenuStatus(0)
    Sprite:setEnable(area1, 1)
    Sprite:setVisible(area1, 1)
    Sprite:setEnable(area0, 0)
    Sprite:setVisible(area0, 0)
    setTopButtonStatus({1,0,1,0,0}, '播放记录')
    createHistoryList()
end

function showMyBooking(sprite)
    preButton = 0
    curSubAreaIndex = 3
    Sprite:setEnable(topReturnButton , 0)
    setCommonMenuStatus(0)
    Sprite:setEnable(area1, 1)
    Sprite:setVisible(area1, 1)
    Sprite:setEnable(area0, 0)
    Sprite:setVisible(area0, 0)
    setTopButtonStatus({1,0,1,0,0}, '我的预约')
    createBookingList()
end

--点击我的评论，获取我的评论列表
function showMyComment(sprite)
	Sprite:killFocus(sprite)
	Sprite:releaseCapture(sprite)	
    preButton = 0
    Sprite:setEnable(topReturnButton , 0)
    curSubAreaIndex = 4
    setCommonMenuStatus(0)
    Sprite:setEnable(area1, 1)
    Sprite:setVisible(area1, 1)
    Sprite:setEnable(area0, 0)
    Sprite:setVisible(area0, 0)
    setTopButtonStatus({1,0,1,0,0}, '我的评论')
    getComment()	
end

function getComment()
	local reg_authority = Reg:create('authority')
    local userStatus = Reg:getInteger(reg_authority, 'userStatus')
    if userStatus == 0 then
    	Tips:show('您尚未登录！') 
    else
		local myCommentUrl = Util:getServer()..'clt/userComment.msp'
		local account, password = getAccountAndPasswordFromLocal()
		Http:request('myCommentData',myCommentUrl,105,{useCache = false,method = 'post',postData = 'loginName='..account..Util:getRequestTail()})
	end
end

function setMySkin(sprite)
    curSubAreaIndex = 5
    setCommonMenuStatus(0)
    Sprite:setEnable(area1, 1)
    Sprite:setVisible(area1, 1)
    Sprite:setEnable(topReturnButton , 0)
    Sprite:setEnable(area0, 0)
    Sprite:setVisible(area0, 0)
    setTopButtonStatus({1,0,0,1,0}, '皮肤设置')
    ListView:removeAllItems(contentListview, 1, 1)
    ListView:loadItem(contentListview, skinAreaNode, 1, 'skinAreaNodeOnLoad')
    ListView:adjust(contentListview)
end

function helpBtnOnSelect(sprite)
    curSubAreaIndex = 6
    setCommonMenuStatus(0)
    Sprite:setVisible(panoramaNew, 1)
    Sprite:setEnable(panoramaNew, 1)
end

function aboutBtnOnSelect(sprite)
    curSubAreaIndex = 7
    setCommonMenuStatus(0)
    Sprite:setEnable(area1, 1)
    Sprite:setVisible(area1, 1)
    Sprite:setEnable(area0, 0)
    Sprite:setEnable(topReturnButton , 0)
    Sprite:setVisible(area0, 0)
    setTopButtonStatus({1,0,0,0,0}, '关于')
    ListView:removeAllItems(contentListview, 1, 1)
    ListView:loadItem(contentListview, aboutAreaNode, 1, 'aboutAreaNodeOnLoad')
    ListView:adjust(contentListview)
end

function advBtnOnSelect(sprite)
	
    setAdvAreaStatus(1)
    setTopButtonStatus({0,1,0,1,0}, '意见反馈')
end

function updataBtnOnSelect(sprite)
	checkClientVersion()
end

-- @brief 客户端版本检测
function checkClientVersion()
    local clientName
    if Config:get('platform') == 'iOS' then
        clientName = 'CNLive-iPhone-Client'
    else
        clientName = 'CNLive-Android-Phone-Client'
    end
	  local url = Config:get('server') .. 'clt/update.msp'
    Http:request('index_checkVersionData', url, 110, {useCache = false, method = 'post', postData = 'version='..Config:get('app_version')..'&clientName='..clientName..Util:getRequestTail()})
end

-- @brief 取消升级
function cancelDownload() 
	  --enterApp()
end

-- @brief 客户端下载
function downloadClientPackage()
    toShowDownloadBar()
    doDownlaodPackage()
end

-- @brief 显示下载进度条
function toShowDownloadBar()
    local notice = Sprite:findChild(rootSprite, 'notice')
    Sprite:setProperty(notice, 'text', '升级包下载中')
    local download = Sprite:findChild(rootSprite, 'download')
    Sprite:setVisible(download, 1)
end

-- @brief 执行安装包下载
function doDownlaodPackage()
    Log:write('==========doDownlaodPackage==========',checkResultData)
    IO:dirRemove('CACHE:\\com_wondertek_cnlive2', 1)
    if checkResultData.downloadUrl and checkResultData.downloadUrl~='' then
        --local downloadPath = 'WONDER:\\temp\\installPackageName.apk'
       -- local reg = Reg:create(Reg.com_wondertek_cnlive2.index)
       -- if Reg:getInteger(reg, 'isSpecialUA') == 1 then
            local flashCard = getDownloadPath()
            if flashCard == '' then
                Dialog:show('', '未检测到SD卡,升级失败!', 'ok', 'enterApp')
                return
            end
            downloadPath = flashCard .. 'installPackageName.apk'
        --end
        local count = Download:getCount(true)
        for i = 1, count do
            Download:delete(i, true, true)
        end
        Download:append(downloadPath, 'installPackageName', checkResultData.downloadUrl, true)
        onGetDownloadStatus()
    else
        enterApp()
    end
end

-- @brief 获取SD卡路径
function getDownloadPath()
    local downloadPath = ''
    local flashCard = System:getFlashCardName() -- 判断外置存储卡存在性
    if flashCard and flashCard ~= '' then --存在外置存储卡
        Log:write('Util:getDownloadPath  flashCard=================', flashCard)
        downloadPath = flashCard .. '\\'
    end
    Log:write('Util:getDownloadPath=======================', downloadPath)
    return downloadPath
end

-- @brief 获取下载状态
function onGetDownloadStatus()
    local task = Download:getStatus(0, true)
    local percent = 0 
    if task[1].size and task[1].maxsize and task[1].maxsize ~= 0 then
        percent = math.floor(task[1].size/task[1].maxsize*100)
    end
    if task[1].status == Download.status.Downloading then
        toSetDownloadProcessBar(percent)
    elseif task[1].status == Download.status.Finished then
        toSetDownloadProcessBar(100)
        doInstallPackage()
        return
    end
    Timer:set(1, 500, 'onGetDownloadStatus')
end

-- @brief 设置下载进度条
function toSetDownloadProcessBar(percent)
    local downloadbar = Sprite:findChild(rootSprite, 'downloadbar')
    local x,y,_,h = Sprite:getRect(downloadbar)
    local width = math.ceil(2.8 * percent)
    if width < 15 then
        width = 0
    elseif width > 280 then
        width = 280
    end
    Sprite:setRect(downloadbar, x,y,width,h)
end

-- @brief 执行安装
function doInstallPackage()
    Log:write('==========doInstallPackage==========')
    Http:stopNetwork()
   -- local installPackage = 'WONDER:\\temp\\installPackageName.apk'
  --  local reg = Reg:create(Reg.com_wondertek_cnlive2.index)
  --  if Reg:getInteger(reg, 'isSpecialUA') == 1 then
        local flashCard = getDownloadPath()
        installPackage = flashCard .. 'installPackageName.apk'
   -- end
    Util:installApp(installPackage)
--  IO:fileRemove('WONDER:\\temp\\installPackageName.apk')
    IO:dirRemove('CACHE:\\com_wondertek_cnlive2', 1) 
    IO:dirCreate('CACHE:\\com_wondertek_cnlive2')
    IO:dirCreate('CACHE:\\com_wondertek_cnlive2\\image')
--    enterApp()
end

-- @brief 进入应用程序
function enterApp()
    if Config:get("show_update_log") == '1' then
        Config:set("show_update_log",0)
        local panoramaNew = Sprite:findChild(rootSprite, 'panoramaNew')
        Sprite:setVisible(panoramaNew, 1)
        Sprite:setEnable(panoramaNew, 1)
    else
        Scene:go(Alias.home)
    end
end

function submitMyAdv()
    local reg_authority = Reg:create('authority')
    --local loginName = Reg:getString(reg_authority, 'loginName')
    local content = Sprite:getText(advInput)
    Log:write('content', content)
    --if loginName == '' then
        --Tips:show('请先登录再反馈意见！')
    if content == nil or content == '' then
            Tips:show('反馈意见不能为空！')
            return
    end
    local i,j = string.find(content,'%S') -- 查找非空字符
    if i then
            local url = Util:getServer() .. 'clt/userSuggest.msp'
            local postData = 'content=' .. content
            Http:request('submit_adv', url, 101, {useCache=false, method ='post', postData=postData..Util:getRequestTail()})
    else
        Tips:show('反馈意见不能全为空字符！')
    end
end

function setAdvAreaStatus(flag)
    local desArea = Sprite:findChild(aboutItem, 'desArea')
    local advArea = Sprite:findChild(aboutItem, 'advArea')
    advTips = Sprite:findChild(advArea, 'advTips')
    advInput = Sprite:findChild(advArea, 'advInput')
    Sprite:setEnable(desArea, flag == 1 and 0 or 1)
    Sprite:setVisible(desArea, flag == 1 and 0 or 1)
    Sprite:setEnable(advArea, flag)
    Sprite:setVisible(advArea, flag)
    if flag == 0 then
    	Sprite:setProperty(advTips, 'text', '感谢您对视频中国的支持，请输入您的反馈信息！')
        Sprite:setProperty(advInput, 'text', '')
    end
end

function createHistoryList()
    ListView:removeAllItems(contentListview, 1, 1)
    local account,password = getAccountAndPasswordFromLocal()
    local getHistoryurl = Util:getServer()..'clt/myHistory.msp'
    local postData = 'loginName='..account..Util:getRequestTail()
    Http:request('historyData',getHistoryurl,111,{useCache=false,method = "post",postData=postData})
end

function createBookingList() 
    ListView:removeAllItems(contentListview, 1, 1)
    --local reg_authority = Reg:create('authority')
    --local userStatus = Reg:getInteger(reg_authority, 'userStatus')
    --if userStatus == 0 then
        --PersonalPanel.listDataTable = {}
        --Tips:show('您尚未登录！')
    --else
    PersonalPanel.listDataTable = loadLocalDataFromXml(Reg.com_wondertek_cnlive2.booking, 'USERDATA:\\booking2.xml', 'bookingContent')
    --end
    ListView:loadItem(contentListview, myBookingItem, #PersonalPanel.listDataTable, 'myBookingItemOnLoad')
    ListView:adjust(contentListview) 
end  

function myBookingItemOnLoad(list, item, index)
    Sprite:setProperty(item, "extendstyle", "1111")
    Sprite:setRect(item, 0, 0, 640, 110)
    local normalStatus = Sprite:findChild(item, 'normalStatus')
    local editStatus = Sprite:findChild(item, 'editStatus')
    local panelDeleteBtn = Sprite:findChild(editStatus, 'panelDeleteBtn')
    Sprite:setProperty(Sprite:findChild(normalStatus, 'bookingName'), 'text', PersonalPanel.listDataTable[index + 1].videoName)
    Sprite:setProperty(Sprite:findChild(normalStatus, 'recordPoint'), 'text', '预约时间:'..''..PersonalPanel.listDataTable[index + 1].viewTime)
    Sprite:setProperty(Sprite:findChild(editStatus, 'bookingName'), 'text', PersonalPanel.listDataTable[index + 1].videoName)
    Sprite:setProperty(Sprite:findChild(editStatus, 'recordPoint'), 'text', '预约时间:'..''..PersonalPanel.listDataTable[index + 1].viewTime)
    Sprite:setProperty(panelDeleteBtn, 'data', PersonalPanel.listDataTable[index + 1].videoId)
end

function createCommentList()
	myCommlist = Http:jsonDecode('myCommentData')
	Log:write('myCommlist=====',myCommlist)
    if myCommlist and myCommlist.resultCode == '1' then
	    ListView:removeAllItems(contentListview, 1, 1)    
		ListView:loadItem(contentListview, myCommentItem, #myCommlist.commentList+1, 'myCommentItemOnLoad')
		ListView:adjust(contentListview)
	end
end

function accountLoginNodeOnLoad(list, item, index)
    Sprite:setProperty(item, 'extendstyle', '1111')
    Sprite:setRect(item, 0, 0, 640, 890)
    setAccountAndPasswordToEdit(item)
    local unBindNode = Sprite:findChild(item,'unBindNode')
    local bindNode = Sprite:findChild(item,'bindNode')
    Log:write('5555555555555555555',isBindUser..'wwwwwww',unBindNode..'qqqqq',bindNode..'sssss')
    if isBindUser == 1 then
        Log:write('33333333333333333333333')
        Sprite:setVisible(unBindNode,0)
        Sprite:setVisible(bindNode,1)
        Sprite:setEnable(unBindNode,0)
        Sprite:setEnable(bindNode,1)
    else
        Sprite:setVisible(unBindNode,1)
        Sprite:setVisible(bindNode,0)
        Sprite:setEnable(unBindNode,1)
        Sprite:setEnable(bindNode,0)
		    local cooperatorList = Sprite:findChild(item, 'cooperatorList')
		    local cooperatorItem = Sprite:findChild(item, 'cooperatorItem')
		    List:loadItem(cooperatorList, cooperatorItem, 2, 'cooperatorItemOnLoad')
		    List:adjust(cooperatorList)
		end
end

function accountNodeOnLoad(list, item, index)
    Sprite:setProperty(item, 'extendstyle', '1111')
    Sprite:setRect(item, 0, 0, 640, 890)
    if curAccountStep == 3 then
        local userNameLabel = Sprite:findChild(item,'userNameLabel')
        local nickname = Sprite:findChild(item,'nickname')
        
        Sprite:setProperty(userNameLabel,'text','帐  号：'..loginData.resultMsg.name)
        Sprite:setProperty(nickname,'text',loginData.resultMsg.sname)
        nickNameNode = nickname
    end
end

function cooperatorItemOnLoad(list, item, index)
    local cooperatorImageTable = {'file://image/sina.png', 'file://image/tengxun.png'}
    local weibobtn = Sprite:findChildByClass(item,'button')
    if index == 0 then
        Sprite:setProperty(weibobtn,'data','clt/sinaAuthUrl.msp')
    elseif index == 1 then
        Sprite:setProperty(weibobtn,'data','clt/qqAuthUrl.msp')
    end
    Sprite:setProperty(item, "extendstyle", "1111")
    Sprite:setRect(item, 0, 0, 80, 80)
    Sprite:setProperty(Sprite:findChild(item, 'pic'), "src", cooperatorImageTable[index + 1])
end

function setAccountAndPasswordToEdit(subNode)
    local accountInput = Sprite:findChild(subNode, 'accountInput')
    local passwordInput = Sprite:findChild(subNode, 'passwordInput')
    local account, password = getAccountAndPasswordFromLocal()
    Sprite:setProperty(accountInput, 'text', account) 
    Sprite:setProperty(passwordInput, 'text', password)
    Sprite:setVisible(chatTips2,0)
    Sprite:setVisible(chatTips1,0)
end

function registerBtnOnSelect(sprite)
    local account, password ,password2 = getAccountAndPasswordFromEdit2(Sprite:getParent(sprite))
    saveUserAccountAndPasswordToServer(account, password,password2)
end

function getAccountAndPasswordFromEdit2(subNode)
    local accountInput = Sprite:findChild(subNode, 'accountInput')
    local passwordInput = Sprite:findChild(subNode, 'passwordInput')
    local passwordInput2 = Sprite:findChild(subNode, 'passwordInput2')
    return (accountInput ~= 0 and Sprite:getText(accountInput) or ''), (passwordInput ~= 0 and Sprite:getText(passwordInput) or ''), (passwordInput2 ~= 0 and Sprite:getText(passwordInput2) or '')
end

function findPassWordBtnOnSelect(sprite)
    setTopButtonStatus({0,1,0,0,0}, '找密码')
    setCurAccountStep(4)
end

function panelUserBindOnSelect(sprite)
    local account, password = getAccountAndPasswordFromEdit(Sprite:getParent(Sprite:getParent(sprite)))
    bindUser(account, password)
    isBindUser = 0
end

function getAccountAndPasswordFromEdit(subNode)
    local accountInput = Sprite:findChild(subNode, 'accountInput')
    local passwordInput = Sprite:findChild(subNode, 'passwordInput')
    return (accountInput ~= 0 and Sprite:getText(accountInput) or ''), (passwordInput ~= 0 and Sprite:getText(passwordInput) or '')
end

function bindUser(account, password)
    g_account = account
    g_password = password
    local url = Util:getServer() .. 'clt/userBind.msp'
    local reg_weibo = Reg:create(Reg.com_wondertek_cnlive2.weibo)
    local fromWhere = Reg:getInteger(reg_weibo, 'fromWhere')
    local postData = 'loginName=' .. account .. '&password=' .. password .. '&token=' .. currToken .. '&uid=' .. currUid .. '&type='..fromWhere..Util:getRequestTail()
    Log:write('url=====111',url)
    Log:write('postData=====222',postData)
    Http:request('bindUserData', url, Msg.bindUser , {useCache=false, method='post', postData=postData})
end

function loginBycooperator(sprite)
    local reg_weibo = Reg:create(Reg.com_wondertek_cnlive2.weibo)
    local clickIndex = List:getItemIndex(Sprite:getParent(sprite))
    if clickIndex == 0 then
        setTopButtonStatus({0,1,0,0,0}, '关联新浪微博')
    else
        setTopButtonStatus({0,1,0,0,0}, '关联腾讯微博')
    end
    Reg:setInteger(reg_weibo, 'fromWhere', clickIndex + 1)
    Sprite:setEnable(contentListview, 0)
    Sprite:setVisible(contentListview, 0)
    guanlian = 1
    local getAuthUrl = Util:getServer() .. Sprite:getData(sprite) 
    Http:request('get_auth_url', getAuthUrl, Msg.weiboAuth, {useCache = false,method='post', postData = Util:getRequestTail()})
end

function playRecordItemOnLoad(list, item, index)
    Sprite:setProperty(item, "extendstyle", "1111")
    Sprite:setRect(item, 0, 0, 640, 110)
    local normalStatus = Sprite:findChild(item, 'normalStatus')
    local editStatus = Sprite:findChild(item, 'editStatus')
    local historyStatus = Sprite:findChild(normalStatus, 'historyStatus')
    local panelDeleteBtn = Sprite:findChild(editStatus, 'panelDeleteBtn')
    Sprite:setProperty(Sprite:findChild(normalStatus, 'recordName'), 'text', playRecordTable.playHistorys[index].contName)
    Sprite:setProperty(Sprite:findChild(normalStatus, 'recordPoint'), 'text', playRecordTable.playHistorys[index].updateTime)
    Sprite:setProperty(Sprite:findChild(editStatus, 'recordName'), 'text', playRecordTable.playHistorys[index].contName)
    Sprite:setProperty(Sprite:findChild(editStatus, 'recordPoint'), 'text', playRecordTable.playHistorys[index].updateTime)
    Sprite:setProperty(panelDeleteBtn, 'data',index)
    Log:write(playRecordTable.playHistorys[index].currTime,playRecordTable.playHistorys[index].totalTime)
    if playRecordTable.playHistorys[index].live ~= true then
        Sprite:setVisible(Sprite:findChild(item, 'panelPlayBtn'), 1)
        Sprite:setEnable(Sprite:findChild(item, 'panelPlayBtn'), 1)
	    if playRecordTable.playHistorys[index].currTime == playRecordTable.playHistorys[index].totalTime or playRecordTable.playHistorys[index].currTime == 0 then
	        Sprite:setProperty(historyStatus, 'text', '重新观看')
	    else
	        Sprite:setProperty(historyStatus, 'text', '继续观看')
	    end
	else
		Sprite:setVisible(Sprite:findChild(item, 'panelPlayBtn'), 0)
        Sprite:setEnable(Sprite:findChild(item, 'panelPlayBtn'), 0)
	end
    if historyStatus1 == 0 then
        setTopButtonStatus({1,0,1,0,0})
        Sprite:setVisible(normalStatus,1)
        Sprite:setEnable(normalStatus,1)
        Sprite:setVisible(editStatus,0)
        Sprite:setEnable(editStatus,0)
    else
        setTopButtonStatus({1,0,0,1,0})
        Sprite:setVisible(normalStatus,0)
        Sprite:setEnable(normalStatus,0)
        Sprite:setVisible(editStatus,1)
        Sprite:setEnable(editStatus,1)
    end
end

function playRecordItemOnLoad1(list, item, index)
    Sprite:setProperty(item, "extendstyle", "1111")
    Sprite:setRect(item, 0, 0, 640, 110)
    local normalStatus = Sprite:findChild(item, 'normalStatus')
    local editStatus = Sprite:findChild(item, 'editStatus')
    local historyStatus = Sprite:findChild(normalStatus, 'historyStatus')
    local panelPlayBtn = Sprite:findChild(normalStatus, 'panelPlayBtn')
    local panelDeleteBtn = Sprite:findChild(editStatus, 'panelDeleteBtn')
    Sprite:setProperty(panelPlayBtn, 'OnSelect', 'panelPlayBtnOnSelect1')
    Sprite:setProperty(Sprite:findChild(normalStatus, 'recordName'), 'text', playRecordTable[index+1].contName)
    Sprite:setProperty(Sprite:findChild(normalStatus, 'recordPoint'), 'text', playRecordTable[index+1].date)
    Sprite:setProperty(Sprite:findChild(editStatus, 'recordName'), 'text', playRecordTable[index+1].contName)
    Sprite:setProperty(Sprite:findChild(editStatus, 'recordPoint'), 'text', playRecordTable[index+1].date)
    Sprite:setProperty(panelDeleteBtn, 'data',index+1)
    if playRecordTable[index+1].live ~= '1' then
		Sprite:setVisible(Sprite:findChild(item, 'panelPlayBtn'), 1)
        Sprite:setEnable(Sprite:findChild(item, 'panelPlayBtn'), 1)
	    if playRecordTable[index+1].currTime == playRecordTable[index+1].totalTime or playRecordTable[index+1].currTime == 0 then
	        Sprite:setProperty(historyStatus, 'text', '重新观看')
	    else
	        Sprite:setProperty(historyStatus, 'text', '继续观看')
	    end
	else
		Sprite:setVisible(Sprite:findChild(item, 'panelPlayBtn'), 0)
        Sprite:setEnable(Sprite:findChild(item, 'panelPlayBtn'), 0)
	end
end

function panelPlayBtnOnSelect(sprite)
	local panelPlayBtn = Sprite:findChild(rootSprite,'panelPlayBtn')
	local index = ListView:getItemIndex(Sprite:getParent(Sprite:getParent(sprite)))
	Log:write('0000000000000000000',index)
	local reg = Reg:create(Reg.com_wondertek_cnlive2.play)
	--Reg:setString(reg,'nid',playRecordTable.playHistorys[index].nodeId or '')
	--Reg:setString(reg,'livingName',playRecordTable.playHistorys[index].contName or '')
	Reg:setString(reg,'playopenUrl',playRecordTable.playHistorys[index].playUrl or '')
	Reg:setString(reg,'isLive','0')
	--Reg:setString(reg,'cid',playRecordTable.playHistorys[index].contId or '')
	Log:write('wwwwwwwwwwwwwwwwwwwwwwwwwwwww',tonumber(playRecordTable.playHistorys[index].currTime))
	Reg:setNumber(reg,'currTime',tonumber(playRecordTable.playHistorys[index].currTime) or 0)
	--local netType = Http:getCurConnect()
    --Log:write('netType===openUrl',netType)
    --if netType ~= 'WLAN' then
      -- Log:write('netType=不等于==wlan')
       --Dialog.propTable.okBtn.text = '继续观看'
       --Dialog:show('', '您现在是非WiFi状态，为了节省流量费，建议调整为WiFi网络', 'ok_cancel', 'startPlayButtonOnSelect')
      -- Dialog.propTable.okBtn.text = '确定'
      -- return
    --end
    -- 判断网络是否是wifi
	    local wifiTips_reg = Reg:create("wifiTips")
		local continueTips = Reg:getString(wifiTips_reg,'continueTips')
		if continueTips ~= '0' then
	        local netType = Http:getCurConnect()
	        Log:write('netType===openUrl',netType)
	        if netType ~= 'WLAN' then
	           Log:write('netType=不等于==wlan')
	           notWifiTipsDialogShow()
	           return
	        end
		end
	Scene:setReturn(Alias.personalcenter,Alias.play)
	Scene:go(Alias.play)
end

function startPlayButtonOnSelect()
    Scene:setReturn(Alias.personalcenter,Alias.play)
	  Scene:go(Alias.play)
end

function panelPlayBtnOnSelect1(sprite)
	local panelPlayBtn = Sprite:findChild(rootSprite,'panelPlayBtn')
	local index = ListView:getItemIndex(Sprite:getParent(Sprite:getParent(sprite)))
	Log:write('0000000000000000000',index)
	local reg = Reg:create(Reg.com_wondertek_cnlive2.play)
	Reg:setString(reg,'playopenUrl',Util:getServer()..'clt/play.msp?c='..playRecordTable[index+1].contId or '')
	Reg:setString(reg,'isLive','0')
	--Reg:setString(reg,'cid',playRecordTable.playHistorys[index].contId or '')
	Log:write('wwwwwwwwwwwwwwwwwwwwwwwwwwwww',tonumber(playRecordTable[index+1].currTime))
	Reg:setNumber(reg,'currTime',tonumber(playRecordTable[index+1].currTime) or 0)
	--local netType = Http:getCurConnect()
	  --Log:write('netType===openUrl',netType)
	  --if netType ~= 'WLAN' then
	     --Log:write('netType=不等于==wlan')
	     --Dialog.propTable.okBtn.text = '继续观看'
	     ---Dialog:show('', '您现在是非WiFi状态，为了节省流量费，建议调整为WiFi网络', 'ok_cancel', 'startPlayButtonOnSelect')
	     --Dialog.propTable.okBtn.text = '确定'
	     --return
	  --end
	-- 判断网络是否是wifi
    local wifiTips_reg = Reg:create("wifiTips")
	local continueTips = Reg:getString(wifiTips_reg,'continueTips')
	if continueTips ~= '0' then
        local netType = Http:getCurConnect()
        Log:write('netType===openUrl',netType)
        if netType ~= 'WLAN' then
           Log:write('netType=不等于==wlan')
           notWifiTipsDialogShow()
           return
        end
	end
	Scene:setReturn(Alias.personalcenter,Alias.play)
	Scene:go(Alias.play)
end

function myCommentItemOnLoad(list, item, index)
    Sprite:setProperty(item, "extendstyle", "1111")
    Sprite:setRect(item, 0, 0, 640, 100)
    local normalStatus = Sprite:findChild(item, 'normalStatus')
    local editStatus = Sprite:findChild(item, 'editStatus')
    local panelDeleteBtn = Sprite:findChild(editStatus, 'panelDeleteBtn')
    Sprite:setProperty(Sprite:findChild(normalStatus, 'commentName'), 'text', myCommlist.commentList[index].objectName)
    Sprite:setProperty(Sprite:findChild(normalStatus, 'programName'), 'text', myCommlist.commentList[index].content)
    Sprite:setProperty(Sprite:findChild(normalStatus, 'commentTime'), 'text', myCommlist.commentList[index].updateTime)
    Sprite:setProperty(Sprite:findChild(editStatus, 'commentName'), 'text', myCommlist.commentList[index].objectName)
    Sprite:setProperty(Sprite:findChild(editStatus, 'programName'), 'text', myCommlist.commentList[index].content)
    Sprite:setProperty(Sprite:findChild(editStatus, 'commentTime'), 'text', myCommlist.commentList[index].updateTime)
    Sprite:setProperty(panelDeleteBtn, 'data', myCommlist.commentList[index].delUrl)
end

function skinAreaNodeOnLoad(list, item, index)
    Sprite:setProperty(item, "extendstyle", "1111")
    Sprite:setRect(item, 0, 0, 640, 890)
    local skinTypeList = Sprite:findChild(item, 'skinTypeList')
    local skinTypeItem = Sprite:findChild(item, 'skinTypeItem')
    List:loadItem(skinTypeList, skinTypeItem, 1, 'skinTypeItemOnLoad')
    List:adjust(skinTypeList)
end

function aboutAreaNodeOnLoad(list, item, index)
    aboutItem = item
    Sprite:setProperty(item, "extendstyle", "1111")
    local textAreaNode = Sprite:findChildByClass(item, 'textarea')
    local buttonArea = Sprite:findChild(item, 'buttonArea')
    Sprite:setProperty(textAreaNode, "text", aboutContent)
    local _, _, _, textAreaHeight = Sprite:getRect(textAreaNode)
    Sprite:setRect(buttonArea, 170, textAreaHeight + 100, 297, 164)
    Sprite:setRect(item, 0, 0, 640, textAreaHeight + 284 > 890 and textAreaHeight + 284 or 890 )
end

function skinTypeItemOnLoad(list, item, index)
    local skinTypeImageTable = {'file://image/skin_default.png', 'file://image/skin_red.png', 'file://image/skin_gold.png', 'file://image/skin_green.png'}
    local skinTypeNameTable = {'默认', '红砖', '金色', '绿草'}
    Sprite:setProperty(item, "extendstyle", "1111")
    Sprite:setRect(item, 0, 0, 230, 230)
    Sprite:setProperty(Sprite:findChildByClass(item, 'label'), "text", skinTypeNameTable[index + 1])
    Sprite:setProperty(Sprite:findChild(item, 'skinImage'), "src", skinTypeImageTable[index + 1])
    if index == 0 then
        Sprite:setEnable(Sprite:findChildByClass(item, 'button'), 0)
        prePanelSkinBtn = Sprite:findChildByClass(item, 'button')
    end
end

function topBarEdtBtnOnSelect(sprite)
    historyStatus1 = 1
    changeListItemStatus('edit')
end

function topBarFinBtnOnSelect(sprite)
    historyStatus1 = 0
    if curSubAreaIndex == 5 then
        Tips:show('皮肤设置完成')
    elseif curSubAreaIndex == 7 then
        submitMyAdv()
    else
        changeListItemStatus('normal')
    end
end

function showOrHideDelBtn(sprite)
Log:write('wwwwwwwwwwwwwwwwwwwwwwwww')
    if preButton ~= 0 and preButton ~= sprite then
        Log:write('3333333333333333333333')
        changeDelEnable(preButton, 0)
    end
    if Sprite:getData(sprite) == '0' then
        Log:write('4444444444444444444444')
        changeDelEnable(sprite, 1)
    else
        Log:write('55555555555555555555555555')
        changeDelEnable(sprite, 0)
    end
    preButton = sprite
end

function panelSkinTypeBtnOnSelect(sprite)
    Sprite:killFocus(sprite)
    Sprite:releaseCapture(sprite)
    Sprite:setEnable(sprite, 0)
    Sprite:setEnable(prePanelSkinBtn, 1)
    prePanelSkinBtn = sprite
end

function deleteHistoryBtnOnSelect(sprite)  
    local index = tonumber(Sprite:getData(sprite))
    Log:write('ddddddddddddddddddddddddd',index)
    local reg_authority = Reg:create('authority')
    local userStatus = Reg:getInteger(reg_authority, 'userStatus')
    local account,password = getAccountAndPasswordFromLocal()
    if userStatus == 0 then
        ListView:removeItem(contentListview, ListView:getItem(contentListview,index))
        local reg = Reg:create(Reg.com_wondertek_cnlive2.history)
        local fileName = 'USERDATA:\\history1.xml'
        Reg:load(reg, fileName)
        local historyContent = Reg:getString(reg, 'historyContent')
        Log:write('historyContent', historyContent)
        Reg:setString(reg, 'historyContent', string.gsub(historyContent, playRecordTable[index].contId .. ',', ''))
        Reg:remove(reg, playRecordTable[index].contId)
        Reg:save(reg, 'USERDATA:\\history1.xml')
        preButton = 0
	    createHistoryList() 
	    changeListItemStatus('edit')
	    Tips:show('删除成功！')
    else
        preButton = 0
        local delHistoryUrl = Util:getServer()..'clt/removeHistory.msp'
        local postData = 'loginName='..account..'&c='..playRecordTable.playHistorys[index].contId..Util:getRequestTail()
        Log:write('aaaaaaaaaaaaaaaaaaaaa',account,playRecordTable.playHistorys[index].contId)
        Http:request('delHistoryData',delHistoryUrl,Msg.delHistory,{useCache=false,method ="post",postData=postData})
    end
    
end


function deleteBookingBtnOnSelect(sprite)
    local videoId = Sprite:getData(sprite)
    Log:write('videoId', videoId)
    delMyBooking(videoId)
    preButton = 0
    --setPanelStatusBar(1)
    createBookingList()
    changeListItemStatus('edit')
    
    DeleteAppointment(videoId)
    --Tips:show('成功删除一条预约！')
end

function deleteCommentBtnOnSelect(sprite)
	Sprite:killFocus(sprite)
	Sprite:releaseCapture(sprite)
	local reg_authority = Reg:create('authority')
    local userStatus = Reg:getInteger(reg_authority, 'userStatus')
    if userStatus == 0 then       
    	Tips:show('您尚未登录！')
    else
		local commIndex = ListView:getItemIndex(Sprite:getParent(Sprite:getParent(sprite)))
		Log:write('commIndex===', commIndex)
		local account,password = getAccountAndPasswordFromLocal()
	    local delCommDataUrl = Util:getServer()..'clt/removeComment.msp'
	    Http:request('delData',delCommDataUrl,106,{useCache = false,method = 'post',postData='loginName='..account..'&c='..myCommlist.commentList[commIndex].id..Util:getRequestTail()})   
	end   
    --local objectName = Sprite:getData(sprite)
    --Log:write('objectName', objectName)
    --local reg = Reg:create(Reg.com_wondertek_cnlive2.comment)
    --local fileName = 'USERDATA:\\comment.xml'
    --Reg:load(reg, fileName)
    --local commentContent = Reg:getString(reg, 'content')
    --Log:write('content', content)
    --Reg:setString(reg, 'content', string.gsub(commentContent, objectName .. ',', ''))
    --Reg:remove(reg, objectName)
    --Reg:save(reg, 'USERDATA:\\comment.xml')
    
end

function topBarRetBtnOnSelect(sprite)
    Sprite:setEnable(topReturnButton , 1)
    if curSubAreaIndex == 1 and curAccountStep == 5 then
        setTopButtonStatus({0,1,0,0,1}, '登录')
        setCurAccountStep(2)
    else
        ListView:removeAllItems(contentListview, 1, 1)
        setCommonMenuStatus(1)
        Sprite:setEnable(area1, 0)
        Sprite:setVisible(area1, 0)
        Sprite:setEnable(area0, 1)
        Sprite:setVisible(area0, 1)
        
        setTopButtonStatus({0,0,0,0,0})
    end
end

function topBarCanBtnOnSelect(sprite)
	if myAccountflag == 1 then
	    if WebBrowser:isBrowserRun() == 1 then 
	        WebBrowser:showWebBrowser(0)
	        WebBrowser:release()
	        Sprite:setEnable(contentListview, 1)
            Sprite:setVisible(contentListview, 1)
            setTopButtonStatus({0,1,0,0,1}, '登录')
	        return
	    end
		Scene:back()
	else
	    if curSubAreaIndex == 7 then
	        setAdvAreaStatus(0)
	        setTopButtonStatus({1,0,0,0,0}, '关于')
	    elseif curSubAreaIndex == 1 and (curAccountStep == 1 or curAccountStep == 4 or curAccountStep == 6 ) then
	        setTopButtonStatus({0,1,0,0,1}, '登录')
	        setCurAccountStep(2)
	    elseif guanlian == 1 then
	        if WebBrowser:isBrowserRun() == 1 then 
	            WebBrowser:showWebBrowser(0)
	            WebBrowser:release()
	        end
	        Sprite:setEnable(contentListview, 1)
	        Sprite:setVisible(contentListview, 1)
	        setTopButtonStatus({0,1,0,0,1}, '登录')
	        guanlian = 0
	    else
	        topBarRetBtnOnSelect()
	    end 
	end
end

function chatDetailOnTextChanged1(sprite)
	local chatTips1 = Sprite:findChild(rootSprite, 'chatTips1')
    if Sprite:getText(sprite)=='' then
        Sprite:setVisible(chatTips1, 1)
    	  Sprite:setEnable(chatTips1, 1)
    else 
        Sprite:setVisible(chatTips1, 0)
    	  Sprite:setEnable(chatTips1, 0)
    end
end

-- @brief 键盘高度变化
function chatOnKeyboardSizeChanged1(sprite, nHeight)
    shurufaHeight = nHeight
    Log:write('shurufaHeight==111=',shurufaHeight)
    local chatTips1 = Sprite:findChild(rootSprite, 'chatTips1')
    -------------出现光标，文字消失---------------
    if nHeight ~= 0 then	
    	Sprite:setVisible(chatTips1, 0)
    	Sprite:setEnable(chatTips1, 0)
    end
end

function chatDetailOnTextChanged2(sprite)	
	local chatTips2 = Sprite:findChild(rootSprite, 'chatTips2')
    if Sprite:getText(sprite)=='' then
        Sprite:setVisible(chatTips2, 1)
    	  Sprite:setEnable(chatTips2, 1)
    else
        Sprite:setVisible(chatTips2, 0)
    	  Sprite:setEnable(chatTips2, 0)
    end
end 

-- @brief 键盘高度变化
function chatOnKeyboardSizeChanged2(sprite, nHeight)
    shurufaHeight = nHeight
    Log:write('shurufaHeight==111=',shurufaHeight)
    local chatTips2 = Sprite:findChild(rootSprite, 'chatTips2')
    -------------出现光标，文字消失---------------
    if nHeight ~= 0 then	
    	Sprite:setVisible(chatTips2, 0)
    	Sprite:setEnable(chatTips2, 0)
    end
end

function chatDetailOnTextChanged3(sprite)	
	local chatTips3 = Sprite:findChild(rootSprite, 'chatTips3')
    if Sprite:getText(sprite)=='' then
        Sprite:setVisible(chatTips3, 1)
    	  Sprite:setEnable(chatTips3, 1)
    else
        Sprite:setVisible(chatTips3, 0)
    	  Sprite:setEnable(chatTips3, 0)
    end
end

-- @brief 键盘高度变化
function chatOnKeyboardSizeChanged3(sprite, nHeight)
    shurufaHeight = nHeight
    Log:write('shurufaHeight==111=',shurufaHeight)
    local chatTips3 = Sprite:findChild(rootSprite, 'chatTips3')
    -------------出现光标，文字消失---------------
    if nHeight ~= 0 then	
    	Sprite:setVisible(chatTips3, 0)
    	Sprite:setEnable(chatTips3, 0)
    end
end

function chatDetailOnTextChanged4(sprite)	
	local chatTips4 = Sprite:findChild(rootSprite, 'chatTips4')
    if Sprite:getText(sprite)=='' then
        Sprite:setVisible(chatTips4, 1)
    	  Sprite:setEnable(chatTips4, 1)
    else
        Sprite:setVisible(chatTips4, 0)
    	  Sprite:setEnable(chatTips4, 0)
    end
end

-- @brief 键盘高度变化
function chatOnKeyboardSizeChanged4(sprite, nHeight)
    shurufaHeight = nHeight
    Log:write('shurufaHeight==111=',shurufaHeight)
    local chatTips4 = Sprite:findChild(rootSprite, 'chatTips4')
    -------------出现光标，文字消失---------------
    if nHeight ~= 0 then	
    	Sprite:setVisible(chatTips4, 0)
    	Sprite:setEnable(chatTips4, 0)
    end
end

function chatDetailOnTextChanged5(sprite)	
	local chatTips5 = Sprite:findChild(rootSprite, 'chatTips5')
    if Sprite:getText(sprite)=='' then
        Sprite:setVisible(chatTips5, 1)
    	  Sprite:setEnable(chatTips5, 1)
    else
        Sprite:setVisible(chatTips5, 0)
    	  Sprite:setEnable(chatTips5, 0)
    end
end

-- @brief 键盘高度变化
function chatOnKeyboardSizeChanged5(sprite, nHeight)
    shurufaHeight = nHeight
    Log:write('shurufaHeight==111=',shurufaHeight)
    local chatTips5 = Sprite:findChild(rootSprite, 'chatTips5')
    -------------出现光标，文字消失---------------
    if nHeight ~= 0 then	
    	Sprite:setVisible(chatTips5, 0)
    	Sprite:setEnable(chatTips5, 0)
    end
end

function advInputOnTextChanged(sprite,fontCount)
	local advTips = Sprite:findChild(rootSprite, 'advTips')
    if Sprite:getText(sprite)=='' then
        Sprite:setVisible(advTips, 1)
    	Sprite:setEnable(advTips, 1)
    else
        Sprite:setVisible(advTips, 0)
    	Sprite:setEnable(advTips, 0)
    end
    if fontCount == 250 then
        Tips:show('不能再输入字符了！')
    end
end

-- @brief 键盘高度变化
function chatOnKeyboardSizeChanged6(sprite, nHeight)
    shurufaHeight = nHeight
    Log:write('shurufaHeight==111=',shurufaHeight)
    local advTips = Sprite:findChild(rootSprite, 'advTips')
    -------------出现光标，文字消失---------------
    if nHeight ~= 0 then	
    	Sprite:setVisible(advTips, 0)
    	Sprite:setEnable(advTips, 0)
    end
end

function loginBtnOnSelect(sprite)
    local account, password = getAccountAndPasswordFromEdit(Sprite:getParent(Sprite:getParent(sprite)))
    checkAccountAndPassword(account, password)
end

function registerNewAccentOnSelect(sprite)
    setCurAccountStep(1)
    setTopButtonStatus({0,1,0,0,0},'注册')
end

function userInfoManaBtnOnSelect(sprite)
    Scene:setReturn(Scene:getNameByHandle(), Alias.accountmgr)
    Scene:go(Alias.accountmgr,true)
end

function loginOffBtnOnSelect(sprite)
    local logoutUrl = Util:getServer()..'clt/logout.msp'
    local account, password = getAccountAndPasswordFromLocal()
    Http:request('logoutData',logoutUrl,Msg.loginout,{useCache = false, method = 'post', postData = 'loginName='..account..Util:getRequestTail()})
    
end

function submitAccount(sprite)
    local accountEdit = Sprite:findChildByClass(Sprite:getParent(sprite),'edit')
    local account = Sprite:getText(accountEdit)
    if account == '' then
        Tips:show('请输入帐号！')
        return
    end
    local url = Util:getServer()..'clt/findPassword.msp'
    local postData = 'loginName='..account..Util:getRequestTail()
    Http:request('findPassword',url,Msg.findPassword,{useCache=false,method="post",postData=postData})
end

function setCurAccountStep(index)
    ListView:removeAllItems(contentListview, 1, 1)
    curAccountStep = index
    local accountItemTable = {accountRegisterNode, accountLoginNode, accountLoginImfoNode, accountFindPasswordNode, accountFindResultNode, accountAuthorityNode1}
    local onLoadFunction = {'accountNodeOnLoad', 'accountLoginNodeOnLoad', 'accountNodeOnLoad', 'accountNodeOnLoad', 'accountNodeOnLoad', 'accountNodeOnLoad'}
    ListView:loadItem(contentListview, accountItemTable[index], 1, onLoadFunction[index])
    ListView:adjust(contentListview)
end

-- @brief 登录时，验证用户名和密码是否正确
function checkAccountAndPassword(account, password)
    g_account = account
    g_password = password
    local url = Util:getServer() .. 'clt/login.msp'
    local postData = 'loginName=' .. account .. '&psw=' .. password .. '&type=0'
    Log:write('account',account)
    Http:request('per_login', url, Msg.login , {useCache=false, method ='post', postData=postData.. Util:getRequestTail()})
end

-- @brief 该方法用于注册用户信息到服务器
function saveUserAccountAndPasswordToServer(account, password,password2)
    g_account = account
    g_password = password
    if account == '' then
        Tips:show('请输入帐号')
        return
    end
    if password == '' or password2 == '' then
        Tips:show('请输入密码')
        return
    end
    local url = Util:getServer() .. 'clt/register.msp'
    local postData = 'loginName=' .. account .. '&psw=' .. password .. '&psw2=' .. password2 ..Util:getRequestTail()
    Http:request('per_reg', url, Msg.register , {useCache=false, method ='post', postData=postData.. Util:getRequestTail()})
end

----------帐号退出时同时清除本地的用户文件---------------
function delAccount(account,password,nikeName)
    local reg = Reg:create(Reg.com_wondertek_cnlive2.accountmgr)
    local userAccountFilePath = 'USERDATA:\\userAccountServer.xml'
    Reg:load(reg, userAccountFilePath)
    Reg:remove(reg, account)
    Reg:remove(reg, password)
    --Reg:remove(reg, nikeName)
    Reg:save(reg, userAccountFilePath)
end

function changeListItemStatus(status)
    if status == 'edit' then
        setTopButtonStatus({1,0,0,1,0})
    else
        setTopButtonStatus({1,0,1,0,0})
        if preButton ~= 0 then
            changeDelEnable(preButton, 0)
        end
        preButton = 0
    end
    for i= 0,ListView:getItemCount(contentListview)-1 do
        local item = ListView:getItem(contentListview, i)
        if status == 'edit' then
            Sprite:setVisible(Sprite:findChild(item, 'normalStatus'), 0)
            Sprite:setEnable(Sprite:findChild(item, 'normalStatus'), 0)
            Sprite:setVisible(Sprite:findChild(item, 'editStatus'), 1)
            Sprite:setEnable(Sprite:findChild(item, 'editStatus'), 1)
        else
            Sprite:setVisible(Sprite:findChild(item, 'normalStatus'), 1)
            Sprite:setEnable(Sprite:findChild(item, 'normalStatus'), 1)
            Sprite:setVisible(Sprite:findChild(item, 'editStatus'), 0)
            Sprite:setEnable(Sprite:findChild(item, 'editStatus'), 0)
        end
    end
    ListView:adjust(contentListview)
end

-- @brief 设置顶部按钮状态
-- @param table statusTable: 按照“返回”，“取消”，“编辑”，“完成”，“找密码”顺序设置。如{0,0,1,0,0}表示显示“编辑”按钮，其余隐藏
-- @param table titleName: 顶部标题名，可省略
function setTopButtonStatus(statusTable, titleName)
    local TopButtonNameTable = {'topBarRetBtn', 'topBarCanBtn', 'topBarEdtBtn', 'topBarFinBtn', 'topBarPsdBtn'}
    for i= 1, #TopButtonNameTable do
        local topBtn = Sprite:findChild(topStatusBar, TopButtonNameTable[i])
        Sprite:setVisible(topBtn, statusTable[i])
        Sprite:setEnable(topBtn, statusTable[i])
    end
    if titleName and type(titleName) == 'string' then
        Sprite:setProperty(Sprite:findChild(topStatusBar, 'topBartitle'), 'text', titleName)
    end
end

function changeDelEnable(btn, flag)
    local panelDeleteBtn = Sprite:findChild(Sprite:getParent(btn), 'panelDeleteBtn')
    local editIcoImage = Sprite:findChildByClass(btn, 'image')
    Log:write('ggggggggggggggggggggggggggggggggggggggg',btn,flag,panelDeleteBtn,editIcoImage)
    if flag == 0 then
        Sprite:setProperty(editIcoImage, 'src', 'file://image/panel_edit_off.png')
    else
        Sprite:setProperty(editIcoImage, 'src', 'file://image/panel_edit_on.png')
    end
    Sprite:setVisible(panelDeleteBtn, flag)
    Sprite:setEnable(panelDeleteBtn, flag)
    Sprite:setProperty(btn, 'data', flag)
end

-- @brief 新手引导panoramaitem的OnSelect事件
function panoramaItemOnSelect(sprite)
    Log:write('panoramaItemOnSelect')
    local panorama = Sprite:getParent(sprite)
    local index = Panorama:getCurItem(panorama)
    setPanoramaForeground(Sprite:findChild(panorama, 'foregroundList'), index)
    if index == Panorama:getItemCount(panorama) - 1 then
        Sprite:setVisible(Sprite:findChild(sprite, 'startUse'), 1)
        Sprite:setEnable(Sprite:findChild(sprite, 'startUse'), 1)
    end
end

function panoramaOnMouseDown(sprite, x, y)
    mouseX, mouseY = x, y
    return 0
end

function panoramaOnMouseMove(sprite, x, y)
    moveX, moveY = x, y
    return 0
end

function panoramaOnMouseUp(sprite, x, y)
    Sprite:releaseCapture(sprite)
    local diffX = mouseX - x
    local diffY = mouseY - y
    if diffX >= 50 and math.abs(diffX) >= math.abs(diffY) then -- 下一张图片
        local panoramaItem = Sprite:getParent(sprite)
        local index = Panorama:getItemIndex(panoramaItem)
        if index == Panorama:getItemCount(Sprite:getParent(panoramaItem)) - 1 then
            Panorama:setCurItem(panoramaNew, 0)
            Sprite:setVisible(panoramaNew, 0)
            Sprite:setEnable(panoramaNew, 0)
            setCommonMenuStatus(1)
        end
    end
    return 0
end

-- @brief 开始使用按钮的OnSelect事件
function startUseOnSelect(sprite)
    Log:write('startUseOnSelect')
    local panoramaItem = Sprite:getParent(sprite)
    local index = Panorama:getItemIndex(panoramaItem)
    if index == Panorama:getItemCount(Sprite:getParent(panoramaItem)) - 1 then
        Panorama:setCurItem(panoramaNew, 0)
        Sprite:setVisible(panoramaNew, 0)
        Sprite:setEnable(panoramaNew, 0)
        setCommonMenuStatus(1)
    end
end


-- @brief 创建panorama的标识点
function createPanoramaForeground(list, count)
    Log:write('createPanoramaForeground================')
    local _, y, _, h = Sprite:getRect(list)
    local w1 = (12*count+24*(count-1))
    local x1 = 180+(281-w1)/2
    for i = 1, count do
        local item = Sprite:create('listitem', list)
        local img = Sprite:create('image', item)
        Sprite:setRect(item, 0, 0, 12, 12)
        Sprite:setProperty(item, 'extendstyle', '0000')
        Sprite:setRect(img, 0, 0, 12, 12)
        Sprite:setProperty(img, 'extendstyle', '0000')
        Sprite:setName(img, 'img')
        Sprite:setProperty(img, 'src', 'file://image/home_point.png')
        Sprite:setProperty(img, 'style', 'autosize')
        List:addItem(list, item)
    end
    Sprite:setRect(list, x1, y, w1, h)
    Sprite:setProperty(list, 'extendstyle', '0000')
    List:adjust(list)
    setPanoramaForeground(list, 0)
end

-- @brief 设置panorama当前第几页的标识点
function setPanoramaForeground(list, index)
    if lastPanoramaPointIndex then
        Sprite:setProperty(Sprite:findChild(List:getItem(list, lastPanoramaPointIndex), 'img'),
            'src', 'file://image/home_point.png')
    end
    Sprite:setProperty(Sprite:findChild(List:getItem(list, index), 'img'),
        'src', 'file://image/home_point_focus.png')
    lastPanoramaPointIndex = index
end

function zhaomimachatOnKeyboardSizeChanged(sprite, nHeight)
    local findPassWordOnSelecttips = Sprite:findChild(rootSprite,'findPassWordOnSelecttips')
    Sprite:setVisible(findPassWordOnSelecttips,0)       
end

function zhaomimaeditOnTextChanged(sprite)
    local findPassWordOnSelecttips = Sprite:findChild(rootSprite, 'findPassWordOnSelecttips')
    if Sprite:getText(sprite)=='' then
        Sprite:setVisible(findPassWordOnSelecttips, 1)
    	  Sprite:setEnable(findPassWordOnSelecttips, 1)
    else
        Sprite:setVisible(findPassWordOnSelecttips, 0)
    	  Sprite:setEnable(findPassWordOnSelecttips, 0)
    end
end

    ]]>
</root>
