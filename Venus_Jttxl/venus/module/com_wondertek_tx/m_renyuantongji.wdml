<?xml version="1.0" encoding="utf-8"?>
<!--
 == ============================================================================
 == | WonderTek [ 网络无处不在，沟通及时到达 ]
 == ============================================================================
 == | Copyright (c) 2012, WonderTek, Inc. All Rights Reserved.
 == ============================================================================
 == | Author: hewu <hewu2008@gmail.com>
 == ============================================================================
 == | Desc: 页面描述
 == ============================================================================
-->
<root>
    <header/>
    <body resolution="480,800" BuildChildrenFinished="bodyBuildChildrenFinished"
        OnSpriteEvent="bodyOnSpriteEvent" OnPluginEvent="bodyOnPluginEvent">
        <!-- 主节点  -->
        <node name="mainNode" rect="0,0,480,800" enable="true" 
            active="true" OnKeyUp="mainNodeOnKeyUp" layouttype="1" extendstyle="1111">
	        <!-- 设置背景 -->
	        <image rect="0,80,480,720" src="file://image/jttxl/bj.png" style="autosize"
	           extendstyle="1111" />
            <!-- 设置头部 -->
            <node name="baseSprite" rect="0,0,480,80" extendstyle="1111">
				 <image name="title" rect="0,0,480,80" border="false" src="file://image/jttxl/top.png" 
				    style="autosize" extendstyle="1111">
					<label rect="0,0,480,80" text="集团联系人" color="#ffffff" v-align="center"  
					   h-align="center" font-family="微软雅黑" font-size="32" extendstyle="1111" />
				 </image>
                 <!--
				 <button name="gosearchBtn" rect="400,17,49,47" OnSelect="goSearchPage" normal="normal" visible="true"
                        sel="sel" style="autosize" extendstyle="1111">
                        <node name="normal" extendstyle="1111">
                            <image rect="0,0,49,47" src="file://image/jttxl/top_search_d.png" style="autosize" extendstyle="1111" />
                        </node>
                        <node name="sel" extendstyle="1111">
                            <image rect="0,0,49,47" src="file://image/jttxl/top_search_s.png" style="autosize" extendstyle="1111" />
                        </node>
                 </button>
                 -->
            </node>

            <button name="showmapBtn" rect="0,66,480,534" data="0,0,20,20" extendstyle="1111" enable="true"
                OnSelect="OnSelectShowMap">
            </button>
            
            <!-- 地图部分   -->
            <node rect="0,135,480,534" extendstyle="0011">
                 <image rect="20,0,440,534" border="false" src="file://image/map.png" 
                   style="autosize" extendstyle="0011"/>
                 <image rect="360,-10,76,96" border="false" src="file://image/map/anhui_d.png" 
                   style="autosize" extendstyle="0011"/>
                 <button name="btnHefei" rect="213,255,64,103" data="hefei" extendstyle="1111" 
                    normal="" sel="" OnSelect="doRegionClick" >
                    <button rect="3,24,86,49" data="hefei" extendstyle="1111" 
                        normal="" sel="" OnSelect="doRegionClick" ></button>
                 </button>
                 <button  rect="360,-20,80,103" data="anhui" extendstyle="1111" 
                    normal="" sel="" OnSelect="doRegionClick" ></button>
                 <button rect="198,124,91,60" data="bengbu" extendstyle="1111" 
                    normal="" sel="" OnSelect="doRegionClick" ></button>
                 <button rect="323,336,39,54" data="wuhu" extendstyle="1111" 
                    normal="" sel="" OnSelect="doRegionClick" ></button>
                 <button rect="313,273,75,57" data="maanshan" extendstyle="1111" 
                    normal="" sel="" OnSelect="doRegionClick" ></button>
                 <button rect="112,85,55,93" data="bozhou" extendstyle="1111" 
                    normal="" sel="" OnSelect="doRegionClick" ></button>
                 <button rect="172,75,33,58" data="huaibei" extendstyle="1111" 
                    normal="" sel="" OnSelect="doRegionClick" ></button>
                 <button rect="211,43,109,98" data="suzhou" extendstyle="1111" 
                    normal="" sel="" OnSelect="doRegionClick" ></button>
                 <button rect="14,142,95,78" data="fuyang" extendstyle="1111" 
                    normal="" sel="" OnSelect="doRegionClick" ></button>
                 <button rect="157,174,62,39" data="huainan" extendstyle="1111" 
                    normal="" sel="" OnSelect="doRegionClick" ></button>
                 <button rect="255,170,142,93" data="chuzhou" extendstyle="1111" 
                    normal="" sel="" OnSelect="doRegionClick" ></button>
                 <button rect="59,230,121,129" data="liuan" extendstyle="1111" 
                    normal="" sel="" OnSelect="doRegionClick" ></button>
                 <button rect="83,365,121,110" data="anqing" extendstyle="1111" 
                    normal="" sel="" OnSelect="doRegionClick" ></button> 
                 <button rect="223,404,64,56" data="chizhou" extendstyle="1111" 
                    normal="" sel="" OnSelect="doRegionClick" ></button>
                 <button rect="357,362,108,96" data="xuancheng" extendstyle="1111" 
                    normal="" sel="" OnSelect="doRegionClick" ></button>
                 <button rect="264,448,124,77" data="huangshan" extendstyle="1111" 
                    normal="" sel="" OnSelect="doRegionClick" ></button>
                 <button rect="277,357,43,37" data="tongling" extendstyle="1111" 
                    normal="" sel="" OnSelect="doRegionClick" ></button>
            </node>
            
            <!-- 弹出提示部分  -->
            <node name="cityNode" rect="0,135,480,534" extendstyle="0011" 
                enable="false" visible="false">
                <button rect="20,0,440,534" data="0,0,20,20" extendstyle="1111" 
                    OnSelect="hideCityNode">
                    <image rect="0,0,440,534" src="file://image/map_bg.png" 
                        style="autosize" alpha="150" extendstyle="1111" >
                    </image>
                    <image name="anhuiBgImg" rect="340,-10,76,96" src="file://image/map/anhui_d.png" 
                        style="autosize" alpha="150" visiable="true" extendstyle="1111"/>
                </button>
                <!-- 安徽省  -->
                <image name="anhui" rect="360,-10,76,96" border="false" extendstyle="1111" 
                    src="file://image/map/anhui_s.png" visible="false" 
                    style="autosize">
                    <label rect="0,0,167,227" text="安徽" h-align="center"
                        v-align="center" color="#ffffff" font-family="微软雅黑" 
                        font-size="22">
                    </label>
                </image>
                <!-- 合肥  -->
                <image name="hefei" rect="164,178,167,227" border="false" extendstyle="1111" 
	                src="file://image/hefei_on.png" visible="false" 
	                style="autosize">
                    <label rect="0,0,167,227" text="合肥" h-align="center"
	                    v-align="center" color="#ffffff" font-family="微软雅黑" 
	                    font-size="22">
                    </label>
                </image>
                <!-- 蚌埠  -->
                <image name="bengbu" rect="170,100,170,110" visible="false" 
                    border="false" extendstyle="1111" 
                    src="file://image/bengbu_on.png" style="autosize">
                    <label rect="0,0,170,110" text="蚌埠" h-align="center"
	                    v-align="center" color="#ffffff" font-family="微软雅黑" 
	                    font-size="22">
                    </label>
                </image>
                <!-- 芜湖  -->
                <image name="wuhu" rect="220,310,190,120" visible="false" 
                    border="false" extendstyle="1111" src="file://image/wuhu_on.png" 
                    style="autosize">
                    <label rect="100,0,50,80" text="芜湖" h-align="center"
                        v-align="center" color="#ffffff" font-family="微软雅黑" 
                        font-size="22">
                    </label>
                </image>
                <!-- 马鞍山  -->
                <image name="maanshan" rect="293,255,100,100" 
                    visible="false" border="false" extendstyle="1111" 
                    src="file://image/maanshan_on.png" style="autosize">
                    <label rect="0,0,100,100" text="马鞍山" h-align="center"
                        v-align="center" color="#ffffff" font-family="微软雅黑" 
                        font-size="22">
                    </label>
                </image>
                <!-- 亳州  -->
                <image name="bozhou" rect="67,40,145,155" visible="false" 
                    border="false" extendstyle="1111" 
                    src="file://image/bozhou_on.png" style="autosize">
                    <label rect="0,0,145,155" text="亳州" h-align="center"
                        v-align="center" color="#ffffff" font-family="微软雅黑" 
                        font-size="22">
                    </label>
                </image>
                <!-- 淮北  -->
                <image name="huaibei" rect="150,35,65,120" visible="false" 
                    border="false" extendstyle="1111" src="file://image/huaibei_on.png" 
                    style="autosize">
                    <label rect="0,0,65,120" text="淮北" h-align="center"
                        v-align="center" color="#ffffff" font-family="微软雅黑" 
                        font-size="22">
                    </label>
                </image>
                <!-- 宿州  -->
                <image name="suzhou" rect="120,-10,220,165" visible="false" 
                    border="false" extendstyle="1111" src="file://image/suzhou_on.png"
                    style="autosize">
                    <label rect="30,20,180,145" text="宿州" h-align="center"
                        v-align="center" color="#ffffff" font-family="微软雅黑" 
                        font-size="22">
                    </label>
                </image>
                <!-- 阜阳  -->
                <image name="fuyang" rect="5,90,185,150" visible="false" 
                    border="false" extendstyle="1111" src="file://image/fuyang_on.png" 
                    style="autosize">
                    <label rect="0,10,180,150" text="阜阳 " h-align="center"
                        v-align="center" color="#ffffff" font-family="微软雅黑" 
                        font-size="22">
                    </label>
                </image>
                <!-- 淮南  -->
                <image name="huainan" rect="148,165,90,55" visible="false" 
                    border="false" extendstyle="1111" src="file://image/huainan_on.png" 
                    style="autosize">
                    <label rect="0,0,90,55" text="淮南 " h-align="center"
                        v-align="center" color="#ffffff" font-family="微软雅黑" 
                        font-size="20">
                    </label>
                </image>
                <!-- 滁州  -->
                <image name="chuzhou" rect="210,135,220,160" visible="false" 
                    border="false" extendstyle="1111" src="file://image/chuzhou_on.png"
                    style="autosize">
                    <label rect="0,0,220,160" text="滁州  " h-align="center"
                        v-align="center" color="#ffffff" font-family="微软雅黑" 
                        font-size="22">
                    </label>
                </image>
                <!-- 六安  -->
                <image name="liuan" rect="48,185,200,195"
                    visible="false" border="false" extendstyle="1111" 
                    src="file://image/liuan_on.png" style="autosize">
                    <label rect="0,0,200,195" text="六安  " h-align="center"
                        v-align="center" color="#ffffff" font-family="微软雅黑" 
                        font-size="22">
                    </label>
                </image>
                <!-- 安庆  -->
                <image name="anqing" rect="83,325,210,180" visible="false" 
                    border="false" extendstyle="1111" src="file://image/anqing_on.png" 
                    style="autosize">
                    <label rect="0,0,210,150" text="安庆  " h-align="center"
                        v-align="center" color="#ffffff" font-family="微软雅黑" 
                        font-size="22">
                    </label>
                </image>
                <!-- 池州  -->
                <image name="chizhou" rect="165,370,160,160" visible="false" 
                    border="false" extendstyle="1111" src="file://image/chizhou_on.png" 
                    style="autosize">
                    <label rect="0,0,210,120" text="池州  " h-align="center"
                        v-align="center" color="#ffffff" font-family="微软雅黑" 
                        font-size="22">
                    </label>
                </image>
                <!-- 宣城  -->
                <image name="xuancheng" rect="280,325,195,160" visible="false" 
                    border="false" extendstyle="1111" src="file://image/xuancheng_on.png" 
                    style="autosize">
                    <label rect="0,0,195,160" text="宣城  " h-align="center"
                        v-align="center" color="#ffffff" font-family="微软雅黑" 
                        font-size="22">
                    </label>
                </image>
                <!-- 黄山  -->
                <image name="huangshan" rect="215,405,190,133" visible="false" 
                    border="false" extendstyle="1111" src="file://image/huangshang_on.png"
                    style="autosize">
                    <label rect="0,0,200,130" text="黄山  " h-align="center"
                        v-align="center" color="#ffffff" font-family="微软雅黑" 
                        font-size="22">
                    </label>
                </image>
                <!-- 铜陵  -->
                <image name="tongling" rect="270,350,60,55" visible="false" 
                    border="false" extendstyle="1111" src="file://image/tongling_on.png" 
                    style="autosize">
                    <label rect="0,0,55,50" text="铜陵" h-align="center"
                        v-align="center" color="#ffffff" font-family="微软雅黑" 
                        font-size="20">
                    </label>
                </image>   
            </node>

            <!-- 底部菜单  -->
            <node name="listNode" rect="0,720,480,80" extendstyle="1111">
                <image  rect="0,0,480,80" border="false" extendstyle="1111" 
                src="file://image/book/list_bg.png"  style="autosize"/>
                <!-- 搜索  -->
                <button name='searchBtn' rect="15,0,110,80"  extendstyle="1111"  style='autosize'
                src='file://image/book/lianxiren_d.png' OnSelect="doSearch"></button>
                <!-- 联系人  -->
                <button name='contactBtn' rect="125,0,110,80"  extendstyle="1111"  style='autosize'
                src='file://image/book/zuijinglianxiren_s.png' OnSelect="doContact"></button>
                <!-- 个人中心  -->
                <button name='personBtn' rect="250,0,82,80"  extendstyle="1111"  style='autosize'
                src='file://image/book/person_d.png' OnSelect="doPersonalCenter"></button>
                <!-- 设置  -->
                <button name='siteBtn' rect="385,0,48,80"  extendstyle="1111"  style='autosize'
                src='file://image/book/site_d.png' OnSelect="doSetting"></button>
            </node> 
        </node>
    </body>
    <![CDATA[

require 'com_wondertek_tx.common.framework'
require 'framework.webbrowser'
require 'framework.umsagent'
require('framework.sqlite')
local databaseName
local rootSprite
local textcontent = {}
local currentCity 
local data1,data2,data3,data4
local search,contact,person,site
data = {{key="hefei",      name="合肥",  deptid=""}, 
		{key="bengbu",     name="蚌埠",  deptid=""},
		{key="wuhu",       name="芜湖",  deptid=""},
		{key="maanshan",   name="马鞍山",  deptid=""},
		{key="bozhou",     name="亳州",  deptid=""},
		{key="huaibei",    name="淮北",  deptid=""},
		{key="suzhou",     name="宿州",  deptid=""},
		{key="fuyang",     name="阜阳",  deptid=""},
		{key="huainan",    name="淮南",  deptid=""},
		{key="chuzhou",    name="滁州",  deptid=""},
		{key="liuan",      name="六安",  deptid=""},
		{key="anqing",     name="安庆",  deptid=""},
		{key="chizhou",    name="池州",  deptid=""},
		{key="xuancheng",  name="宣城",  deptid=""},
		{key="huangshan", name="黄山",  deptid=""},
		{key="tongling",   name="铜陵",  deptid=""},
		{key="anhui",   name="省公司",  deptid=""},
        }

---------------------------------------回调函数--------------------------------
-- root子节点创建完事件
function bodyBuildChildrenFinished(sprite)
    rootSprite = sprite
    --定义列表按钮data属性
    search =Sprite:findChild(rootSprite,'search')
    contact =Sprite:findChild(rootSprite,'contact')
    person =Sprite:findChild(rootSprite,'person')
    site =Sprite:findChild(rootSprite,'site')
    data1 = Sprite:getData(search)
    data2 = Sprite:getData(contact)
    data3 = Sprite:getData(person)
    data4 = Sprite:getData(site)
    initCityData()
end

-- root节点消息方法
function bodyOnSpriteEvent(msg, param)
    if msg == MSG_ACTIVATE then -- 页面激活
        UmsAgent:OnActivate(string.match(Alias.m_renyuantongji, 'MODULE:\\(.*)'), "系统首页")
        Sprite:setProperty(Sprite:findChild(rootSprite,'personBtn'),'src','file://image/book/person_d.png')
        Sprite:setProperty(Sprite:findChild(rootSprite,'searchBtn'),'src','file://image/book/lianxiren_d.png')
        Sprite:setProperty(Sprite:findChild(rootSprite,'contactBtn'),'src','file://image/book/zuijinglianxiren_s.png')
        Sprite:setProperty(Sprite:findChild(rootSprite,'siteBtn'),'src','file://image/book/site_d.png')
    elseif msg == MSG_DEACTIVATE then
        UmsAgent:OnDeactivate()
    end
end

-- 插件消息方法
function bodyOnPluginEvent(msg, param)
    if msg == 101 then
    elseif msg == 101 + MSG_CACHEDATA_RELOAD then -- 101请求的数据有更新
    elseif msg == 101 + MSG_NETWORK_ERROR then -- 101请求的数据超时
    elseif msg == MSG_NETWORK_ERROR then -- 拨号失败
        Log:write('拨号失败')
    elseif msg > MSG_NETWORK_ERROR then -- 请求超时
        Log:write('请求超时')
    end
end

-- 按键响应处理
function mainNodeOnKeyUp(sprite, kc)
    if kc == Key.F2 then -- 按下返回键
        -- Dialog:show('提示', '是否确定退出？', 'ok_cancel', 'doExit') 
        Scene:go(Alias.m_recentContacter, true)
        return 1
    end
end

----------------------------------服务端交互函数列表---------------------------------

function doRegionClick(sprite)
    UmsAgent:onLoadStart()
    -- 获取当前被选地市的数据
    local name = Sprite:getData(sprite)
    local city = nil
    for i=1,#data do
       if name == data[i].key then
            Log:write('name', name)
            city = data[i]
            break
       end 
    end
    if city == nil or city == '' then 
        Log:write('doRegionClick(): invalid city name '..city.name)
        return
    end

    if city.key ~= "anhui"  then 
        local anhuiBgImg = Sprite:findChild(rootSprite, 'anhuiBgImg')
        Sprite:setProperty(anhuiBgImg, 'visible', 'false')
    end
    currentCity = city

    -- 显示弹出提示
    local cityNode = Sprite:findChild(rootSprite, 'cityNode')
    Sprite:setProperty(cityNode, 'visible', 'true')
    --Sprite:setProperty(cityNode, 'enable', 'true')
    -- 隐藏所有的城市图片
    for i=1,#data do
        local cityImage = Sprite:findChild(rootSprite, data[i].key)
        Sprite:setProperty(cityImage, 'visible', 'false')
    end
    -- 突出显示当前选择的地市
    local cityImage = Sprite:findChild(rootSprite, city.key)
    Sprite:setProperty(cityImage, 'visible', 'true')
    UmsAgent:onLoadFinish()
    Timer:set(3, 50, 'jumpToDeptPage')
end

function jumpToDeptPage()
    local mapdataHandler = Reg:create("mapdataRoom")
    Log:write('===='.."departmentid="..currentCity.deptid.."&departmentname="..currentCity.name)
    local anhuiBgImg = Sprite:findChild(rootSprite, 'anhuiBgImg')
    Sprite:setProperty(anhuiBgImg, 'visible', 'false')
    if currentCity.key == 'anhui' then
        Reg:setString(mapdataHandler, 'cityname', currentCity.key)
        Reg:setString(mapdataHandler, 'cityid', currentCity.deptid)
        Scene:setReturn(Alias.m_renyuantongji, Alias.m_zuzhijiegou)
        Scene:go(Alias.m_zuzhijiegou.."?departmentid="..currentCity.deptid.."&departmentname="..currentCity.name, true)       
        else
        Reg:setString(mapdataHandler, 'cityname', currentCity.key)
        Reg:setString(mapdataHandler, 'cityid', currentCity.deptid)
        Scene:setReturn(Alias.m_renyuantongji, Alias.m_zuzhijiegou)
        Scene:go(Alias.m_zuzhijiegou.."?departmentid="..currentCity.deptid.."&departmentname="..currentCity.name.."分公司", true)
    end
end

-- 隐藏地市
function hideCityNode(sprite)
    local cityNode = Sprite:findChild(rootSprite, 'cityNode')
    Sprite:setProperty(cityNode, 'visible', 'false')
    Sprite:setProperty(cityNode, 'enable', 'false')
end

function OnSelectShowMap(sprite)
    local cityNode = Sprite:findChild(rootSprite, 'cityNode')
    Sprite:setProperty(cityNode, 'visible', 'false') 
end

function OnstaffRatioBtn(sprite)
    local BtnData = Sprite:getData(sprite)
    local RatioCont = Sprite:findChild(rootSprite,'RatioCont')
    local solve= Sprite:findChild(rootSprite,'solve')
    setAllShoworHide(RatioCont, 1)
    local textcont = Sprite:findChild(rootSprite,'textcont')
    Sprite:setProperty(textcont,'text',textcontent[tonumber(BtnData)])
    if BtnData=='2' then 
        Sprite:setProperty(solve,'src','file://image/base_dialog1.png')
        Sprite:setRect(solve,70,37,316,54)  
        Sprite:setRect(textcont,75,15,300,80) 
    elseif  BtnData=='1' then 
        Sprite:setProperty(solve,'src','file://image/base_dialog.png')
        Sprite:setRect(solve,30,37,316,54)  
        Sprite:setRect(textcont,35,15,300,80) 
    end
end

function hiveRatioCont()
    local RatioCont = Sprite:findChild(rootSprite,'RatioCont')
    setAllShoworHide(RatioCont, 0)
end

-- 搜索函数
function doSearch(sprite)
    Sprite:setProperty(sprite,'src','file://image/book/lianxiren_s.png')
    Sprite:setProperty(Sprite:findChild(rootSprite,'contactBtn'),'src','file://image/book/zuijinglianxiren_d.png')
    Sprite:setProperty(Sprite:findChild(rootSprite,'personBtn'),'src','file://image/book/person_d.png')
    Sprite:setProperty(Sprite:findChild(rootSprite,'siteBtn'),'src','file://image/book/site_d.png')
    Scene:setReturn(Alias.m_lianxirenlist, Alias.m_recentContacter)
    Scene:go(Alias.m_recentContacter, true)
end

-- 联系人列表
function doContact(sprite)
    Sprite:setProperty(sprite,'src','file://image/book/zuijinglianxiren_s.png')
    Sprite:setProperty(Sprite:findChild(rootSprite,'searchBtn'),'src','file://image/book/lianxiren_d.png')
    Sprite:setProperty(Sprite:findChild(rootSprite,'personBtn'),'src','file://image/book/person_d.png')
    Sprite:setProperty(Sprite:findChild(rootSprite,'siteBtn'),'src','file://image/book/site_d.png')
    Scene:setReturn(Alias.m_lianxirenlist, Alias.m_renyuantongji)
    Scene:go(Alias.m_renyuantongji, true)
    --Log:write("已在联系人列表界面，点击不做任何操作！")
end

-- 个人信息详情
function doPersonalCenter(sprite)
    Sprite:setProperty(sprite,'src','file://image/book/person_s.png')
    Sprite:setProperty(Sprite:findChild(rootSprite,'searchBtn'),'src','file://image/book/zuijinglianxiren_d.png')
    Sprite:setProperty(Sprite:findChild(rootSprite,'contactBtn'),'src','file://image/book/contact_d.png')
    Sprite:setProperty(Sprite:findChild(rootSprite,'siteBtn'),'src','file://image/book/site_d.png')   
    Scene:setReturn(Alias.m_lianxirenlist, Alias.m_myInfo .. '?employeeId=' .. Config:get("employeeId"))
    Scene:go(Alias.m_myInfo .. '?employeeId=' .. Config:get("employeeId"), true)
end

-- 设置
function doSetting(sprite)
    Sprite:setProperty(sprite,'src','file://image/book/site_s.png')
    Sprite:setProperty(Sprite:findChild(rootSprite,'searchBtn'),'src','file://image/book/zuijinglianxiren_d.png')
    Sprite:setProperty(Sprite:findChild(rootSprite,'contactBtn'),'src','file://image/book/contact_d.png')
    Sprite:setProperty(Sprite:findChild(rootSprite,'personBtn'),'src','file://image/book/person_d.png') 
    Scene:setReturn(Alias.m_lianxirenlist, Alias.m_system)
    Scene:go(Alias.m_system, true)
end

function goSearchPage()
    Log:write("进入搜索 = ") 
    Scene:setReturn(Alias.m_renyuantongji, Alias.m_searchContacter)
    Scene:go(Alias.m_searchContacter, true)
end

function initCityData()
    databaseName = Config:get('databaseName')
    local bRet, errMsg = Sqlite:open(databaseName)
    Log:write("创建数据库jttxlDatabase结果:bRet = "..bRet.." errMsg ="..errMsg)
    local cityname
    for i=1,#data do
        if data[i].key == "anhui" then
            cityname = '省公司'
            else 
            cityname = data[i].name..'分公司'
        end
        local sql2 = "select department_id, department_name from tb_c_department where department_name = '"..cityname.."' ;"
        Log:write("==查询语句=="..sql2)
        local  bRet2, retDeptTable2, errMsg2 = Sqlite:query(Config:get('databaseName'), sql2)
        Log:write("查询数据库表成功1:bRet = "..bRet2.." errMsg ="..errMsg2.." 查询结果retDeptTable1 =", retDeptTable2)
        if retDeptTable2[1][1]~=nil and retDeptTable2[1][1]~='' then
            data[i].deptid = retDeptTable2[1][1]
        end
    end
end

    ]]>
</root>
