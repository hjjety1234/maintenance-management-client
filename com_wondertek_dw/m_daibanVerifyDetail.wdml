<?xml version="1.0" encoding="utf-8"?>
<!--
==
============================================================================
== | WonderTek [ 网络无处不在，沟通及时到达 ] ==
============================================================================
== | Copyright (c) 2012, WonderTek, Inc. All Rights Reserved. ==
============================================================================
== | Author: xxxx <xxxx@xxxx.com> ==
============================================================================
== | Desc: 页面描述 ==
============================================================================
-->
<root>
    <header />
    <body resolution="480,800" BuildChildrenFinished="bodyBuildChildrenFinished"
        OnSpriteEvent="bodyOnSpriteEvent" OnPluginEvent="bodyOnPluginEvent">
        <node name="mainNode" rect="0,0,480,800" enable="true" active="true"
            OnKeyUp="mainNodeOnKeyUp" layouttype="1" extendstyle="1111">
        <!-- 设置背景 -->
       <image rect="0,0,0,0" src="file://image/backgroundImg.png" style="autosize" extendstyle="1177" />
       <!-- 设置头部 -->
            <node name="baseSprite" rect="0,0,480,66" extendstyle="1111">
                <image name="title" rect="0,0,480,66" border="false"
                    src="file://image/title_new.png" style="autosize" extendstyle="1111">
                    <label rect="0,0,480,66" text="未审核详情" color="#ffffff" v-align="center"
                        h-align="center" font-family="微软雅黑" font-size="30" extendstyle="1111" />
                </image>
                <button name="backBtn" rect="0,0,66,66" normal="" sel="" OnSelect="doBack" extendstyle="1111">
                    <image name="normal" rect="15,8,75,75" src="file://image/skin/title_back_new.png" 
                         extendstyle="1111" />
                    <image name="sel" rect="15,8,75,75" src="file://image/skin/title_back_new.png"
                         extendstyle="1111" />
                </button>
            </node>

            <listview name="listview" rect="0,66,480,634" col="1"
                extendstyle="1111" limit="true" border="false">
                <!--<shadow rect="0,420,0,0" color="" alpha="20" extendstyle="1177" />-->
                <list-item rect="0,0,480,52" extendstyle="1111" border="false">
                    <label name="label1" rect="0,0,170,52" border="false" text="标题："
                        h-align="right" v-align="center" color="#0062ab" font-family="微软雅黑" font-size="24"
                        extendstyle="1111" />
                    <node rect="170,0,305,52" border="false" text="" color="#ffffff"
                        extendstyle="1111">
                        <scrolltext name="Verifytitle" rect="2,0,300,52" text="" color="#303030" extendstyle="1111"
                                    style="autosize" scroll="true" h-align="left" v-align="center" font-size="24" >
                        </scrolltext>    
                    </node>
                </list-item>
                <list-item rect="0,0,480,52" extendstyle="1111" border="false">
                    <image name="listButtonImage" rect="0,0,480,52" src="file://image/item_bg.png"
                                   extendstyle="1111" style='autosize' />
                    <label name="label1" rect="0,0,170,52" border="false" text="处理结果："
                        h-align="right" v-align="center" color="#0062ab" font-family="微软雅黑" font-size="24"
                        extendstyle="1111" />
                    <node rect="170,0,305,52" border="false" text="" color="#ffffff"
                        extendstyle="1111">
                        <scrolltext name="result" rect="2,0,252,52" text="" color="#303030" extendstyle="1111"
                                    style="autosize" scroll="true" h-align="left" v-align="center" font-size="24" >
                        </scrolltext>    
                    </node>
                </list-item>
                <list-item rect="0,0,480,52" extendstyle="1111" border="false">
                    <label name="label1" rect="0,0,170,52" border="false" text="故障类别："
                        h-align="right" v-align="center" color="#0062ab" font-family="微软雅黑" font-size="24"
                        extendstyle="1111" />
                    <node rect="170,0,305,52" border="false" text="" color="#ffffff"
                        extendstyle="1111">
                        <scrolltext name="troubletype" rect="2,0,300,52" text="" color="#303030" extendstyle="1111"
                                    style="autosize" scroll="true" h-align="left" v-align="center" font-size="24" >
                        </scrolltext>    
                    </node>
                </list-item>
                <list-item name="textNode" rect="0,0,480,260" extendstyle="1111"
                    border="false">
                    <node name="baseSprite" rect="0,0,480,52" extendstyle="1111">
                            <image name="listButtonImage" rect="0,0,480,52" src="file://image/item_bg.png"
                                   extendstyle="1111" style='autosize' />     
                            <label name="label1" rect="0,0,170,52" border="false" text="故障细分："
                                h-align="right" v-align="center" color="#0062ab" font-family="微软雅黑" font-size="24"
                                extendstyle="1111" />
                            <button name="" rect="170,0,305,52" border="false"
                                text="" color="#ffffff" OnSelect="" extendstyle="1111" data="C30">
                                <scrolltext name="troubledetail" rect="2,0,300,52" text="" color="#303030" extendstyle="1111"
                                    style="autosize" scroll="true" h-align="left" v-align="center" font-size="24" >
                                </scrolltext> 
                            </button>
                    </node>
    
                    <node name="baseSprite" rect="0,52,480,52" extendstyle="1111">
                            <label name="label1" rect="0,0,170,52" border="false" text="EMOS编号："
                                h-align="right" v-align="center" color="#0062ab" font-family="微软雅黑" font-size="24"
                                extendstyle="1111" />
                            <button name="typeBtn" rect="170,0,305,52" border="false"
                                text="" color="#ffffff" OnSelect="" extendstyle="1111">
                                <scrolltext name="eomsid" rect="2,0,300,52" text="" color="#303030" extendstyle="1111"
                                    style="autosize" scroll="true" h-align="left" v-align="center" font-size="24" >
                                </scrolltext>
                            </button>
                    </node>
                    <node name="baseSprite" rect="0,104,480,52" extendstyle="1111">
                            <image name="listButtonImage" rect="0,0,480,52" src="file://image/item_bg.png"
                                   extendstyle="1111" style='autosize' />
                            <label name="label1" rect="0,0,170,52" border="false" text="设备厂商："
                                h-align="right" v-align="center" color="#0062ab" font-family="微软雅黑" font-size="24"
                                extendstyle="1111" />
                            <button name="levelBtn" rect="170,0,305,52" border="false"
                                text="" color="#ffffff" OnSelect="" extendstyle="1111">
                                <scrolltext name="equipment" rect="2,0,300,52" text="" color="#303030" extendstyle="1111"
                                    style="autosize" scroll="true" h-align="left" v-align="center" font-size="24" >
                                </scrolltext>
                            </button>
                    </node>
                    <node name="addrSprit" rect="0,156,480,52" extendstyle="1111">
                        <list-item rect="0,0,480,52" extendstyle="1111" border="false">
                            <label name="label1" rect="0,0,170,52" border="false" text="网元名称："
                               h-align="right" v-align="center" color="#0062ab" font-family="微软雅黑" font-size="24" extendstyle="1111" />
                            <node rect="170,0,305,52" border="false" text="" color="#ffffff" extendstyle="1111" >
                                <scrolltext name="networkname" rect="2,0,300,52" text="" color="#303030" extendstyle="1111"
                                    style="autosize" scroll="true" h-align="left" v-align="center" font-size="24" >
                                </scrolltext>
                            </node>
                        </list-item>
                    </node>
                    <node name="baseSprite" rect="0,208,480,52" extendstyle="1111">
                            <image name="listButtonImage" rect="0,0,480,52" src="file://image/item_bg.png"
                                   extendstyle="1111" style='autosize' />
                            <label name="label1" rect="0,0,170,52" border="false" text="消除时间："
                                  h-align="right" v-align="center" color="#0062ab" font-family="微软雅黑" font-size="24"
                                  extendstyle="1111" />
                            <node rect="170,0,305,52" border="false" text="" color="#ffffff" extendstyle="1111" >
                                <scrolltext name="faultdealtime" rect="2,0,300,52" text="" color="#303030" extendstyle="1111"
                                    style="autosize" scroll="true" h-align="left" v-align="center" font-size="24" >
                                </scrolltext>
                            </node>
                    </node>
                </list-item>
                <list-item rect="0,0,480,52" extendstyle="1111" border="false">
                    <label name="label1" rect="0,0,170,52" border="false" text="回单人："
                        h-align="right" v-align="center" color="#0062ab" font-family="微软雅黑" font-size="24"
                        extendstyle="1111" />
                    <node rect="170,0,305,52" border="false" text="" color="#ffffff"
                        extendstyle="1111">
                        <scrolltext name="replyman" rect="2,0,300,52" text="" color="#303030" extendstyle="1111"
                                    style="autosize" scroll="true" h-align="left" v-align="center" font-size="24" >
                        </scrolltext>    
                    </node>
                </list-item>
                <list-item rect="0,0,480,52" extendstyle="1111" border="false">
                    <label name="label1" rect="0,0,170,52" border="false" text="回单时间："
                        h-align="right" v-align="center" color="#0062ab" font-family="微软雅黑" font-size="24"
                        extendstyle="1111" />
                    <node rect="170,0,305,52" border="false" text="" color="#ffffff"
                        extendstyle="1111">
                        <scrolltext name="replydate" rect="2,0,300,52" text="" color="#303030" extendstyle="1111"
                                    style="autosize" scroll="true" h-align="left" v-align="center" font-size="24" >
                        </scrolltext>    
                    </node>
                </list-item>
                <list-item rect="0,0,480,52" extendstyle="1111" border="false">
                    <image name="listButtonImage" rect="0,0,480,52" src="file://image/item_bg.png"
                        extendstyle="1111" style='autosize' />
                    <label name="label1" rect="0,0,170,52" border="false" text="处理措施："
                        h-align="right" v-align="center" color="#0062ab" font-family="微软雅黑" font-size="24"
                        extendstyle="1111" />
                    <node rect="170,0,305,52" border="false" text="" color="#ffffff"
                        extendstyle="1111">
                        <scrolltext name="processmeasure" rect="2,0,300,52" text="" color="#303030" extendstyle="1111"
                                    style="autosize" scroll="true" h-align="left" v-align="center" font-size="24" >
                        </scrolltext>    
                    </node>
                </list-item>
                <list-item rect="0,0,480,52" extendstyle="1111" border="false">
                    <image name="listButtonImage" rect="0,0,480,52" src="file://image/item_bg.png"
                        extendstyle="1111" style='autosize' />
                    <label name="label1" rect="0,0,170,52" border="false" text="发生时间："
                        h-align="right" v-align="center" color="#0062ab" font-family="微软雅黑" font-size="24"
                        extendstyle="1111" />
                    <node rect="170,0,305,52" border="false" text="" color="#ffffff"
                        extendstyle="1111">
                        <scrolltext name="time" rect="2,0,300,52" text="" color="#303030" extendstyle="1111"
                                    style="autosize" scroll="true" h-align="left" v-align="center" font-size="24" >
                        </scrolltext>    
                    </node>
                </list-item>
                <list-item rect="0,0,480,52" extendstyle="1111" border="false">
                    <image name="listButtonImage" rect="0,0,480,52" src="file://image/item_bg.png"
                        extendstyle="1111" style='autosize' />
                    <label name="label1" rect="0,0,170,52" border="false" text="T2处理时限："
                        h-align="right" v-align="center" color="#0062ab" font-family="微软雅黑" font-size="24"
                        extendstyle="1111" />
                    <node rect="170,0,305,52" border="false" text="" color="#ffffff"
                        extendstyle="1111">
                        <scrolltext name="t2limit" rect="2,0,300,52" text="" color="#303030" extendstyle="1111"
                                    style="autosize" scroll="true" h-align="left" v-align="center" font-size="24" >
                        </scrolltext>    
                    </node>
                </list-item>
                <list-item rect="0,0,480,52" extendstyle="1111" border="false">
                    <image name="listButtonImage" rect="0,0,480,52" src="file://image/item_bg.png"
                        extendstyle="1111" style='autosize' />
                    <label name="label1" rect="0,0,170,52" border="false" text="告警级别："
                        h-align="right" v-align="center" color="#0062ab" font-family="微软雅黑" font-size="24"
                        extendstyle="1111" />
                    <node rect="170,0,305,52" border="false" text="" color="#ffffff"
                        extendstyle="1111">
                        <scrolltext name="level" rect="2,0,300,52" text="" color="#303030" extendstyle="1111"
                                    style="autosize" scroll="true" h-align="left" v-align="center" font-size="24" >
                        </scrolltext>    
                    </node>
                </list-item>
                <list-item rect="0,0,480,52" extendstyle="1111" border="false">
                    <image name="listButtonImage" rect="0,0,480,52" src="file://image/item_bg.png"
                        extendstyle="1111" style='autosize' />
                    <label name="label1" rect="0,0,170,52" border="false" text="告警描述："
                        h-align="right" v-align="center" color="#0062ab" font-family="微软雅黑" font-size="24"
                        extendstyle="1111" />
                    <node rect="170,0,305,52" border="false" text="" color="#ffffff"
                        extendstyle="1111">
                        <scrolltext name="description" rect="2,0,300,52" text="" color="#303030" extendstyle="1111"
                                    style="autosize" scroll="true" h-align="left" v-align="center" font-size="24" >
                        </scrolltext>    
                    </node>
                </list-item>
                <list-item rect="0,0,480,52" extendstyle="1111" border="false">
                    <image name="listButtonImage" rect="0,0,480,52" src="file://image/item_bg.png"
                        extendstyle="1111" style='autosize' />
                    <label name="label1" rect="0,0,170,52" border="false" text="处理状态："
                        h-align="right" v-align="center" color="#0062ab" font-family="微软雅黑" font-size="24"
                        extendstyle="1111" />
                    <node rect="170,0,305,52" border="false" text="" color="#ffffff"
                        extendstyle="1111">
                        <scrolltext name="status" rect="2,0,300,52" text="" color="#303030" extendstyle="1111"
                                    style="autosize" scroll="true" h-align="left" v-align="center" font-size="24" >
                        </scrolltext>    
                    </node>
                </list-item>
            </listview>
            

            <button name="statusBtn" rect="160,710,160,50" text="审核" color="#ffffff"
                extendstyle="1111" OnSelect="doVerify"
                normal="src:file://image/btn_bg_n.png;style:sudoku-auto;sudoku:15,15,15,15;color:#ffffff"
                sel="src:file://image/btn_bg_s.png;style:sudoku-auto;sudoku:15,15,15,15;color:#000000"
                font-size="24"  visible="true" enable="true"/>
        </node>

    </body>
    <![CDATA[

require 'com_wondertek_dw.common.framework'

local rootSprite

local regHandle

local detailData
---------------------------------------callbacks--------------------------------
-- @brief root子节点创建完事件
function bodyBuildChildrenFinished(sprite)
    rootSprite = sprite
    regHandle = Reg:create('daiban')
    loadVerifyDetail()
end
function loadVerifyDetail()
    --http://61.191.25.238:9012/nbspweb/webservice/wlbfault!doWebservice.action?usercode=cesbzz&pagesize=10&cmd=wlbfaultcheckdetail&page=1&id=000000221209
    local username = Config:get('username')
    local param = '&cmd=wlbfaultcheckdetail&pagesize=10&page=1&usercode='..username..'&id='..Reg:getString(regHandle,'verify_id')
    local url= getWholeUrl('nbspweb/webservice/wlbfault!doWebservice.action' , '')
    Log:write('未审核详情URL', url..param)
    Http:request('verify_detail', url, 101, {useCache = false, method = 'post', postData=''..param})
    Loading:show(rootSprite) 
end
function fillContent()
    local title = Sprite:findChild(rootSprite,'Verifytitle')
    local result = Sprite:findChild(rootSprite,'result')
    local troubletype = Sprite:findChild(rootSprite,'troubletype')
    local troubledetail = Sprite:findChild(rootSprite,'troubledetail')
    local eomsid = Sprite:findChild(rootSprite,'eomsid')
    local equipment = Sprite:findChild(rootSprite,'equipment')
    local networkname = Sprite:findChild(rootSprite,'networkname')
    local faultdealtime = Sprite:findChild(rootSprite,'faultdealtime')
    local replyman = Sprite:findChild(rootSprite,'replyman')
    local replydate = Sprite:findChild(rootSprite,'replydate')
    local processmeasure = Sprite:findChild(rootSprite,'processmeasure')
    local time = Sprite:findChild(rootSprite,'time')
    local t2limit = Sprite:findChild(rootSprite,'t2limit')
    local level = Sprite:findChild(rootSprite,'level')
    local description = Sprite:findChild(rootSprite,'description')
    local status = Sprite:findChild(rootSprite,'status')

    Sprite:setProperty(title,'text',detailData.title)
    Sprite:setProperty(result,'text',detailData.result)
    Sprite:setProperty(troubletype,'text',detailData.troubletype)
    Sprite:setProperty(troubledetail,'text',detailData.troubledetail)
    Sprite:setProperty(eomsid,'text',detailData.eomsid)
    Sprite:setProperty(equipment,'text',detailData.equipment)
    Sprite:setProperty(networkname,'text',detailData.networkname)
    Sprite:setProperty(faultdealtime,'text',detailData.faultdealtime)
    Sprite:setProperty(replyman,'text',detailData.replyman)
    Sprite:setProperty(replydate,'text',detailData.replydate)
    Sprite:setProperty(processmeasure,'text',detailData.processmeasure)
    Sprite:setProperty(time,'text',detailData.time)
    Sprite:setProperty(t2limit,'text',detailData.t2limit)
    Sprite:setProperty(level,'text',detailData.level)
    Sprite:setProperty(description,'text',detailData.description)
    Sprite:setProperty(status,'text',detailData.status)
end
-- @brief root节点消息方法
function bodyOnSpriteEvent(msg, param)
    if msg == MSG_ACTIVATE then -- 页面激活
    elseif msg == MSG_DEACTIVATE then
    end
end

-- @brief 插件消息方法
function bodyOnPluginEvent(msg, param)
    if Loading:isShow() then Loading:close() end
    if msg == 101 then
        local data = Http:jsonDecode('verify_detail')
        Log:write("data101 = ", data)
        detailData = data.value
        if detailData ~= nil then
            fillContent()
        end
    elseif msg == 102 then
        local data = Http:jsonDecode('verify_go')
        Log:write("data102 = ", data)
        if data ~= nil then
            if data.code == '0' then
                Dialog:show(rootSprite, '审核成功！', 'ok','doBack')
            else
                Dialog:show(rootSprite, '未知错误！', 'ok')
            end
        else
            Dialog:show(rootSprite, '未知错误！', 'ok')
        end
    elseif msg == 101 + MSG_CACHEDATA_RELOAD then -- 101请求的数据有更新
    elseif msg == MSG_NETWORK_ERROR then -- 拨号失败
        Log:write('拨号失败')
    elseif msg > MSG_NETWORK_ERROR then -- 请求超时
        Log:write('请求超时')
    end
end
function doBack()
    Scene:back()
end
function doVerify()
    --http://61.191.25.238:9012/nbspweb/webservice/wlbfault!doWebservice.action?usercode=cesbzz&cmd=wlbfaultcheck&id=000000221209
    local username = Config:get('username')
    local param = '&cmd=wlbfaultcheck&usercode='..username..'&id='..Reg:getString(regHandle,'verify_id')
    local url= getWholeUrl('nbspweb/webservice/wlbfault!doWebservice.action' , '')
    Log:write('开始审核URL', url..param)
    Http:request('verify_go', url, 102, {useCache = false, method = 'post', postData=''..param})
    Loading:show(rootSprite) 
end

-- @brief 按键响应处理
function mainNodeOnKeyUp(sprite, kc)
    if kc == Key.F2 then -- 按下返回键
        Scene:back()
        return 1
    end
end

---------------------------------------util functions--------------------------

    ]]>
</root>
