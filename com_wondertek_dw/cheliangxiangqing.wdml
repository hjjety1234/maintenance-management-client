<?xml version="1.0" encoding="utf-8"?>
	<!--
		==
		============================================================================
		== | WonderTek [ 网络无处不在，沟通及时到达 ] ==
		============================================================================
		== | Copyright (c) 2012, WonderTek, Inc. All Rights Reserved. ==
		============================================================================
		== | Author: xxxx <xxxx@xxxx.com> ==
		============================================================================
		== | Desc: 页面描述 ==
		============================================================================
	-->
<root>
	<header />
	<body resolution="480,800" BuildChildrenFinished="bodyBuildChildrenFinished"
		OnSpriteEvent="bodyOnSpriteEvent" OnPluginEvent="bodyOnPluginEvent">
		<shadow rect="0,0,480,800" color="#e8e9ed" alpha="255"
			extendstyle="1111" />
		<node name="mainNode" rect="0,0,480,800" enable="true" active="true"
			OnKeyUp="mainNodeOnKeyUp" layouttype="1" extendstyle="1111">

			<!-- 车辆详情头部 -->
			<node rect="0,0,480,66" extendstyle="1111">
				<image name="titleBg" rect="0,0,480,66" src="file://image/title_bg.png"
					extendstyle="1111" style="autosize" />
				<button name="backBtn" rect="0,10,75,45" normal="normal" sel="sel"
					OnSelect="doBack" extendstyle="1111">
					<image name="normal" rect="0,0,75,45" src="file://image/title_back_n.png"
						style="autosize" extendstyle="1111">
					</image>
					<image name="sel" rect="0,0,75,45" src="file://image/title_back_s.png"
						style="autosize" extendstyle="1111">
					</image>
					<label rect="15,0,60,45" text="返回" color="#ffffff"
						extendstyle="1111" style="autosize" h-align="center" v-align="center"
						font-size="24"></label>
				</button>
				<scrolltext name="title" rect="105,0,280,66" text="车辆详情"
					extendstyle="1111" font-size="28" h-align="center" v-align="center"
					color="#ffffff" scroll="true" step="2"></scrolltext>
			</node>

			<!-- 车辆详情字段内容  -->
			<node rect="0,66,480,734" extendstyle="1111">
				<listview name="sampleList" rect="0,10,480,734" col="1"
					extendstyle="1111">

					<!-- 基本信息  -->
					<list-item rect="0,0,480,170" extendstyle="1111">
						<node name="baseSprite" rect="10,0,230,50" extendstyle="1111">
							<label name="label1" rect="0,0,90,50" border="false" text="车牌号码："
								h-align="left" v-align="center" color="#000000" font-size="22"
								extendstyle="1111"></label>
							<label name="carId" rect="100,0,120,50" border="false"
								text="" h-align="left" v-align="center" color="#000000"
								font-size="22" extendstyle="1111"></label>
						</node>
						<node name="baseSprite" rect="240,0,230,50" extendstyle="1111">
							<label name="label1" rect="0,0,90,50" border="false" text="车辆类型："
								h-align="left" v-align="center" color="#000000" font-size="22"
								extendstyle="1111"></label>
							<label name="type" rect="100,0,120,50" border="false" text=""
								h-align="left" v-align="center" color="#000000" font-size="22"
								extendstyle="1111"></label>
						</node>
						<node name="baseSprite" rect="10,60,230,50" extendstyle="1111">
							<label name="label1" rect="0,0,90,50" border="false" text="车辆品牌："
								h-align="left" v-align="center" color="#000000" font-size="22"
								extendstyle="1111"></label>
							<label name="group" rect="100,0,120,50" border="false"
								text="" h-align="left" v-align="center" color="#000000"
								font-size="22" extendstyle="1111"></label>
						</node>
						<node name="baseSprite" rect="240,60,230,50" extendstyle="1111">
							<label name="label1" rect="0,0,90,50" border="false" text="车辆型号："
								h-align="lefts" v-align="center" color="#000000" font-size="22"
								extendstyle="1111"></label>
							<label name="time" rect="100,0,120,50" border="false" text=""
								h-align="left" v-align="center" color="#000000" font-size="22"
								extendstyle="1111"></label>
						</node>
						<node name="baseSprite" rect="0,120,480,50" extendstyle="1111"
							border="false">
							<image rect="0,0,480,50" src="file://image/title_bar.png"
								style="autosize" extendstyle="1111" />
							<label name="label1" rect="10,0,460,50" border="false"
								text="附加信息：" h-align="left" v-align="center" color="#ffffff"
								font-size="22" extendstyle="1111"></label>
						</node>
					</list-item>

					<!-- 附件信息  -->
					<list-item rect="0,180,480,300" extendstyle="1111">
						<!-- 驾驶员 -->
						<node name="driverNode" rect="0,0,480,60" extendstyle="1111">
							<label name="label1" rect="0,0,150,60" border="false" text="驾驶员："
								h-align="right" v-align="center" color="#000000" font-size="22"
								extendstyle="1111"></label>
							<label name="driver" v-align="center" h-align="left"
								rect="150,0,292,60" text="" color="#000000" extendstyle="1111">
							</label>
						</node>
						<!-- 驾驶员手机  -->
						<node name="driverPhoneNoNode" rect="0,60,480,60"
							extendstyle="1111">
							<label name="label1" rect="0,0,150,60" border="false" text="驾驶员手机："
								h-align="right" v-align="center" color="#000000" font-size="22"
								extendstyle="1111"></label>
							<label name="driverPhoneNo" v-align="center" h-align="left"
								rect="150,0,292,60" text="" color="#000000" extendstyle="1111">
							</label>
						</node>
						<!-- 产权属性 -->
						<node name="propertyRightsNode" rect="0,120,480,60"
							extendstyle="1111">
							<label name="label1" rect="0,0,150,60" border="false" text="产权属性："
								h-align="right" v-align="center" color="#000000" font-size="22"
								extendstyle="1111"></label>
							<label name="propertyRights" v-align="center" h-align="left"
								rect="150,0,292,60" text="" color="#000000" extendstyle="1111">
							</label>
						</node>
						<!-- 代维公司  -->
						<node name="companyNode" rect="0,180,480,60" extendstyle="1111">
							<label name="label1" rect="0,0,150,60" border="false" text="代维公司："
								h-align="right" v-align="center" color="#000000" font-size="22"
								extendstyle="1111"></label>
							<label name="company" v-align="center" h-align="left"
								rect="150,0,292,60" text="" color="#000000" extendstyle="1111">
							</label>
						</node>
						<!-- 车辆状态  -->
						<node name="carStatusNode" rect="0,240,480,60" extendstyle="1111">
							<label name="label1" rect="0,0,150,60" border="false" text="车辆状态："
								h-align="right" v-align="center" color="#000000" font-size="22"
								extendstyle="1111"></label>
							<label name="carStatus" v-align="center" h-align="left"
								rect="150,0,292,60" text="" color="#000000" extendstyle="1111">
							</label>
						</node>
					</list-item>
                    
                    <!-- 标注 -->
					<list-item rect="10,480,460,240" extendstyle="1111">
						<node name="baseSprite" rect="10,10,440,220" extendstyle="1111">
							<image rect="0,0,440,220" src="file://image/title_edit_bg.png"
								style="sudoku-auto" extendstyle="1111" sudoku="20,20,20,20">
							</image>
							<edit name="edit" rect="10,10,410,190" border="false"
								extendstyle="1111" multiline="true" font-size="25" max-size="140"
								OnTextChanged="editOnTextChanged">
								<label name="hideLabel" rect="0,0,410,190" text="备注"
									color="#c0c0c0" extendstyle="1111" style="autosize" h-align="left"
									v-align="top" font-size="24"></label>
							</edit>
						</node>
					</list-item>
				</listview>
			</node>
		</node>
	</body>
    <![CDATA[

    require 'com_wondertek_dw.common.framework'
    local rootSprite
    ---------------------------------------callbacks--------------------------------
    -- @brief root子节点创建完事件
    function bodyBuildChildrenFinished(sprite)
        rootSprite = sprite
        getCarInfo(rootSprite)
    end
    -- @brief root节点消息方法
    function bodyOnSpriteEvent(msg, param)
        if msg == MSG_ACTIVATE then -- 页面激活
            elseif msg == MSG_DEACTIVATE then
        end
    end
    -- @brief 插件消息方法
    function bodyOnPluginEvent(msg)
        if msg == 101 then
            elseif msg == 101 + MSG_CACHEDATA_RELOAD then -- 101请求的数据有更新
            elseif msg == MSG_NETWORK_ERROR then -- 拨号失败
            Log:write('拨号失败')
            elseif msg > MSG_NETWORK_ERROR then -- 请求超时
            Log:write('请求超时')
        end
    end
    -- @brief 按键响应处理
    function mainNodeOnKeyUp(sprite, kc)
        if kc == Key.F2 then -- 按下返回键
            Scene:back()
            return 1
        end
    end
    ---------------------------------------util functions---------------------------
    --@brief 返回按钮消息处理
    function doBack()
        Scene:back()
    end
    --@brief 获取车辆的详细信息
    function getCarInfo()
        -- 合法性检查
        if rootSprite == nil then
            return
        end
        -- 获取车辆详情字段的Sprite
        local carIdSprite = Sprite:findChild(rootSprite, "carId")
        local carTypeSprite = Sprite:findChild(rootSprite, "carType")
        local carBrandSprite = Sprite:findChild(rootSprite, "carBrand")
        local carModelSprite = Sprite:findChild(rootSprite, "carModel")
        local driverPhoneNoSprite = Sprite:findChild(rootSprite, "driverPhoneNo")
        local propertyRightsSprite = Sprite:findChild(rootSprite, "propertyRights")
        local companySprite = Sprite:findChild(rootSprite, "company")
        --local carStatusSprite = Sprite:findChild(rootSprite, "carStatus")
        -- 获取车牌号码
        local regHandle = Reg:create('car')
        local carIdText = Reg:getString(regHandle, 'carId')
        Log:write("DEBUG:getCarInfo->carIdText:", carIdText)
        -- TODO:进行http请求，获取该车牌号下车辆的详细信息
        -- 显示到界面上
        Sprite:setProperty(carIdSprite, 'text', carIdText)
    end
    
    function editOnTextChanged(sprite) 
        local hideLabelSprite = Sprite:findChild(sprite, "hideLabel")
        Sprite:setProperty(hideLabelSprite, "text", "")
    end
]]>
</root>
