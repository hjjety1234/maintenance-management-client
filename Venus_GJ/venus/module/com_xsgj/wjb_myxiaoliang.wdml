<?xml version="1.0" encoding="utf-8"?>
	<!--
		==
		============================================================================
		== | WonderTek [ 网络无处不在，沟通及时到达 ] ==
		============================================================================
		== | Copyright (c) 2012, WonderTek, Inc. All Rights Reserved. ==
		============================================================================
		== | Author: xxxx <xxxx@xxxx.com> ==
		============================================================================
		== | Desc: 页面描述 ==
		============================================================================
	-->
<root>
	<header />
	<body resolution="480,800" BuildChildrenFinished="bodyBuildChildrenFinished" OnSpriteEvent="bodyOnSpriteEvent" OnPluginEvent="bodyOnPluginEvent">
		<node name="mainNode" rect="0,0,480,800" enable="true" active="true" OnKeyUp="mainNodeOnKeyUp" layouttype="1" extendstyle="1111" style="autosize">
			<!-- 设置背景 -->
			 <shadow rect="0,0,480,800"  alpha="255" extendstyle="1111">
                <image name="titleBg" rect="0,0,480,800" src="file://pics/main_bg.png" extendstyle="1111" style="autosize"/>               
             </shadow>
			<!-- 信息头部 -->
			<node rect="0,0,480,80" extendstyle="1111" style="autosize">
				<image name="titleBg" rect="0,0,480,80" src="file://pics/sub_top_bg.png" extendstyle="0010" style="autosize"/>
				<!-- 返回按钮 -->
				<button name="backBtn" rect="9,14,52,52" OnSelect="doBack" style="autosize" extendstyle="0010" normal="normal" sel="sel">
					<image name="normal" rect="0,0,52,52" src="file://pics/icon_home_d.png" style="autosize" extendstyle="0010"/>					
					<image name="sel" rect="0,0,52,52" src="file://pics/icon_home_s.png" style="autosize" extendstyle="0010"/>             
				</button>
				<image name="normal" rect="70,0,2,80" src="file://pics/sub_top_line.png" extendstyle="0010"/>
				<!-- 二级菜单标题 -->
				<scrolltext name="title" rect="100,0,280,70" text="销量分析" font-family="微软雅黑" extendstyle="0010" font-size="30" h-align="center" v-align="center" color="#ffffff" scroll="true" step="2"/>				
			</node> 
			<node  rect="0,80,480,48"  extendstyle="1111" style="autosize" >
			     <image rect="0,0,480,48" src="file://pics/xiaoshou_bj.png" style="autosize" extendstyle="0010"/> 
			    <button name="zuodianji" rect="0,0,70,48" OnSelect="zuodianjiOnSelect" style="autosize" extendstyle="1111" normal="normal" sel="sel">
                    <image name="normal" rect="0,0,70,48" src="file://pics/left_d.png" style="autosize" extendstyle="0010"/>
                    <image name="sel" rect="0,0,70,48" src="file://pics/left_s.png" style="autosize" extendstyle="0010"/>                   
                </button>
                <label name="nianlabel1" rect="110,0,50,48" text="" font-family="微软雅黑" font-size="24" h-align="center" v-align="center" color="#ffffff" style="autosize" extendstyle="0010"/> 
                <label rect="160,0,5,48" text="-" font-family="微软雅黑" font-size="24" h-align="center" v-align="center" color="#ffffff" style="autosize" extendstyle="0010"/> 
                <label name="yuelabel1" rect="165,0,25,48" text="" font-family="微软雅黑" font-size="24" h-align="center" v-align="center" color="#ffffff" style="autosize" extendstyle="0010"/> 
                <label rect="190,0,5,48" text="-" font-family="微软雅黑" font-size="24" h-align="center" v-align="center" color="#ffffff" style="autosize" extendstyle="0010"/> 
                <label name="rilabel1" rect="195,0,25,48" text="" font-family="微软雅黑" font-size="24" h-align="center" v-align="center" color="#ffffff" style="autosize" extendstyle="0010"/> 
                <label rect="230,0,20,48" text="至" font-family="微软雅黑" font-size="24" h-align="center" v-align="center" color="#ffffff" style="autosize" extendstyle="0010"/> 
                <label name="nianlabel2" rect="260,0,50,48" text="" font-family="微软雅黑" font-size="24" h-align="center" v-align="center" color="#ffffff" style="autosize" extendstyle="0010"/> 
                <label rect="310,0,5,48" text="-" font-family="微软雅黑" font-size="24" h-align="center" v-align="center" color="#ffffff" style="autosize" extendstyle="0010"/> 
                <label name="yuelabel2" rect="315,0,25,48" text="" font-family="微软雅黑" font-size="24" h-align="center" v-align="center" color="#ffffff" style="autosize" extendstyle="0010"/> 
                <label rect="340,0,5,48" text="-" font-family="微软雅黑" font-size="24" h-align="center" v-align="center" color="#ffffff" style="autosize" extendstyle="0010"/> 
                <label name="rilabel2" rect="345,0,25,48" text="" font-family="微软雅黑" font-size="24" h-align="center" v-align="center" color="#ffffff" style="autosize" extendstyle="0010"/> 
                <button name="youdianji" rect="409,0,71,48" OnSelect="youdianjiOnSelect" style="autosize" extendstyle="1111" normal="normal" sel="sel">
                    <image name="normal" rect="0,0,71,48" src="file://pics/right_d.png" style="autosize" extendstyle="0010"/>
                    <image name="sel" rect="0,0,71,48" src="file://pics/right_s.png" style="autosize" extendstyle="0010"/>                   
                </button>    
			</node> 
			<node rect="0,128,480,48"  extendstyle="1111" style="autosize" >
                <image rect="0,0,480,48" src="file://pics/xiaoshou_bj2.png" style="autosize" extendstyle="0010"/>                    
                <button name="dangtian" rect="10,3,79,42"  OnSelect="dangtianOnSelect" data="0" style="autosize" extendstyle="1111" >
                    <image name="dangtianimg" rect="0,0,79,42" src="file://pics/day_d.png" style="autosize" extendstyle="0010"/>                   
                    <label name="dangtianlabel" rect="0,0,79,42" text="天" font-family="微软雅黑" font-size="24" h-align="center" v-align="center" color="#686464" style="autosize" extendstyle="0010"/>
                </button>
                <button name="dangyue" rect="90,3,79,42" OnSelect="dangyueOnSelect" data="0" style="autosize" extendstyle="1111" >
                    <image name="dangyueimg" rect="0,0,79,42" src="file://pics/month_d.png" style="autosize" extendstyle="0010"/>                   
                    <label name="dangyuelabel" rect="0,0,79,42" text="月" font-family="微软雅黑" font-size="24" h-align="center" v-align="center" color="#686464" style="autosize" extendstyle="0010"/>
                </button>
                <button name="dangjidu" rect="170,3,79,42" OnSelect="dangjiduOnSelect" data="0" style="autosize" extendstyle="1111" >
                    <image name="dangjiduimg" rect="0,0,79,42" src="file://pics/month_d.png" style="autosize" extendstyle="0010"/>                  
                    <label name="dangjidulabel" rect="0,0,79,42" text="季度" font-family="微软雅黑" font-size="24" h-align="center" v-align="center" color="#686464" style="autosize" extendstyle="0010"/>
                </button>
                <button name="dangnian" rect="250,3,79,42" OnSelect="dangnianOnSelect" data="0" style="autosize" extendstyle="1111" >
                    <image name="dangnianimg" rect="0,0,79,42" src="file://pics/year_d.png" style="sudoku-auto" sudoku="20,0,20,0" extendstyle="0010"/>                   
                    <label name="dangnianlabel" rect="0,0,79,42" text="年" font-family="微软雅黑" font-size="24" h-align="center" v-align="center" color="#686464" style="autosize" extendstyle="0010"/>
                </button>
                <button name="mendian" rect="335,2,67,43" OnSelect="mendianOnSelect" data="0" style="autosize" extendstyle="1111" >
                    <image name="mendianimg" rect="0,0,67,43" src="file://pics/bumeng_d.png" style="autosize" extendstyle="0010"/>                   
                    <label name="mendianlabel" rect="0,0,67,43" text="门店" font-family="微软雅黑" font-size="24" h-align="center" v-align="center" color="#686464" style="autosize" extendstyle="0010"/>
                </button>   
                <button name="shangpin" rect="403,2,67,43" OnSelect="shangpinOnSelect" data="0" style="autosize" extendstyle="1111" >
                    <image name="shangpinimg" rect="0,0,67,43" src="file://pics/shangping_d.png" style="autosize" extendstyle="0010"/>                   
                    <label name="shangpinlabel" rect="0,0,67,43" text="商品" font-family="微软雅黑" font-size="24" h-align="center" v-align="center" color="#686464" style="autosize" extendstyle="0010"/>
                </button>                       
            </node>          
            <node name="error" rect="0,176,480,624" visible="false" extendstyle="1111" style="autosize" >  
                <image rect="120,140,239,234" src="file://pics/face.png" style="autosize" extendstyle="1111" />
                <label rect="0,380,480,50" text="没有搜索到您要的数据" font-family="微软雅黑" font-size="32" h-align="center" v-align="center" color="#686464" style="autosize" extendstyle="0010" />
            </node>             
            <node name="showoftab" rect="15,176,450,624" extendstyle="1111" style="autosize" visible="true" enable="true">                
                <node name="listNode" rect="0,0,450,624" extendstyle="1111" visible="true" enable="true">
                    <scrolltext name="jine" rect="0,12,450,40" text="" font-family="微软雅黑" extendstyle="1111" font-size="28" h-align="center" v-align="center" color="#0" scroll="true" step="2"/>
                    
                    <!--  <label rect="100,12,100,40" text="总金额:" font-family="微软雅黑" font-size="28" h-align="center" v-align="center" color="#0" style="autosize" extendstyle="1111"/> 
                    <scrolltext name="jine" rect="200,12,120,40" text="" font-family="微软雅黑" extendstyle="1111" font-size="28" h-align="center" v-align="center" color="#0" scroll="true" step="2"/>                
                     <label rect="320,12,30,40" text="元" font-family="微软雅黑" font-size="28" h-align="center" v-align="center" color="#0" style="autosize" extendstyle="1111"/>  --> 
                    <listview name="BaobiaoList" rect="0,64,450,540" extendstyle="1111" auto-scroll="true" style="autosize"
                        auto-adjust="true" >
                    </listview>
                </node>
            </node>
            <node name="BaobiaoListItem" visible="false" enable="false" active="false" rect="0,0,450,70">
                <scrolltext name="mingcheng" rect="5,0,240,30" text="" color="#3a3735" v-align="center"
                     h-align="left" font-size="24" font-family="微软雅黑" scroll="true" step="2" extendstyle="1111"/>
                <scrolltext name="wancheng" rect="305,0,140,30" text="" color="#3a3735" v-align="center"
                     h-align="right" font-size="24" font-family="微软雅黑" scroll="true" step="2" extendstyle="1111"/>
                <shadow name="" rect="5,42,440,5" color="#3a3735" alpha="200" extendstyle="1111"/>
                <image name="jichu" rect="5,32,440,25" src="" style="sudoku-auto" sudoku="15,5,15,5"  extendstyle="1111"/>              
            </node>                                
	  </node>  
	</body>
    <![CDATA[

    require 'com_xsgj.common.framework'
    require 'com_xsgj.common.webbrowser'
     require 'com_xsgj.common.umsagent'
    local rootSprite
    local user_name = Config:get('truename')
    local user_code = Config:get('username')
    local jsonDecodedData = nil
    local address_port = Alias.urlServer
    local url
    local param2
    local rilabel1
    local rilabel2
    local yuelabel1
    local yuelabel2
    local nianlabel1
    local nianlabel2
    local biaozhi
    local error
    local totalmoney
    local maxtree=0
      
    ---------------------------------------callbacks--------------------------------
    -- @brief root子节点创建完事件
    function bodyBuildChildrenFinished(sprite)        
        rootSprite = sprite 
        rilabel1 = Sprite:findChild(rootSprite,"rilabel1")
        rilabel2 = Sprite:findChild(rootSprite,"rilabel2")
        yuelabel1 = Sprite:findChild(rootSprite,"yuelabel1")
        yuelabel2 = Sprite:findChild(rootSprite,"yuelabel2")
        nianlabel1 = Sprite:findChild(rootSprite,"nianlabel1")
        nianlabel2 = Sprite:findChild(rootSprite,"nianlabel2") 
        error = Sprite:findChild(rootSprite, 'error')
        showoftab = Sprite:findChild(rootSprite, 'showoftab')
        listNode = Sprite:findChild(showoftab, 'listNode') 
        jine = Sprite:findChild(listNode, 'jine')               
    end
    -- @brief root节点消息方法
    function bodyOnSpriteEvent(msg, param)
        if msg == MSG_ACTIVATE then -- 页面激活          
            UmsAgent:OnActivate(string.match(Alias.wjb_myxiaoliang, 'MODULE:\\(.*)'), "销量分析")
            local mendian=Sprite:findChild(rootSprite,"mendian")
            local dangtian=Sprite:findChild(rootSprite,"dangtian")
            Sprite:setVisible(error,0)
            Sprite:setVisible(showoftab,0)
            mendian2()
            dangtianOnSelect(dangtian)            
        elseif msg == MSG_DEACTIVATE then     
            UmsAgent:OnDeactivate()                
        end
    end
    -- @brief 插件消息方法
    function bodyOnPluginEvent(msg)  
        if msg == 101 then       
           UmsAgent:onLoadFinish()              
           jsonDecodedData = Http:jsonDecode("duru")    
           if (jsonDecodedData == nil) then               
                Sprite:setVisible(error,1)
                Sprite:setEnable(error,1)  
                Sprite:setVisible(showoftab,0)
                Sprite:setEnable(showoftab,0)              
                return
           end  
           local len = tonumber(jsonDecodedData["Total"])
           if len>0 then
               Sprite:setVisible(error,0)
               Sprite:setEnable(error, 0)
               maxtree = getMaxtree(len) 
               local list = Sprite:findChild(rootSprite, 'BaobiaoList')
               ListView:removeAllItems(list, true)          
               ListView:loadItem(list, Sprite:findChild(rootSprite, 'BaobiaoListItem'), len, 'loadListItem')
               ListView:adjust(list)
               Sprite:setProperty(jine,"text",'总金额:￥'..totalmoney..'元') 
               Sprite:setVisible(showoftab,1)
               Sprite:setEnable(showoftab,1)          
              -- refresh('single',mendianName,mendianMoney,'Column3D.swf','flash')
              -- refresh('总金额:'..totalmoney.."元",mendianName,mendianMoney,'single','bar')                            
           else
               Sprite:setVisible(error,1)
               Sprite:setEnable(error,1)
               Sprite:setVisible(showoftab,0) 
               Sprite:setEnable(showoftab,0)            
               return  
           end 
        end
        if msg== 102 then
           jsonDecodedData=Http:jsonDecode("duqu")    
           if (jsonDecodedData == nil) then               
                Sprite:setVisible(error,1)
                Sprite:setEnable(error,1)  
                Sprite:setVisible(showoftab,0)
                Sprite:setEnable(showoftab,0)                
                return
           end  
           local len = tonumber(jsonDecodedData["Total"])
           if len>0 then
               Sprite:setVisible(error,0)
               Sprite:setEnable(error, 0) 
               maxtree = getMaxtree(len)
               local list = Sprite:findChild(rootSprite, 'BaobiaoList')
               ListView:removeAllItems(list, true)          
               ListView:loadItem(list, Sprite:findChild(rootSprite, 'BaobiaoListItem'), len, 'loadListItem2')
               ListView:adjust(list)
               Sprite:setProperty(jine,"text",'总金额：￥'..totalmoney..'元')
               Sprite:setVisible(showoftab,1)
               Sprite:setEnable(showoftab,1)  
               --refresh('single',mendianName,mendianMoney,'Column3D.swf','flash')
               --refresh('总金额:'..totalmoney.."元",shangpinName,shangpinMoney,'single','bar')                             
           else
               Sprite:setVisible(error,1)
               Sprite:setEnable(error,1)
               Sprite:setVisible(showoftab,0) 
               Sprite:setEnable(showoftab,0)            
               return  
           end 
        end   
    end         

    -- @brief 按键响应处理
    function mainNodeOnKeyUp(sprite, kc)
        if kc == Key.F2 then -- 按下返回键
            Scene:back()
            return 1
        end
    end
    ---------------------------------------util functions---------------------------
    function myfunc()
    end
      
    function doBack()
       Scene:go('MODULE:\\com_xsgj\\home.wdml')
    end
    
    function shangpinOnSelect(sprite)
       local data = Sprite:getData(sprite);
       if (data == "0") then
          local shangpinimg = Sprite:findChild(sprite,"shangpinimg")
          Sprite:setProperty(shangpinimg,"src","file://pics/shangping_s.png")
          local shangpinlabel = Sprite:findChild(sprite,"shangpinlabel")
          Sprite:setProperty(shangpinlabel,"color","#ffffff")
          Sprite:setProperty(sprite,"data","1")
          local mendian = Sprite:findChild(rootSprite,"mendian")
          local mendianimg = Sprite:findChild(mendian,"mendianimg")
          Sprite:setProperty(mendianimg,"src","file://pics/bumeng_d.png")
          local mendianlabel = Sprite:findChild(mendian,"mendianlabel")
          Sprite:setProperty(mendianlabel,"color","#686464") 
          Sprite:setProperty(mendian,"data","0")
          biaozhi = 2
          duqushuju()
       end
    end
    
    function mendianOnSelect(sprite)
       local data = Sprite:getData(sprite);
       if (data == "0") then
          local mendianimg = Sprite:findChild(sprite,"mendianimg")
          Sprite:setProperty(mendianimg,"src","file://pics/bumeng_s.png")
          local mendianlabel = Sprite:findChild(sprite,"mendianlabel")
          Sprite:setProperty(mendianlabel,"color","#ffffff")
          Sprite:setProperty(sprite,"data","1")
          local shangpin = Sprite:findChild(rootSprite,"shangpin")
          local shangpinimg = Sprite:findChild(shangpin,"shangpinimg")
          Sprite:setProperty(shangpinimg,"src","file://pics/shangping_d.png")
          local shangpinlabel = Sprite:findChild(shangpin,"shangpinlabel")
          Sprite:setProperty(shangpinlabel,"color","#686464") 
          Sprite:setProperty(shangpin,"data","0")
          biaozhi = 1
          duqushuju()
       end
    end
    
    function mendian2()
       local mendian = Sprite:findChild(rootSprite,"mendian")
       local data = Sprite:getData(mendian);
       if (data == "0") then
          local mendianimg = Sprite:findChild(mendian,"mendianimg")
          Sprite:setProperty(mendianimg,"src","file://pics/bumeng_s.png")
          local mendianlabel = Sprite:findChild(mendian,"mendianlabel")
          Sprite:setProperty(mendianlabel,"color","#ffffff")
          Sprite:setProperty(mendian,"data","1")
          local shangpin = Sprite:findChild(rootSprite,"shangpin")
          local shangpinimg = Sprite:findChild(shangpin,"shangpinimg")
          Sprite:setProperty(shangpinimg,"src","file://pics/shangping_d.png")
          local shangpinlabel = Sprite:findChild(shangpin,"shangpinlabel")
          Sprite:setProperty(shangpinlabel,"color","#686464") 
          Sprite:setProperty(shangpin,"data","0")
          biaozhi = 1
       end
    end
    
    function dangtianOnSelect(sprite)
       local data = Sprite:getData(sprite);
       if (data == "0") then
          local dangtianimg = Sprite:findChild(sprite,"dangtianimg")
          Sprite:setProperty(dangtianimg,"src","file://pics/day_s.png")
          local dangtianlabel = Sprite:findChild(sprite,"dangtianlabel")
          Sprite:setProperty(dangtianlabel,"color","#ffffff")
          Sprite:setProperty(sprite,"data","1")
          local dangyue = Sprite:findChild(rootSprite,"dangyue")
          local dangyueimg = Sprite:findChild(dangyue,"dangyueimg")
          Sprite:setProperty(dangyueimg,"src","file://pics/month_d.png")
          local dangyuelabel = Sprite:findChild(dangyue,"dangyuelabel")
          Sprite:setProperty(dangyuelabel,"color","#686464") 
          Sprite:setProperty(dangyue,"data","0")
          local dangjidu = Sprite:findChild(rootSprite,"dangjidu")
          local dangjiduimg = Sprite:findChild(dangjidu,"dangjiduimg")
          Sprite:setProperty(dangjiduimg,"src","file://pics/month_d.png")
          local dangjidulabel = Sprite:findChild(dangjidu,"dangjidulabel")
          Sprite:setProperty(dangjidulabel,"color","#686464") 
          Sprite:setProperty(dangjidu,"data","0")
          local dangnian = Sprite:findChild(rootSprite,"dangnian")
          local dangnianimg = Sprite:findChild(dangnian,"dangnianimg")
          Sprite:setProperty(dangnianimg,"src","file://pics/year_d.png")
          local dangnianlabel = Sprite:findChild(dangnian,"dangnianlabel")
          Sprite:setProperty(dangnianlabel,"color","#686464") 
          Sprite:setProperty(dangnian,"data","0")        
          Sprite:setProperty(nianlabel1,"text",os.date("*t")["year"])
          Sprite:setProperty(nianlabel2,"text",os.date("*t")["year"])         
          Sprite:setProperty(yuelabel1,"text",os.date("*t")["month"])
          Sprite:setProperty(yuelabel2,"text",os.date("*t")["month"])        
          Sprite:setProperty(rilabel1,"text",os.date("*t")["day"])
          Sprite:setProperty(rilabel2,"text",os.date("*t")["day"])
          duqushuju()
       end
    end
    
    function dangyueOnSelect(sprite)
       local data = Sprite:getData(sprite);
       if (data == "0") then
          local dangyueimg = Sprite:findChild(sprite,"dangyueimg")
          Sprite:setProperty(dangyueimg,"src","file://pics/month_s.png")
          local dangyuelabel = Sprite:findChild(sprite,"dangyuelabel")
          Sprite:setProperty(dangyuelabel,"color","#ffffff")
          Sprite:setProperty(sprite,"data","1")
          local dangtian = Sprite:findChild(rootSprite,"dangtian")
          local dangtianimg = Sprite:findChild(dangtian,"dangtianimg")
          Sprite:setProperty(dangtianimg,"src","file://pics/day_d.png")
          local dangtianlabel = Sprite:findChild(dangtian,"dangtianlabel")
          Sprite:setProperty(dangtianlabel,"color","#686464") 
          Sprite:setProperty(dangtian,"data","0")
          local dangjidu = Sprite:findChild(rootSprite,"dangjidu")
          local dangjiduimg = Sprite:findChild(dangjidu,"dangjiduimg")
          Sprite:setProperty(dangjiduimg,"src","file://pics/month_d.png")
          local dangjidulabel = Sprite:findChild(dangjidu,"dangjidulabel")
          Sprite:setProperty(dangjidulabel,"color","#686464") 
          Sprite:setProperty(dangjidu,"data","0")
          local dangnian = Sprite:findChild(rootSprite,"dangnian")
          local dangnianimg = Sprite:findChild(dangnian,"dangnianimg")
          Sprite:setProperty(dangnianimg,"src","file://pics/year_d.png")
          local dangnianlabel = Sprite:findChild(dangnian,"dangnianlabel")
          Sprite:setProperty(dangnianlabel,"color","#686464") 
          Sprite:setProperty(dangnian,"data","0")         
          Sprite:setProperty(nianlabel1,"text",os.date("*t",os.time()+86400)["year"])
          Sprite:setProperty(nianlabel2,"text",os.date("*t",os.time()+86400)["year"])        
          Sprite:setProperty(yuelabel1,"text",os.date("*t",os.time()+86400)["month"])
          Sprite:setProperty(yuelabel2,"text",os.date("*t",os.time()+86400)["month"])         
          Sprite:setProperty(rilabel1,"text","1")
          local yue = Sprite:getText(yuelabel1)
          if(yue=="1" or yue=="3" or yue=="5" or yue=="7" or yue=="8" or yue=="10" or yue=="12") then
              Sprite:setProperty(rilabel2,"text","31")
          elseif (yue=="4" or yue=="6" or yue=="9" or yue=="11") then
              Sprite:setProperty(rilabel2,"text","30")
          elseif yue=="2" then
              local nian = tonumber(Sprite:getText(nianlabel1))
              if nian % 400 == 0 or (nian % 4 == 0 and nian % 100 ~=0 ) then
                  Sprite:setProperty(rilabel2,"text","29")
              else
                  Sprite:setProperty(rilabel2,"text","28")
              end
          end
          duqushuju()
       end
    end
    
    function dangjiduOnSelect(sprite)
       local data = Sprite:getData(sprite);
       if (data == "0") then
          local dangjiduimg = Sprite:findChild(sprite,"dangjiduimg")
          Sprite:setProperty(dangjiduimg,"src","file://pics/month_s.png")
          local dangjidulabel = Sprite:findChild(sprite,"dangjidulabel")
          Sprite:setProperty(dangjidulabel,"color","#ffffff")
          Sprite:setProperty(sprite,"data","1")
          local dangtian = Sprite:findChild(rootSprite,"dangtian")
          local dangtianimg = Sprite:findChild(dangtian,"dangtianimg")
          Sprite:setProperty(dangtianimg,"src","file://pics/day_d.png")
          local dangtianlabel = Sprite:findChild(dangtian,"dangtianlabel")
          Sprite:setProperty(dangtianlabel,"color","#686464") 
          Sprite:setProperty(dangtian,"data","0")
          local dangyue = Sprite:findChild(rootSprite,"dangyue")
          local dangyueimg = Sprite:findChild(dangyue,"dangyueimg")
          Sprite:setProperty(dangyueimg,"src","file://pics/month_d.png")
          local dangyuelabel = Sprite:findChild(dangyue,"dangyuelabel")
          Sprite:setProperty(dangyuelabel,"color","#686464") 
          Sprite:setProperty(dangyue,"data","0")
          local dangnian = Sprite:findChild(rootSprite,"dangnian")
          local dangnianimg = Sprite:findChild(dangnian,"dangnianimg")
          Sprite:setProperty(dangnianimg,"src","file://pics/year_d.png")
          local dangnianlabel = Sprite:findChild(dangnian,"dangnianlabel")
          Sprite:setProperty(dangnianlabel,"color","#686464") 
          Sprite:setProperty(dangnian,"data","0")         
          Sprite:setProperty(nianlabel1,"text",os.date("*t",os.time()+86400)["year"])
          Sprite:setProperty(nianlabel2,"text",os.date("*t",os.time()+86400)["year"])
          local yue = tostring(os.date("*t",os.time()+86400)["month"])          
          if (yue=="1" or yue=="2" or yue=="3") then
              Sprite:setProperty(yuelabel1,"text","1")
              Sprite:setProperty(rilabel1,"text","1")
              Sprite:setProperty(yuelabel2,"text","3")
              Sprite:setProperty(rilabel2,"text","31")
          elseif (yue=="4" or yue=="5" or yue=="6") then
              Sprite:setProperty(yuelabel1,"text","4")
              Sprite:setProperty(rilabel1,"text","1")
              Sprite:setProperty(yuelabel2,"text","6")
              Sprite:setProperty(rilabel2,"text","30")
          elseif (yue=="7" or yue=="8" or yue=="9") then
              Sprite:setProperty(yuelabel1,"text","7")
              Sprite:setProperty(rilabel1,"text","1")
              Sprite:setProperty(yuelabel2,"text","9")
              Sprite:setProperty(rilabel2,"text","30")
          elseif (yue=="10" or yue=="11" or yue=="12") then
              Sprite:setProperty(yuelabel1,"text","10")
              Sprite:setProperty(rilabel1,"text","1")
              Sprite:setProperty(yuelabel2,"text","12")
              Sprite:setProperty(rilabel2,"text","31")
          end
          duqushuju()        
       end
    end
    
    function dangnianOnSelect(sprite)
       local data = Sprite:getData(sprite);
       if (data == "0") then
          local dangnianimg = Sprite:findChild(sprite,"dangnianimg")
          Sprite:setProperty(dangnianimg,"src","file://pics/year_s.png")
          local dangnianlabel = Sprite:findChild(sprite,"dangnianlabel")
          Sprite:setProperty(dangnianlabel,"color","#ffffff")
          Sprite:setProperty(sprite,"data","1")
          local dangtian = Sprite:findChild(rootSprite,"dangtian")
          local dangtianimg = Sprite:findChild(dangtian,"dangtianimg")
          Sprite:setProperty(dangtianimg,"src","file://pics/day_d.png")
          local dangtianlabel = Sprite:findChild(dangtian,"dangtianlabel")
          Sprite:setProperty(dangtianlabel,"color","#686464") 
          Sprite:setProperty(dangtian,"data","0")
          local dangyue = Sprite:findChild(rootSprite,"dangyue")
          local dangyueimg = Sprite:findChild(dangyue,"dangyueimg")
          Sprite:setProperty(dangyueimg,"src","file://pics/month_d.png")
          local dangyuelabel = Sprite:findChild(dangyue,"dangyuelabel")
          Sprite:setProperty(dangyuelabel,"color","#686464") 
          Sprite:setProperty(dangyue,"data","0")
          local dangjidu = Sprite:findChild(rootSprite,"dangjidu")
          local dangjiduimg = Sprite:findChild(dangjidu,"dangjiduimg")
          Sprite:setProperty(dangjiduimg,"src","file://pics/month_d.png")
          local dangjidulabel = Sprite:findChild(dangjidu,"dangjidulabel")
          Sprite:setProperty(dangjidulabel,"color","#686464") 
          Sprite:setProperty(dangjidu,"data","0")          
          Sprite:setProperty(nianlabel1,"text",os.date("*t",os.time()+86400)["year"])
          Sprite:setProperty(nianlabel2,"text",os.date("*t",os.time()+86400)["year"])         
          Sprite:setProperty(yuelabel1,"text","1")
          Sprite:setProperty(yuelabel2,"text","12")
          Sprite:setProperty(rilabel1,"text","1")
          Sprite:setProperty(rilabel2,"text","31")
          duqushuju()
       end
    end
    
    function zuodianjiOnSelect(sprite)
       local dangtian = Sprite:findChild(rootSprite,"dangtian")
       local dangtianData = Sprite:getData(dangtian)
       local dangyue = Sprite:findChild(rootSprite,"dangyue")
       local dangyueData = Sprite:getData(dangyue)
       local dangjidu = Sprite:findChild(rootSprite,"dangjidu")
       local dangjiduData = Sprite:getData(dangjidu)
       local dangnian = Sprite:findChild(rootSprite,"dangnian")
       local dangnianData = Sprite:getData(dangnian)
       if (dangnianData == '1') then
           local nian = tonumber(Sprite:getText(nianlabel1))
           nian = nian - 1
           Sprite:setProperty(nianlabel1,"text",nian)
           Sprite:setProperty(nianlabel2,"text",nian)
       end
       if (dangyueData == '1') then
           local yue = Sprite:getText(yuelabel1)
           if (yue == '1') then
              local nian = tonumber(Sprite:getText(nianlabel1))
              nian = nian - 1
              Sprite:setProperty(nianlabel1,"text",nian)
              Sprite:setProperty(nianlabel2,"text",nian)
              Sprite:setProperty(yuelabel1,"text","12")
              Sprite:setProperty(yuelabel2,"text","12")
              Sprite:setProperty(rilabel2,"text","31")             
           else
              Sprite:setProperty(yuelabel1,"text",tonumber(yue)-1)
              Sprite:setProperty(yuelabel2,"text",tonumber(yue)-1)
              local yue3 = Sprite:getText(yuelabel2)
              if(yue3=="1" or yue3=="3" or yue3=="5" or yue3=="7" or yue3=="8" or yue3=="10" or yue3=="12") then
                 Sprite:setProperty(rilabel2,"text","31")
              elseif (yue3=="4" or yue3=="6" or yue3=="9" or yue3=="11") then
                 Sprite:setProperty(rilabel2,"text","30")
              elseif yue3=="2" then
                 local nian = tonumber(Sprite:getText(nianlabel1))
                 if nian % 400 == 0 or (nian % 4 == 0 and nian % 100 ~=0 ) then
                      Sprite:setProperty(rilabel2,"text","29")
                 else
                      Sprite:setProperty(rilabel2,"text","28")
                 end
              end             
           end
       end
       if (dangjiduData == '1') then
           local yue = Sprite:getText(yuelabel1)
           local yue2 = tonumber(Sprite:getText(yuelabel2))
           if (yue == '1') then
              local nian = tonumber(Sprite:getText(nianlabel1))
              nian = nian - 1
              Sprite:setProperty(nianlabel1,"text",nian)
              Sprite:setProperty(nianlabel2,"text",nian)
              Sprite:setProperty(yuelabel1,"text","10")
              Sprite:setProperty(yuelabel2,"text","12")
           else
              Sprite:setProperty(yuelabel1,"text",tonumber(yue)-3)
              Sprite:setProperty(yuelabel2,"text",yue2-3)
              local yue3 = Sprite:getText(yuelabel2)
              if( yue3=='6' or  yue3=='9' ) then
                  Sprite:setProperty(rilabel2,"text",'30')
              elseif ( yue3=='3' or  yue3=='12' ) then
                  Sprite:setProperty(rilabel2,"text",'31')
              end                   
           end
       end
       if (dangtianData == '1') then
           local nian = tonumber(Sprite:getText(nianlabel1))
           local yue = Sprite:getText(yuelabel1)
           local ri = Sprite:getText(rilabel1)
           if(yue=="2" or yue=="4" or yue=="6" or yue=="8" or yue=="9" or yue=="11") and ri=="1" then
              Sprite:setProperty(yuelabel1,"text", tonumber(yue)-1)
              Sprite:setProperty(yuelabel2,"text", tonumber(yue)-1)
              Sprite:setProperty(rilabel1,"text", "31")  
              Sprite:setProperty(rilabel2,"text", "31")
           elseif ( yue=="1" and  ri=="1" ) then
              Sprite:setProperty(nianlabel1,"text", nian-1)
              Sprite:setProperty(nianlabel2,"text", nian-1)
              Sprite:setProperty(yuelabel1,"text", "12")
              Sprite:setProperty(yuelabel2,"text", "12")             
              Sprite:setProperty(rilabel1,"text", "31")  
              Sprite:setProperty(rilabel2,"text", "31")
           elseif (yue=="5" or yue=="7" or yue=="10" or yue=="12") and ri=="1" then 
              Sprite:setProperty(yuelabel1,"text", tonumber(yue)-1)
              Sprite:setProperty(yuelabel2,"text", tonumber(yue)-1)
              Sprite:setProperty(rilabel1,"text", "30")  
              Sprite:setProperty(rilabel2,"text", "30")
           elseif yue=="3" and ri=="1" and nian % 4 ~= 0 then
              Sprite:setProperty(yuelabel1,"text", tonumber(yue)-1)
              Sprite:setProperty(yuelabel2,"text", tonumber(yue)-1)
              Sprite:setProperty(rilabel1,"text", "28")  
              Sprite:setProperty(rilabel2,"text", "28")            
           elseif yue=="3" and ri=="1" and (nian % 100 == 0 and nian % 400 ~= 0) then
              Sprite:setProperty(yuelabel1,"text", tonumber(yue)-1)
              Sprite:setProperty(yuelabel2,"text", tonumber(yue)-1)
              Sprite:setProperty(rilabel1,"text", "28")  
              Sprite:setProperty(rilabel2,"text", "28")  
           elseif yue=="3" and ri=="1" and (nian % 400 == 0 or (nian % 4 == 0 and nian % 100 ~=0 )) then
              Sprite:setProperty(yuelabel1,"text", tonumber(yue)-1)
              Sprite:setProperty(yuelabel2,"text", tonumber(yue)-1)
              Sprite:setProperty(rilabel1,"text", "29")  
              Sprite:setProperty(rilabel2,"text", "29")       
           else
              Sprite:setProperty(rilabel1,"text",tonumber(ri)-1)  
              Sprite:setProperty(rilabel2,"text",tonumber(ri)-1)
           end          
        end
        duqushuju()
    end
    
    function youdianjiOnSelect(sprite)
       local dangtian = Sprite:findChild(rootSprite,"dangtian")
       local dangtianData = Sprite:getData(dangtian)
       local dangyue = Sprite:findChild(rootSprite,"dangyue")
       local dangyueData = Sprite:getData(dangyue)
       local dangjidu = Sprite:findChild(rootSprite,"dangjidu")
       local dangjiduData = Sprite:getData(dangjidu)
       local dangnian = Sprite:findChild(rootSprite,"dangnian")
       local dangnianData = Sprite:getData(dangnian)
       if (dangnianData == '1') then
           local nian = tonumber(Sprite:getText(nianlabel1))
           nian = nian + 1
           Sprite:setProperty(nianlabel1,"text",nian)
           Sprite:setProperty(nianlabel2,"text",nian)
       end
       if (dangyueData == '1') then
           local yue = Sprite:getText(yuelabel1)
           if (yue == '12') then
              local nian = tonumber(Sprite:getText(nianlabel1))
              nian = nian + 1
              Sprite:setProperty(nianlabel1,"text",nian)
              Sprite:setProperty(nianlabel2,"text",nian)
              Sprite:setProperty(yuelabel1,"text","1")
              Sprite:setProperty(yuelabel2,"text","1")
              Sprite:setProperty(rilabel2,"text","31")             
           else
              Sprite:setProperty(yuelabel1,"text",tonumber(yue)+1)
              Sprite:setProperty(yuelabel2,"text",tonumber(yue)+1)
              local yue3 = Sprite:getText(yuelabel2)
              if(yue3=="1" or yue3=="3" or yue3=="5" or yue3=="7" or yue3=="8" or yue3=="10" or yue3=="12") then
                 Sprite:setProperty(rilabel2,"text","31")
              elseif (yue3=="4" or yue3=="6" or yue3=="9" or yue3=="11") then
                 Sprite:setProperty(rilabel2,"text","30")
              elseif yue3=="2" then
                 local nian = tonumber(Sprite:getText(nianlabel1))
                 if nian % 400 == 0 or (nian % 4 == 0 and nian % 100 ~=0 ) then
                      Sprite:setProperty(rilabel2,"text","29")
                 else
                      Sprite:setProperty(rilabel2,"text","28")
                 end
              end             
           end
       end
       if (dangjiduData == '1') then
           local yue = Sprite:getText(yuelabel1)
           local yue2 = tonumber(Sprite:getText(yuelabel2))
           if (yue == '10') then
              local nian = tonumber(Sprite:getText(nianlabel1))
              nian = nian + 1
              Sprite:setProperty(nianlabel1,"text",nian)
              Sprite:setProperty(nianlabel2,"text",nian)
              Sprite:setProperty(yuelabel1,"text","1")
              Sprite:setProperty(yuelabel2,"text","3")
           else
              Sprite:setProperty(yuelabel1,"text",tonumber(yue)+3)
              Sprite:setProperty(yuelabel2,"text",yue2+3)
              local yue3 = Sprite:getText(yuelabel2)
              if( yue3=='6' or  yue3=='9' ) then
                  Sprite:setProperty(rilabel2,"text",'30')
              elseif ( yue3=='3' or  yue3=='12' ) then
                  Sprite:setProperty(rilabel2,"text",'31')
              end                   
           end
       end
       if (dangtianData == '1') then
           local nian = tonumber(Sprite:getText(nianlabel1))
           local yue = Sprite:getText(yuelabel1)
           local ri = Sprite:getText(rilabel1)
           if(yue=="1" or yue=="3" or yue=="5" or yue=="7" or yue=="8" or yue=="10") and ri=="31" then
              Sprite:setProperty(yuelabel1,"text", tonumber(yue)+1)
              Sprite:setProperty(yuelabel2,"text", tonumber(yue)+1)
              Sprite:setProperty(rilabel1,"text", "1")  
              Sprite:setProperty(rilabel2,"text", "1")
           elseif ( yue=="12" and  ri=="31" ) then
              Sprite:setProperty(nianlabel1,"text", nian+1)
              Sprite:setProperty(nianlabel2,"text", nian+1)
              Sprite:setProperty(yuelabel1,"text", "1")
              Sprite:setProperty(yuelabel2,"text", "1")             
              Sprite:setProperty(rilabel1,"text", "1")  
              Sprite:setProperty(rilabel2,"text", "1")
           elseif (yue=="4" or yue=="6" or yue=="9" or yue=="11") and ri=="30" then 
              Sprite:setProperty(yuelabel1,"text", tonumber(yue)+1)
              Sprite:setProperty(yuelabel2,"text", tonumber(yue)+1)
              Sprite:setProperty(rilabel1,"text", "1")  
              Sprite:setProperty(rilabel2,"text", "1")
           elseif yue=="2" and ri=="28" and nian % 4 ~= 0 then
              Sprite:setProperty(yuelabel1,"text", tonumber(yue)+1)
              Sprite:setProperty(yuelabel2,"text", tonumber(yue)+1)
              Sprite:setProperty(rilabel1,"text", "1")  
              Sprite:setProperty(rilabel2,"text", "1")           
           elseif yue=="2" and ri=="28" and (nian % 100 == 0 and nian % 400 ~= 0) then
              Sprite:setProperty(yuelabel1,"text", tonumber(yue)+1)
              Sprite:setProperty(yuelabel2,"text", tonumber(yue)+1)
              Sprite:setProperty(rilabel1,"text", "1")  
              Sprite:setProperty(rilabel2,"text", "1")
           elseif yue=="2" and ri=="29" and (nian % 400 == 0 or (nian % 4 == 0 and nian % 100 ~=0 )) then
              Sprite:setProperty(yuelabel1,"text", tonumber(yue)+1)
              Sprite:setProperty(yuelabel2,"text", tonumber(yue)+1)
              Sprite:setProperty(rilabel1,"text", "1")  
              Sprite:setProperty(rilabel2,"text", "1")            
           else
              Sprite:setProperty(rilabel1,"text",tonumber(ri)+1)  
              Sprite:setProperty(rilabel2,"text",tonumber(ri)+1)
           end          
        end
        duqushuju()
    end 
    
    function duqushuju()
        totalmoney=0
        local nianlabel1 = Sprite:findChild(rootSprite, 'nianlabel1')
        local yuelabel1 = Sprite:findChild(rootSprite, 'yuelabel1')
        local rilabel1 = Sprite:findChild(rootSprite, 'rilabel1')
        local nianlabel2 = Sprite:findChild(rootSprite, 'nianlabel2')
        local yuelabel2 = Sprite:findChild(rootSprite, 'yuelabel2')
        local rilabel2 = Sprite:findChild(rootSprite, 'rilabel2')
        local kaishiTime = Sprite:getText(nianlabel1).."-"..Sprite:getText(yuelabel1).."-"..Sprite:getText(rilabel1) 
        local jieshuTime = Sprite:getText(nianlabel2).."-"..Sprite:getText(yuelabel2).."-"..Sprite:getText(rilabel2) 
        if biaozhi == 1 then
           UmsAgent:onLoadStart()
           url = "salesReport/searchByStore?"     
           --param2 = "userCode=yandou524&startDate="..kaishiTime.."&endDate="..jieshuTime
           param2 = "userCode="..user_code.."&startDate="..kaishiTime.."&endDate="..jieshuTime
           Http:request("duru", address_port..url, 101,{useCache = false, method = 'post', postData=param2})           
        end
        if biaozhi == 2 then
           url = "salesReport/searchByItem?"     
           --param2 = "userCode=yandou524&startDate="..kaishiTime.."&endDate="..jieshuTime
           param2 = "userCode="..user_code.."&startDate="..kaishiTime.."&endDate="..jieshuTime
           Http:request("duqu", address_port..url, 102,{useCache = false, method = 'post', postData=param2})           
        end
    end
    
    function loadListItem(list, item, index)
        Sprite:setRect(item, 0,0,450,70)
        Sprite:setProperty(item, 'extendstyle', '1111')
        local mingcheng = Sprite:findChild(item, 'mingcheng')
        local wancheng = Sprite:findChild(item, 'wancheng')
        local jichu = Sprite:findChild(item, 'jichu')
         if (jsonDecodedData ~= nil) then
           local value = jsonDecodedData['Rows'][index]
           if value.storeName~=nil then
               Sprite:setProperty(mingcheng, 'text',value.storeName)                             
           end
           if value.totalMoney~=nil then
               Sprite:setProperty(wancheng, 'text','￥'..value.totalMoney..'元')
               if index%4 == 0 then
                 Sprite:setProperty(jichu, 'src','file://pics/bluebar.png')
               elseif index%4 == 1 then
                 Sprite:setProperty(jichu, 'src','file://pics/orange.png')
               elseif index%4 == 2 then          
                 Sprite:setProperty(jichu, 'src','file://pics/green.png')
               elseif index%4 == 3 then
                 Sprite:setProperty(jichu, 'src','file://pics/yellow.png')
               end
               Sprite:setRect(jichu, 5,32,440*tonumber(value.totalMoney)/maxtree,25)
               totalmoney=totalmoney+value.totalMoney
           end                 
         end
    end
    
    --function  refresh(title, labels, values, seriesType, showType)       
    --    local x,y,w,h = GetSpriteFactScreenRect(error)
    --    showWebView(x,y,w,h)
    --    showHighCharts(title, labels, values, seriesType, showType)  
    --end     
    
    function loadListItem2(list, item, index)
         Sprite:setRect(item, 0,0,450,70)
         Sprite:setProperty(item, 'extendstyle', '1111')
         local mingcheng = Sprite:findChild(item, 'mingcheng')
         local wancheng = Sprite:findChild(item, 'wancheng')
         local jichu = Sprite:findChild(item, 'jichu')
         if (jsonDecodedData ~= nil) then
           local value = jsonDecodedData['Rows'][index]
           if value.itemName~=nil and value.saleNum~=nil and value.itemUnit~=nil then
               Sprite:setProperty(mingcheng, 'text',value.itemName..' ('..value.saleNum..value.itemUnit..')')                         
           end
           if value.totalMoney~=nil then
               Sprite:setProperty(wancheng, 'text','￥'..value.totalMoney..'元')
               if index%4 == 0 then
                 Sprite:setProperty(jichu, 'src','file://pics/bluebar.png')
               elseif index%4 == 1 then
                 Sprite:setProperty(jichu, 'src','file://pics/orange.png')
               elseif index%4 == 2 then          
                 Sprite:setProperty(jichu, 'src','file://pics/green.png')
               elseif index%4 == 3 then
                 Sprite:setProperty(jichu, 'src','file://pics/yellow.png')
               end
               Sprite:setRect(jichu, 5,32,440*tonumber(value.totalMoney)/maxtree,25)
               totalmoney=totalmoney+value.totalMoney
           end                        
         end
    end
    
    function getMaxtree(len)
        local Maxtree = 0
        for i=0,len-1 do
            if jsonDecodedData['Rows'][i].totalMoney~=nil then
               local tree = tonumber(jsonDecodedData['Rows'][i].totalMoney)
               if tree > Maxtree then
                  Maxtree = tree
               end
            end
        end
        return Maxtree
    end
                
]]>
</root>
