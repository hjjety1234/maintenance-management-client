<?xml version="1.0" encoding="utf-8"?>
	<!--
		==
		============================================================================
		== | WonderTek [ 网络无处不在，沟通及时到达 ] ==
		============================================================================
		== | Copyright (c) 2012, WonderTek, Inc. All Rights Reserved. ==
		============================================================================
		== | Author: xxxx <xxxx@xxxx.com> ==
		============================================================================
		== | Desc: 页面描述 ==
		============================================================================
		
		内容比较全的首页
	-->
<root>
	<header />
	<body resolution="480,800" BuildChildrenFinished="bodyBuildChildrenFinished"
		OnSpriteEvent="bodyOnSpriteEvent" OnPluginEvent="bodyOnPluginEvent">
		<!-- 背景图片 -->
        <image name="title" rect="0,0,480,800" border="false"
            src="" style="autosize" extendstyle="1111"></image>

        <!-- 主页面 -->
        <node name="mainNode" rect="0,0,480,800" active="true" enable="true"
            layouttype="1" OnKeyUp="mainNodeOnKeyUp" extendstyle="1111">
            <!-- 页面标题部分  -->
            <node rect="0,0,480,100" name="titleNode" extendstyle="1111">
                <!-- 标题背景图片 -->
                <image name="subtopbg" rect="0,-10,480,110" border="false"
                    src="" style="autosize" extendstyle="1111">     
                </image>
                
              <!--  <scrolltext name="title" rect="70,0,280,100" text="颍上公安考勤系统" font-family="黑体" 
                    extendstyle="1111" font-size="30" h-align="center" v-align="center"
                    color="#ffffff" scroll="true" step="2"></scrolltext> --> 
            </node>

			<!--页面中间主体  -->
			<node rect="0,100,480,600" extendstyle="1111">				
						<node name="listNode" rect="0,0,480,600" extendstyle="1111">
							<list name="listview1" rect="0,0,480,600" extendstyle="1111"
								line="4" col="4" auto-adjust="true" offset="0,0">
								<list-item rect="0,0,120,165" extendstyle="1111">
									<button rect="7,17,90,100" OnSelect="listItemOnSelect" frame="false"
										normal="normal" sel="sel" color="#2d547b" data="$(dataInfo)"
										extendstyle="1111">
										<node name="normal" extendstyle="1111">
											<image rect="7,17,80,120" src="$(iconSrc)" style="autosize"
												extendstyle="1111" />
										</node>
										<node name="sel" extendstyle="1111">
                                            <image rect="7,17,80,120" src="$(iconSrc1)" style="autosize"
                                                extendstyle="1111" />
                                        </node>
									</button>
									<!--
									<image name="title" rect="0,120,110,30" border="false"
										src="file://pics/main_icon_title_bg.png" style="autosize"
										extendstyle="1111">
										<label rect="0,0,120,30" text="$(titleName)" color="#ffffff"
											v-align="center" h-align="center" font-size="20" extendstyle="1111" />
									</image>
									-->
								</list-item>
								<dataset>
									<set iconSrc="file://pics/home/tongzhigonggao_d.png" iconSrc1="file://pics/home/tongzhigonggao_s.png" 
									   titleName="通知公告"	dataInfo="01" />
									<set iconSrc="file://pics/home/kaoqingjihua_d.png" iconSrc1="file://pics/home/kaoqingjihua_s.png"
										titleName="考勤管理" dataInfo="03" />
                                    <set iconSrc="file://pics/home/shezhi_d.png" iconSrc1="file://pics/home/shezhi_s.png"
                                        titleName="设置" dataInfo="22" />                                                               
								</dataset>
							</list>
						</node>				
			</node>
			<!-- 页面底部 -->
			<node name="bottom" rect="0,700,478,100" extendstyle="1111"
				visible="false">
				<!--<image name="bottom" rect="0,0,480,100" border="false"
					src="file://image/buju/bottombar.png" style="autosize" extendstyle="1111"/>
					<image name="xiala" rect="230,10,10,15" border="false"
						src="file://image/buju/arrowb.png" style="autosize" extendstyle="1111">
					</image>
					<node name="shouye" rect="0,18,100,80" extendstyle="1111">
						<image name="home" rect="10,30,30,30" border="false"
							src="file://image/buju/home.png" style="autosize" extendstyle="1111">
						</image>
						<label name="label6" rect="43,30,45,30" border="false"
							font-style="bold" font-size="20" text="首页" h-align="center"
							v-align="center" color="#ffffff" extendstyle="1111"></label>
					</node>
					<image name="line" rect="110,48,1,36" border="false"
						src="file://image/buju/line.png" style="autosize" extendstyle="1111">
					</image>
					<node name="houtui" rect="120,18,100,80" extendstyle="1111">
					   <button OnSelect="btnExit_OnSelect" name="btnback" rect="0,0,100,80"
					    extendstyle="1111" border="false" style="autosize">
	                        <image name="back" rect="10,30,30,30" border="false"
	                            src="file://image/buju/back.png" style="autosize" extendstyle="1111">
                        </image>
					   
						<label name="label6" rect="43,30,45,30" border="false"
							font-style="bold" font-size="20" text="退出" h-align="center"
							v-align="center" color="#ffffff" extendstyle="1111"></label>
					    </button>
					</node>
					<image name="line" rect="240,48,1,36" border="false"
						src="file://image/buju/line.png" style="autosize" extendstyle="1111">
					</image>
					<node name="shezhi" rect="250,18,100,80" extendstyle="1111">
						<image name="set" rect="10,30,30,30" border="false"
							src="file://image/buju/set.png" style="autosize" extendstyle="1111">
						</image>
						<label name="label6" rect="43,30,45,30" border="false"
							font-style="bold" font-size="20" text="设置" h-align="center"
							v-align="center" color="#ffffff" extendstyle="1111"></label>
					</node>
					<image name="line" rect="355,48,1,36" border="false"
						src="file://image/buju/line.png" style="autosize" extendstyle="1111">
					</image>
					<node name="shezhi" rect="360,18,100,80" extendstyle="1111">
						<image name="search" rect="10,30,30,30" border="false"
							src="file://image/buju/search.png" style="autosize" extendstyle="1111">
						</image>
				<label name="label6" rect="43,30,45,30" border="false"
							font-style="bold" font-size="20" text="搜索" h-align="center"
							v-align="center" color="#ffffff" extendstyle="1111"></label>
					</node>
				 <image name="bottom" rect="360,0,100,100" border="false"
                    src="file://image/buju/bottombar.png" style="autosize" extendstyle="1111"/>
				 <button name="shezhi" rect="360,18,100,80" OnSelect="shezhi_OnSelect" extendstyle="1111">
                        <image name="set" rect="10,30,30,30" border="false"
                            src="file://image/buju/set.png" style="autosize" extendstyle="1111">
                        </image>
                        <label name="label6" rect="43,30,45,30" border="false"
                            font-style="bold" font-size="20" text="退出" h-align="center"
                            v-align="center" color="#ffffff" extendstyle="1111"></label>
                </button> -->
			</node>
		</node>
	</body>
    <![CDATA[
    
    require 'com_ysga.common.framework'
    require('framework.appmanager')
    require 'framework.download'
    local rootSprite

    local  skinFalg='' --皮肤更新的标志
    local skinPath='' --皮肤更新的路径
    ---------------------------------------callbacks--------------------------------
    -- @brief root子节点创建完事件
    function bodyBuildChildrenFinished(sprite)
        rootSprite = sprite
        Log:write("the menu is ",t_S2T(Config:get('menu')))
		doLocation()
    end
    -- @brief root节点消息方法
    function bodyOnSpriteEvent(msg, param)
        if msg == MSG_ACTIVATE then -- 页面激活
            checkSkinPath()
            elseif msg == MSG_DEACTIVATE then
        end
    end
    -- @brief 插件消息方法
    function bodyOnPluginEvent(msg)
        if msg == 101 then
            elseif msg == 101 + MSG_CACHEDATA_RELOAD then -- 101请求的数据有更新
            elseif msg == MSG_NETWORK_ERROR then -- 拨号失败
            Log:write('拨号失败')
            elseif msg > MSG_NETWORK_ERROR then -- 请求超时
            Log:write('请求超时')
        end
    end
    -- @brief 按键响应处理
    function mainNodeOnKeyUp(sprite, kc)
        Log:write("the key is ..............")
        if kc == Key.F2 then -- 按下返回键
            if Loading:isShow() then
                Loading:close()
            else
                Dialog:show('提示', '是否确定退出？', 'ok_cancel', 'doExit')
            end
            return 1
            elseif kc==Key.F1 then
            	setAllShoworHide(Sprite:findChild(rootSprite,'bottom'),1)
                Timer:set(11, '5000', 'HideMenu') 
                return 1
        end
    end

     ------------------------换肤---------------
    function checkSkinPath()
    local  title=Sprite:findChild(rootSprite, 'title')
    local subtopbg=Sprite:findChild(rootSprite,'subtopbg')
    local tableValue=readDownloadTxtConfig()
      Log:write("开始鉴权皮肤是否更新1...")
        if tableValue~=nil or tableValue~='' then
            if tableValue[3]~=nil or tableValue[4]~=nil then
               skinFalg=tableValue[3]
               Log:write("开始鉴权皮肤是否更新skinFalg...",tableValue[3])
               skinPath=tableValue[4]
               Log:write("开始鉴权皮肤是否更新skinPath...",tableValue[4])
              end
        end
        if (skinFalg~='' and skinFalg=='1' and skinPath~='' and skinPath~=nil) then --如果皮肤已经更新
        Log:write("皮肤更新了"..skinPath..'/main_bg.png')
         Sprite:setProperty(title,'src',skinPath..'/main_bg.png')
         Sprite:setProperty(subtopbg,'src',skinPath..'/sub_top_bg_home.png')
       else
        Log:write("皮肤没有更新")
        Sprite:setProperty(title,'src','file://pics/main_bg.png')
        Sprite:setProperty(subtopbg,'src','file://pics/sub_top_bg_home.png')
        end


    end
    ---------------------------------------util functions---------------------------
   
    ---------------------------------------util functions---------------------------
    --隐藏菜单
    function HideMenu(menuShow)
        local menuNode = Sprite:findChild(rootSprite, 'bottom')
        Log:write('111111111111111111111111121212')
        --Dialog:show('', '是否确定退出？', 'ok_cancel', 'doExit')
        setAllShoworHide(menuNode,0)
        Timer:cancel(menuShow)
    end
    function listItemOnSelect(sprite)
        local dataInfo = Sprite:getData(sprite)
        Log:write('========',dataInfo)
        if dataInfo == '01' then
            --通知公告
            Scene:setReturn(Alias.home, Alias.news)
            Scene:go(Alias.news, true)
        elseif dataInfo == '02' then
            --信息反馈
            Scene:setReturn(Alias.home, Alias.xinxi)
            Scene:go(Alias.xinxi)
        elseif dataInfo == '03' then
             --考勤管理
            Scene:setReturn(Alias.home, Alias.kaoqinaction)
            Scene:go(Alias.kaoqinaction,true)
        elseif dataInfo == '04' then
            --巡店计划
            Scene:setReturn(Alias.home, Alias.wjb_xundianjihua)
            Scene:go(Alias.wjb_xundianjihua,true)
        elseif dataInfo == '05' then
            --巡店执行
            Scene:setReturn(Alias.home, Alias.wjb_xundianzhixing)
            Scene:go(Alias.wjb_xundianzhixing,true)    
        elseif dataInfo == '06' then           
            --巡店记录
            Scene:setReturn(Alias.home, Alias.wjb_xundianjilu)
            Scene:go(Alias.wjb_xundianjilu,true)
        elseif dataInfo == '07' then
            --我的门店
            Scene:setReturn(Alias.home, Alias.mendianlist)
            Scene:go(Alias.mendianlist,true)    
        elseif dataInfo == '17' then
            --订货管理
            Scene:setReturn(Alias.home, Alias.dinghuo)
            Scene:go(Alias.dinghuo,true) 
        elseif dataInfo == '18' then
            --到货管理
            Scene:setReturn(Alias.home, Alias.daohuo)
            Scene:go(Alias.daohuo,true)
        elseif dataInfo == '19' then
            --调货管理改成销售分析
            Scene:setReturn(Alias.home, Alias.wjb_myxiaoliang)
            Scene:go(Alias.wjb_myxiaoliang,true)
        elseif dataInfo == '20' then
            --销量上报改成日销量
            Scene:setReturn(Alias.home, Alias.wjb_rixiaoliang)
            Scene:go(Alias.wjb_rixiaoliang,true)       
        elseif dataInfo == '21' then
            --库存盘点
            Scene:setReturn(Alias.home, Alias.kucunpandian)
            Scene:go(Alias.kucunpandian,true)
        elseif dataInfo == '22' then
            --设置
           Scene:setReturn(Alias.home, "MODULE:\\com_ysga\\pqy_setup.wdml")
           Scene:go("MODULE:\\com_ysga\\pqy_setup.wdml",true)
        end
    end
    
    function shezhi_OnSelect(sprite)
        Dialog:show('', '是否确定退出？', 'ok_cancel', 'doExit')   
    end
    
    function btnExit_OnSelect(sprite)
        Log:write("exit clicked")
        Dialog:show('', '是否确定退出？', 'ok_cancel', 'doExit')        
    end
    
    function tuichu()
        Scene:go('MODULE:\\com_xsgj\\index.wdml',true)
    end
    
    function shezhi_OnSelect(sprite)
    end
    
    -- 当前无经纬度信息，检查当前gps状态
    function doLocation()
        System:setGPSStatus(1)
    end
 
]]>
</root>
