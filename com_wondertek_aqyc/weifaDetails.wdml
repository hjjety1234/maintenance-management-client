<?xml version="1.0" encoding="utf-8"?>
<!--
 == ============================================================================
 == | WonderTek [ 网络无处不在，沟通及时到达 ]
 == ============================================================================
 == | Copyright (c) 2012, WonderTek, Inc. All Rights Reserved.
 == ============================================================================
 == | Author: xxxx <xxxx@xxxx.com>
 == ============================================================================
 == | Desc: 页面描述
 == ============================================================================
-->
<root>
    <header/>
    <body resolution="480,800" BuildChildrenFinished="bodyBuildChildrenFinished" OnSpriteEvent="bodyOnSpriteEvent" OnPluginEvent="bodyOnPluginEvent">
        <node name="mainNode" rect="0,0,480,800" enable="true" active="true" OnKeyUp="mainNodeOnKeyUp" layouttype="1" extendstyle="1111">
            <shadow rect="0,0,480,800" color="#ffffff" alpha="255"
                extendstyle="1111" />
            <!-- 设置背景 -->
            <image rect="0,80,480,720" src="" style="autosize" extendstyle="1111" />
            <!-- 设置头部 -->
            <node name="baseSprite" rect="0,0,480,87" extendstyle="1111">
                <image name="title" rect="0,0,480,87" border="false" src="file://image/top-a.png" 
                    style="autosize" extendstyle="1111">
                    <label name="titleLabel" rect="0,0,480,80" text="违法详情" color="#ffffff" v-align="center"  
                       h-align="center" font-family="微软雅黑" font-size="30" extendstyle="1111" />
                </image>
                <!-- 返回 -->
                <button rect="20,18,84,51" OnSelect="doBack" normal="src:file://image/button-a.png;"
                    sel="src:file://image/button-b.png;" style="autosize" extendstyle="1111">
                </button>
            </node> 
            <node name="xuanze" rect="0,83,480,717" extendstyle="1111">
            ---------------------------------------选择区域----------------------------------------------------
            <node rect="0,0,480,80" extendstyle="1111" >
                <label name="quyu" rect="10,13,100,50" text="区      域"  v-align="center"  
                       h-align="center" font-family="微软雅黑" font-size="24" extendstyle="1111"  />
               <label name="quyuname" rect="100,13,300,50" text="安庆市" color="#6c6c6c"   v-align="center"  
                       h-align="center" font-family="微软雅黑" font-size="24" extendstyle="1111" />
                <!--间隔线-->
                <image name="jiange" rect="0,75,480,1" src="file://image/line.png"
                            style='autosize' extendstyle="1111"/>
            </node>
            <node rect="0,80,480,80"  extendstyle="1111" >
                <label name="wangdian" rect="10,13,110,50" text="月      份"  v-align="center"  
                       h-align="center" font-family="微软雅黑" font-size="24" extendstyle="1111" />
               
                <label name="wangdian1" rect="100,14,300,50" text="2013-5" color="#6c6c6c"  v-align="center"  
                       h-align="center" font-family="微软雅黑" font-size="24" extendstyle="1111" />
                <!--间隔线-->
                <image name="jiange" rect="0,75,480,1" src="file://image/line.png"
                            style='autosize' extendstyle="1111"/>
                </node>
            </node>
            <node rect="0,0,480,100"  extendstyle="1111">
            <image name="bg" rect="0,231,480,79" src="file://image/xinxibiao1.png"
                            style='autosize' extendstyle="1111"/>
                <textarea rect="0,250,65,50" font-size="20" font-family="微软雅黑"
                    text="客户简码" extendstyle="1111" v-align="center"  h-align="center"/>
                <textarea  rect="65,250,65,50" font-size="20"  font-family="微软雅黑"
                    text="店铺名称" extendstyle="1111" v-align="center"  h-align="center"/>
                <textarea  rect="130,250,90,50" font-size="20"  font-family="微软雅黑"
                    text="网点名称" extendstyle="1111" v-align="center"  h-align="center"/>
                <textarea  rect="220,250,90,50" font-size="20"  font-family="微软雅黑"
                    text="巡店时间" extendstyle="1111" v-align="center" h-align="center"/>
                <textarea  rect="310,250,90,50" font-size="20"  font-family="微软雅黑"
                    text="巡店人" extendstyle="1111"  v-align="center" h-align="center" />
                <textarea  name="caozuo" rect="400,250,90,50" font-size="20"  font-family="微软雅黑"
                    text="违法行为记录" extendstyle="1111" v-align="center" h-align="center"/>
            </node>
            <node rect="0,300,480,100" extendstyle="1111">
            <listview name="sampleList" rect="0,0,0,600" extendstyle="1177" col="1" auto-adjust="true" ></listview>
            </node>
            <node rect="0,80,480,100"  name="listitem" extendstyle="1111">
              <image name="bg" rect="0,231,480,79" src="file://image/xinxibiao3.png" style='autosize' extendstyle="1111"/>
                <textarea name="jianma" rect="0,250,65,50" font-size="20" font-family="微软雅黑"
                    text="" extendstyle="1111" v-align="center"  h-align="center"/>
                <textarea name="shop" rect="65,250,65,50" font-size="20"  font-family="微软雅黑"
                    text="店铺名称" extendstyle="1111" v-align="center"  h-align="center"/>
                <textarea name="netname" rect="130,250,90,50" font-size="20"  font-family="微软雅黑"
                    text="网点名称" extendstyle="1111" v-align="center"  h-align="center"/>
                <textarea  name="xundiantime" rect="220,250,90,50" font-size="20"  font-family="微软雅黑"
                    text="巡店时间" extendstyle="1111" v-align="center" h-align="center"/>
                <textarea name="xundianpepole" rect="310,250,90,50" font-size="20"  font-family="微软雅黑"
                    text="巡店人" extendstyle="1111"  v-align="center" h-align="center" />
                <textarea  name="weifajilu" rect="400,250,90,50" font-size="20"  font-family="微软雅黑"
                    text="违法行为记录" extendstyle="1111" v-align="center" h-align="center"/>
            </node>
        </node>
    </body>
    <![CDATA[

require 'com_wondertek_aqyc.common.framework'

require 'framework.umsagent'
require 'framework.upload'

local rootSprite
local quyuList 
local wangdianList 
local quyuname = nil
local wangdianname = nil
local observer
local latitude
local longitude
local g_retryCount=0
    --是否定位成功
local localsuc=0
local server = Config:get('serverUrl')..':'..Config:get('port')
local wangdianidList 

---------------------------------------callbacks--------------------------------
-- @brief root子节点创建完事件
function bodyBuildChildrenFinished(sprite)
    rootSprite = sprite
   
    request()
end

-- @brief root节点消息方法
function bodyOnSpriteEvent(msg, param)
    if msg == MSG_ACTIVATE then -- 页面激活
       
    elseif msg == MSG_DEACTIVATE then
    end
end

-- @brief 插件消息方法
function bodyOnPluginEvent(msg, param)
    if msg == 101  then 
        local weifaData = Http:jsonDecode('weifaData')
        Log:write("违法记录数据")
    elseif msg == 101 + MSG_CACHEDATA_RELOAD then -- 101请求的数据有更新
    elseif msg == MSG_NETWORK_ERROR then -- 拨号失败
        Log:write('拨号失败')
    elseif msg > MSG_NETWORK_ERROR then -- 请求超时
        Log:write('请求超时')
    end
end

-- @brief 按键响应处理
function mainNodeOnKeyUp(sprite, kc)
    if kc == Key.F2 then -- 按下返回键
        Scene:back(true)
    end
end

---------------------------------------util functions---------------------------
function doBack()
   Scene:go(Alias.leaderindex,true)
end
--进入区域列表
function chooseQuYu()
   Reg:setString(Reg:create("yemian1"), 'yemian1', "6")
   Scene:setReturn(Alias.weifatj, Alias.quyuList)
   Scene:go(Alias.quyuList,true)
end
function request()
     
     local param = '&startDate='..'2013-04'..'&area='..'宜城区'..'&employeeId='..Config:get('employeeId')
     local Url = server..'/mobileSale/report/detail.htm?page=1&rows=10'..param
     Log:write('the url is :',Url)
  
     Http:request('weifaData', Url, 101, {useCache=false})
end


    ]]>
</root>
