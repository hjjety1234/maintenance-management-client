<?xml version="1.0" encoding="utf-8"?>
    <!--
        ==
        ============================================================================
        == | WonderTek [ 网络无处不在，沟通及时到达 ] ==
        ============================================================================
        == | Copyright (c) 2012, WonderTek, Inc. All Rights Reserved. ==
        ============================================================================
        == | Author: xxxx <xxxx@xxxx.com> ==
        ============================================================================
        == | Desc: 页面描述 ==
        ============================================================================
    -->
<root>
    <header />
    <body resolution="480,800" BuildChildrenFinished="bodyBuildChildrenFinished"
        OnSpriteEvent="bodyOnSpriteEvent" OnPluginEvent="bodyOnPluginEvent">
        <node name="mainNode" rect="0,0,480,800" enable="true" active="true"
            OnKeyUp="mainNodeOnKeyUp" layouttype="1" extendstyle="1111">
            <image rect="0,0,480,800" border="false"
                src="file://png/main_background.png" style="autosize" extendstyle="1111" />

            <!--
                **********************************************标题***************************
            -->
            <node rect="0,0,480,100" name="titleNode" style="autosize"
                extendstyle="1111">
                <image rect="0,0,480,100" border="false" src="file://png/main_top_bg.png"
                    style="sudoku-auto" sudoku="0,20,0,20" extendstyle="1111" />
                <button rect="10,28,78,44" OnSelect="doBack" normal="normal"
                    sel="sel" style="autosize" extendstyle="1111">
                    <node name="normal" extendstyle="1111">
                        <image rect="0,0,78,44" src="file://png/icons_01.png" style="autosize"
                            extendstyle="1111" />
                    </node>
                    <node name="sel" extendstyle="1111">
                        <image rect="0,0,78,44" src="file://png/icons_01_f.png"
                            style="autosize" extendstyle="1111" />
                    </node>
                </button>
                <button name="subjectBtn" rect="160,0,160,100" OnSelect="selectSubject"
                    style="autosize" extendstyle="1111">
                    <label name="titleLable" rect="10,25,130,50" text="路由复测"
                        font-family="微软雅黑" font-size="30" h-align="center" v-align="center"
                        color="#ffffff" extendstyle="1111" />
                    <image rect="142,54,20,8" src="file://png/kq_icons_arrow_under.png"
                        style="autosize" extendstyle="1111" />
                    <label name="titlecode" type="hidden" />
                </button>
                <button name="add" visible="true" enable="true" rect="392,28,78,44"
                    OnSelect="doAdd" normal="normal" sel="sel" style="autosize"
                    extendstyle="1111">
                    <node name="normal" extendstyle="1111">
                        <image rect="0,0,78,44" src="file://png/icons_06.png" style="autosize"
                            extendstyle="1111" />
                    </node>
                    <node name="sel" extendstyle="1111">
                        <image rect="0,0,78,44" src="file://png/icons_06_f.png"
                            style="autosize" extendstyle="1111" />
                    </node>
                </button>
            </node>

            <!--
                **********************选择框*********8888888888888888*******************
            -->
            <button rect="0,100,240,60" style="autosize" extendstyle="1111"
                OnSelect="luruOnSelect">
                <image name="leftbarImg" rect="0,0,240,60" src="file://png/jccl_bt_bg01.png"
                    style="autosize" extendstyle="1111" />
                <label name="leftbarLabel" rect="0,0,240,60" text="录入"
                    font-family="微软雅黑" font-size="24" h-align="center" v-align="center"
                    color="#000000" style="autosize" extendstyle="1111" />
                <image name="lurujianImg" rect="112,50,16,8" src="file://png/kq_icons_arrow.png" visible="false" 
                    style="autosize" extendstyle="1111" />
            </button>
            <button rect="240,100,240,60" style="autosize" extendstyle="1111"
                OnSelect="chaxunOnSelect">
                <image name="rightbarImg" rect="0,0,240,60" src="file://png/jccl_bt_bg02.png"
                    style="autosize" extendstyle="1111" />
                <label name="rightbarLabel" rect="0,0,240,60" text="查询"
                    font-family="微软雅黑" font-size="24" h-align="center" v-align="center"
                    color="#ffffff" style="autosize" extendstyle="1111" />
                <image name="chaxunjianImg" rect="112,50,16,8" src="file://png/kq_icons_arrow.png" 
                    visible="false" style="autosize" extendstyle="1111" />
            </button>

            <!--
                *****************8888888888***********录入界面****************8888888888888888888**********
            -->

            <node name="luruNode" rect="0,0,480,640" visible="true"
                enable="true" style="autosize" extendstyle="1111">
                <!--****************************全局参数录入界面**************************-->
                <node rect="0,180,480,220" name="jinchangcailiaobodyNode"
                    visible="true" enable="true" style="autosize" extendstyle="1111">
                    <image rect="25,0,430,220" border="false" src="file://png/kq_bg.png"
                        style="sudoku-auto" sudoku="20,20,20,20" extendstyle="1111" />
                    <node rect="25,10,430,210" extendstyle="1111">
                        <label rect="5,10,80,50" text="起点" font-family="微软雅黑"
                            font-size="24" h-align="center" v-align="center" color="#0"
                            style="autosize" extendstyle="1111" />
                        <image rect="0,69,430,1" src="file://png/kq_line_c.png"
                            style="autosize" extendstyle="1111" />
                        <label rect="5,80,80,50" text="终点" font-family="微软雅黑"
                            font-size="24" h-align="center" v-align="center" color="#0"
                            style="autosize" extendstyle="1111" />
                        <image rect="0,139,430,1" src="file://png/kq_line_c.png"
                            style="autosize" extendstyle="1111" />
                        <label rect="15,150,110,50" text="实测距离" font-family="微软雅黑"
                            font-size="24" h-align="center" v-align="center" color="#0"
                            style="autosize" extendstyle="1111" />
                        <label rect="300,150,50,50" text="米" font-family="微软雅黑"
                            font-size="24" h-align="center" v-align="center" color="#0"
                            style="autosize" extendstyle="1111" />

                        <image rect="105,10,309,50" src="file://png/jccl_input.png"
                            style="sudoku-auto" sudoku="18,20,18,20" extendstyle="1111" />
                        <edit name="start_pointEdit" rect="115,20,280,40" text="请输入起点"
                            OnSetFocus="initEditText" OnLostFocus="lostEditText"  color="#c5c6c5"
                            font-family="微软雅黑" h-align="center" v-align="center" font-size="24"
                            style="autosize" max-size="20" v-center="center"
                            extendstyle="1111" />
                        <image rect="105,80,309,50" src="file://png/jccl_input.png"
                            style="sudoku-auto" sudoku="18,20,18,20" extendstyle="1111" />
                        <edit name="end_pointEdit" rect="115,90,280,40" text="请输入终点"
                            OnSetFocus="initEditText" OnLostFocus="lostEditText"  color="#c5c6c5"
                            font-family="微软雅黑" font-size="24" h-align="center" v-align="center"
                            style="autosize" max-size="20" v-center="center"
                            extendstyle="1111" />
                        <image rect="145,150,140,50" src="file://png/jccl_input.png"
                            style="sudoku-auto" sudoku="18,20,18,20" extendstyle="1111" />
                        <edit name="distanceEdit" rect="155,160,120,40" text="请输入数字" option="numeric"
                            OnSetFocus="initEditText" OnLostFocus="lostEditText" color="#c5c6c5"
                            font-family="微软雅黑" font-size="24" style="autosize" max-size="10"
                            v-center="center" extendstyle="1111" />
                    </node>
                </node>
                <!--*************************关键点录入界面******************-->
                <node rect="0,420,480,340" name="jinchangcailiaobodyNode"
                    visible="true" enable="true" style="autosize" extendstyle="1111">
                    <image rect="25,0,430,340" border="false" src="file://png/kq_bg.png"
                        style="sudoku-auto" sudoku="20,20,20,20" extendstyle="1111" />
                    <node rect="25,12,430,340" extendstyle="1111">
                        <button rect="15,7,118,56" OnSelect="ckbzBtnOnselect"
                            normal="normal" sel="sel" style="autosize" extendstyle="1111">
                            <node name="normal" extendstyle="1111">
                                <image rect="0,0,118,56" src="file://png/jccl_bottom_ckbz.png"
                                    style="autosize" extendstyle="1111" />
                            </node>
                            <node name="sel" extendstyle="1111">
                                <image rect="0,0,118,56" src="file://png/jccl_bottom_ckbz_a.png"
                                    style="autosize" extendstyle="1111" />
                            </node>
                        </button>
                        <button name="hegeBtn" rect="170,12,110,45" OnSelect="hegeselect"
                            style="autosize" data='' extendstyle="1111">
                            <label rect="0,0,60,45" text="合格" font-family="微软雅黑"
                                font-size="24" h-align="center" v-align="center" color="#0"
                                style="autosize" extendstyle="1111" />
                            <image name="hegeImg" rect="65,0,45,45" src="file://png/login_checkbox.png"
                                style="autosize" extendstyle="1111" />
                        </button>
                        <button name="buhegeBtn" rect="280,12,130,45" OnSelect="buhegeselect"
                            style="autosize" data='0' extendstyle="1111">
                            <image name="buhegeImg" rect="80,0,45,45"
                                src="file://png/login_checkbox.png" style="autosize"
                                extendstyle="1111" />
                            <label rect="0,0,80,45" text="不合格" font-family="微软雅黑"
                                font-size="24" h-align="center" v-align="center" color="#0"
                                style="autosize" extendstyle="1111" />
                        </button>
                        <image rect="0,76,430,1" src="file://png/kq_line_c.png"
                            style="autosize" extendstyle="1111" />
                        <label rect="15,92,60,50" text="备注" font-family="微软雅黑"
                            font-size="24" h-align="center" v-align="center" color="#0"
                            style="autosize" extendstyle="1111" />
                        <image rect="80,92,240,80" src="file://png/jccl_input.png"
                            style="sudoku-auto" sudoku="18,20,18,20" extendstyle="1111" />
                        <edit name='beizhuEdit' rect="90,100,220,72" text="请输入备注信息"
                            font-family="微软雅黑" font-size="24" style="autosize" OnLostFocus="lostEditText"
                            OnSetFocus="initEditText" max-size="40" v-center="top" color="#c5c6c5"
                            multiline="true" extendstyle="1111" />
                        <button rect="335,93,82,54" OnSelect="btnCamera_Click"
                            normal="normal" sel="sel" style="autosize" extendstyle="1111">
                            <node name="normal" extendstyle="1111">
                                <image rect="0,0,82,54" src="file://png/kq_icons_03.png"
                                    style="autosize" extendstyle="1111" />
                            </node>
                            <node name="sel" extendstyle="1111">
                                <image rect="0,0,82,54" src="file://png/kq_icons_03_f.png"
                                    style="autosize" extendstyle="1111" />
                            </node>
                        </button>
                        <node name="imageListItem" rect="0,180,430,130" extendstyle="1111"
                            type="fallow">
                            <shadow rect="0,0,430,130" alpha="150" color="#BEE3FF"
                                extendstyle="1111" />
                            <button name="pic1" rect="10,0,130,130" border="false"
                                enable="false" visible="false" normal="" color="#ffffff"
                                OnSelect="topic" extendstyle="1111" style="autosize">
                                <button rect="103,0,27,26" OnSelect="delPic"
                                    normal="src:file://png/pic_delete_d.png;" sel="src:file://png/pic_delete_s.png;"
                                    data="pic1" />
                            </button>
                            <button name="pic2" rect="150,0,130,130" border="false"
                                enable="false" visible="false" normal="" color="#ffffff"
                                OnSelect="topic" extendstyle="1111" style="autosize">
                                <button rect="103,0,27,26" OnSelect="delPic"
                                    normal="src:file://png/pic_delete_d.png;" sel="src:file://png/pic_delete_s.png;"
                                    data="pic2" />
                            </button>
                            <button name="pic3" rect="290,0,130,130" border="false"
                                enable="false" visible="false" normal="" color="#ffffff"
                                OnSelect="topic" extendstyle="1111" style="autosize">
                                <button rect="103,0,27,26" OnSelect="delPic"
                                    normal="src:file://png/pic_delete_d.png;" sel="src:file://png/pic_delete_s.png;"
                                    data="pic3" />
                            </button>
                        </node>
                    </node>
                </node>
                <!--**********************关键点录入结束*****************************-->
            </node>
            <button name='zhedangBtn' rect="0,160,480,640" OnSelect="" enable='false'/>
                <!--********************************查询页面*****************************-->
                <node name="chaxunNode" rect="0,160,480,640" visible="false"
                    enable="false" style="autosize" extendstyle="1111">
                    <node name="chaxunlistViewNode" rect="0,0,480,640"
                        extendstyle="1111" visible="true" enable="true">
                        <image name="chaxunlistbgImg" rect="0,0,480,640" border="false"
                            src="file://png/main_background.png" style="sudoku-auto" sudoku="20,20,20,20"
                            extendstyle="1111" />
                        <listview name="chaxunListView" rect="0,0,480,640" limit="true" 
                            extendstyle="1111" border="false" visible="true" />
                    </node>

                    <node name="chaxunlistitemNode" rect="0,0,480,80" border="false"
                        visible="false" enable="false" extendstyle="1111">
                        <button name="kemuitemBtn" rect="0,0,480,80" normal="node:normal" sel="node:select" OnSelect="chaxundetailSelected"
                             style="autosize" extendstyle="1111" data=''>
                             <node name="normal" extendstyle="1177" rect="0,0,480,80">
                                <image rect="0,0,480,78" extendstyle="1177" src="file://png/list_bg_w.png" 
                                    sudoku="15,15,15,15" style="autosize" />
                                <label name="dataLabel" rect="30,10,180,60" border="false"
                                    h-align="center" font-size="20" v-align="center" step="1" 
                                    text="taiyang" color="#000000" font-family="黑体"></label>  
                                <label name="approveLabel" rect="240,10,80,60" border="false"
                                    h-align="center"  font-size="20"  v-align="center"
                                    step="1" text="" color="#000000" font-family="黑体"></label>
                                <label name="submitLabel" rect="350,10,90,60" border="false"
                                    h-align="center"  font-size="20"  v-align="center"
                                    step="1" text=""  color="#000000" font-family="黑体"></label>
                                <image rect="0,78,480,2" src="file://png/tz_list.png"
                                    style="autosize" extendstyle="1111" />
                             </node>
                             <node name="select" extendstyle="1177" rect="0,0,480,80">
                                <image rect="0,0,480,78" extendstyle="1177" src="file://png/list_bg_b.png" 
                                    sudoku="15,15,15,15" style="autosize" />
                                <label name="dataLabel_s" rect="30,10,180,60" border="false"
                                    h-align="center" font-size="20" v-align="center" step="1" 
                                    text="" color="#ffffff" font-family="黑体"></label>  
                                <label name="approveLabel_s" rect="240,10,80,60" border="false"
                                    h-align="center"  font-size="20"  v-align="center"
                                    step="1" text="" color="#ffffff" font-family="黑体"></label>
                                <label name="submitLabel_s" rect="350,10,90,60" border="false"
                                    h-align="center"  font-size="20"  v-align="center"
                                    step="1" text=""  color="#ffffff" font-family="黑体"></label>

                                <image rect="0,78,480,2" src="file://png/tz_list.png"
                                    style="autosize" extendstyle="1111" />
                             </node>

                         </button>
                     </node>
                 </node>
                 <!--********************************查询结束****************************-->
                
                
                <!--****************************科目选择弹出框**************************-->
                <!--科目选择弹出框-->
                <node name="subjectlistShowNode" rect="0,0,480,800" visible="false"
                    enable="false" style="autosize" mushroom="false">
                    <button name="bthide" rect="0,0,480,800" OnSelect="hidesubjectlistNode">
                        <shadow rect="0,0,480,800" alpha="150" color="#0"
                            extendstyle="1111" />
                    </button>
                    <image rect="300,71,16,8" src="file://png/kq_icons_arrow.png"
                        style="autosize" extendstyle="1111" />
                    <node rect="52,79,376,40" extendstyle="1111" border="false">
                        <image rect="0,0,376,40" src="file://png/tan_top.png" style="autosize"
                            extendstyle="0010" />
                        <label rect="10,2,160,36" border="false" color="#FFFFFF"
                            style="autosize" text=" 请选择科目" h-align="left" v-align="center"
                            font-family="微软雅黑" font-size="24" />
                    </node>
                    <image name="kumulistbgImg" rect="52,119,376,225" src="file://png/tan_cen.png"
                        style="sudoku-auto" sudoku="20,20,20,20" extendstyle="1111" />
                    <listview name="subjectlistView" rect="52,119,376,225" limit="true"
                        auto-scroll="true" style="autosize" auto-adjust="true"
                        extendstyle="1111" />
                    <image rect="52,344,376,11" src="file://png/tan_bottom.png"
                        style="autosize" extendstyle="1111" />
                </node>
                <!-- 科目选择每个按钮 -->
                <node name="subjectItemNode" rect="0,0,376,75" visible="false"
                    enable="false" active="false" style="autosize">
                    <button name="kemuxuanzeitemBtn" rect="0,0,376,75" text=""
                        color="#000000" h-align="left" v-align="center" font-family="微软雅黑"
                        font-size="24" style="autosize" extendstyle="0010"
                        normal="src:file://png/tan_cen.png;" sel="src:file://png/tan_cenbg.png;"
                        OnSelect="kemuxuanzeitemBtnOnSelect" data="0"> 
                    <image rect="0,73,376,2" src="file://png/kq_line_c.png"
                        style="autosize" extendstyle="0010" />
					</button>
                </node>

                <!--
                    *************************************************参考标准弹出框**********************************************
                -->
                <!--参考标准-->
                <node name="cankaobiaozhunShowNode" rect="0,0,480,800" visible="false"
                    enable="false" style="autosize" mushroom="false">
                    <button name="bthide" rect="0,0,480,800" OnSelect="hidecankaobiaozhunSelected">
                        <shadow rect="0,0,480,800" alpha="150" color="#0"
                            extendstyle="1111" />
                    </button>
                    <node rect="52,250,376,40" extendstyle="1111" border="false">
                        <image rect="0,0,376,40" src="file://png/tan_top.png" style="autosize"
                            extendstyle="0010" />
                        <label rect="10,2,260,36" border="false" color="#FFFFFF"
                            style="autosize" text="请参考以下标准" h-align="left" v-align="center"
                            font-family="微软雅黑" font-size="24" />
                    </node>
                    <image rect="52,290,376,285" src="file://png/tan_cen.png"
                        style="sudoku-auto" sudoku="0,10,0,10" extendstyle="1111" />
                    <listview name="listViewcankaobiaozhun" rect="52,290,376,285"
                        auto-scroll="true" style="autosize" auto-adjust="true" limit="true"
                        extendstyle="1111" />
                    <image rect="52,575,376,11" src="file://png/tan_bottom.png"
                        style="autosize" extendstyle="1111" />
                </node>
                <node name="cankaobiaozhunlistitem" rect="0,0,376,805" visible="false"
                    enable="false" active="false">
                    <textarea name="cankaobiaozhuntext" rect="10,5,356,800"
                        autoextend="true" order="false" lign-height="50" text="cankaobiaozhun"
                        postfix="..." font-size="24" font-family="微软雅黑" extendstyle="1111"
                        h-align="left" v-align="center" color="#0" style="autosize" />
                    <!--
                        <scrolltext scroll="true" step="20" name="cankaobiaozhuntext"
                        rect="10,5,356,215" text="" color="#0" h-align="left"
                        v-align="center" font-family="微软雅黑" font-size="24"
                        style="autosize" extendstyle="0010"/>
                    -->
                </node>
                
            <!--
                *******************************************关键点选择弹出框*************************************************
            -->
            <!--科目选择弹出框-->
            <node name="keypointlistShowNode" rect="0,0,480,800" visible="false"
                enable="false" style="autosize" mushroom="false">
                <button name="bthide" rect="0,0,480,800" OnSelect="hidekeypointlistNode">
                    <shadow rect="0,0,480,800" alpha="150" color="#0"
                        extendstyle="1111" />
                </button>
                <image rect="300,171,16,8" src="file://png/kq_icons_arrow.png"
                    style="autosize" extendstyle="1111" />
                <node rect="52,179,376,40" extendstyle="1111" border="false">
                    <image rect="0,0,376,40" src="file://png/tan_top.png" style="autosize"
                        extendstyle="0010" />
                    <label rect="10,2,160,36" border="false" color="#FFFFFF"
                        style="autosize" text="请选择程式" h-align="left" v-align="center"
                        font-family="微软雅黑" font-size="24" />
                </node>
                <image name="keypointlistbgImg" rect="52,219,376,225" src="file://png/tan_cen.png"
                    style="sudoku-auto" sudoku="20,20,20,20" extendstyle="1111" />
                <listview name="keypointlistView" rect="52,219,376,225" limit="true"
                    auto-scroll="true" style="autosize" auto-adjust="true" extendstyle="1111" />
                 <image rect="52,424,376,11" src="file://png/tan_bottom.png"  style="autosize" extendstyle="1111"/>
            </node>
            <!-- 选择cs每个按钮 -->
            <node name="keypointItemNode" rect="0,0,376,75" visible="false"
                enable="false" active="false" style="autosize">
                <button name="keypointxuanzeitemBtn" rect="0,0,376,75" text=""
                    color="#000000" h-align="left" v-align="center" font-family="微软雅黑"
                    font-size="24" style="autosize" extendstyle="0010"
                    normal="src:file://png/tan_cen.png;" sel="src:file://png/tan_cenbg.png;"
                    OnSelect="keypointxuanzeitemBtnOnSelect" data="">       
                <image rect="0,73,376,2" src="file://png/kq_line_c.png" style="autosize"
                    extendstyle="0010" />
				 </button>
            </node>
            
            
                
        </node>
    </body>
    <![CDATA[

    require 'com_szjl.common.framework'
    require 'com_szjl.common.umsagent'
    local rootSprite
    
    local userId = Config:get('userLogin')
    local server_kemuList = Alias.urlServer..'select/pipelinesel?professionalId='     ---科目选择跳转
    local server_kemuSubmit = Alias.urlServer..'stuff/route?'       ----暂存和提交
    local server_ckbz = Alias.urlServer..'pipeline/refNokey?subjectId='    -----参考标准
    local server_chaxunlist = Alias.urlServer..'select/subsel?'           ----查询列表
    local server_chaxundetail = Alias.urlServer..'select/routeNsel?'           ----查询详情
    local server_keypointlist = Alias.urlServer..'select/keysel?'       ----关键点列表
    
    
    local taskId
    local kemuId
    local fieldId
    
    local longitude
    local latitude
    local locatdetail
    local imageAddr
    local imageExplain
    local user_name = Config:get('realName')
    local userCode = Config:get('userLogin')
    local chaxundetaildata1   ---查询录入详情
    
    local subjectlistData1   ----科目列表
    local storedata1         ----暂存和提交列表
    local ckbzdata1           ---参考标准
    local chaxunlistdata1     ---查询列表
    local keypointlistdata1
    
    local imgdata={}
    local imageListNode
    local imageList
    local cameraSprite
    
    local leftright
    
    local allimg=''
    local zort
    local server_upimg = Alias.urlServer..'upload/UGC_GetUploadUrl'
    ---------------------------------------callbacks--------------------------------
    -- @brief root子节点创建完事件
    function bodyBuildChildrenFinished(sprite)
        rootSprite = sprite
        --全局数据初始化
        imgdata={pic1='',pic2='',pic3=''}
        --数据来源
        local regHandle = Reg:create("kemuDataRoom")
        kemuId = Reg:getString(regHandle, "kemuCode")
        local kemuName = Reg:getString(regHandle, "kemuName")
        taskId = Reg:getString(regHandle, "taskNo")
        local projectId = Reg:getString(regHandle, "projectCode")
        fieldId = Reg:getString(regHandle, "fieldCode")
        local fieldName = Reg:getString(regHandle, "fieldName")
        --页面数据初始化
        latitude = Config:get('latitude')
        longitude = Config:get('longitude')
        locatdetail = Config:get('address')
        if locatdetail == nil then
            locatdetail = ''
        end
        imageAddr = ''
        imageExplain = ''
        leftright = true
        initPage1()
    end
    -- @brief root节点消息方法
    function bodyOnSpriteEvent(msg, param)
        if msg == MSG_ACTIVATE then -- 页面激活
             UmsAgent:OnActivate(string.match(Alias.gdgc_lyfc, 'MODULE:\\(.*)'), "路由复测")
            elseif msg == MSG_DEACTIVATE then
             UmsAgent:OnDeactivate()
        end
    end
    -- @brief 插件消息方法
    function bodyOnPluginEvent(msg)
        if msg == 101 then     --科目列表
            if Loading:isShow() then Loading:close() end
              UmsAgent:onLoadFinish()
            subjectlistData1 = Http:jsonDecode('subjectlistData0')
            Log:write('22222222222222222222222222',subjectlistData1)
            if (subjectlistData1 == nil or subjectlistData1["Total"] == nil or subjectlistData1["Total"] == 0 or
                subjectlistData1["Total"] == '') then
                Dialog:show("提示", "科目列表为空", "ok")
                return
            end
            local total = subjectlistData1["Total"]
            setAllShoworHide(Sprite:findChild(rootSprite, 'subjectlistShowNode'), 1)
            local list = Sprite:findChild(rootSprite, 'subjectlistView')
            ListView:removeAllItems(list)
            local subjectItemNode = Sprite:findChild(rootSprite, 'subjectItemNode')
            local kumulistbgImg = Sprite:findChild(rootSprite, 'kumulistbgImg')
            local hign = 225
            if total < 3 then
                hign = 75*total
            end
            Sprite:setRect(kumulistbgImg, 52, 119, 376, hign+1)
            -- 加载新的列表项
            Log:write('90909090======='..total)
            ListView:loadItem(list, subjectItemNode, total, 'loadkemuListItem')
            ListView:adjust(list)
        elseif msg == 102 then   ---暂存返回结果
            if Loading:isShow() then Loading:close() end
            storedata1 = Http:jsonDecode('storedata0')
            Log:write('22222222222222222222222222',storedata1)
            if (storedata1 == nil or storedata1["Total"] == nil or storedata1["Value"] == nil) then
                Dialog:show("提示", "暂存失败", "ok")
            end
            if storedata1["Value"] == "暂存成功" then
			    initPage1()
                Dialog:show("提示", "暂存成功", "ok")
            end
        elseif msg == 103 then    ---提交返回结果
            if Loading:isShow() then Loading:close() end
            storedata1 = Http:jsonDecode('storedata0')
            Log:write('22222222222222222222222222',storedata1)
            if (storedata1 == nil or storedata1["Total"] == nil or storedata1["Value"] == nil) then
                Dialog:show("提示", "提交失败", "ok")
            end
            if storedata1["Value"] == "提交成功" then
			    initPage1()
                Dialog:show("提示", "提交成功", "ok")
            end
        elseif msg == 104 then    ---参考标准返回结果
            if Loading:isShow() then Loading:close() end
            ckbzdata1 = Http:jsonDecode('ckbzdata0')
            Log:write('22222222222222222222222222',ckbzdata1)
            if (ckbzdata1 == nil or ckbzdata1["Value"] == nil or ckbzdata1["Value"][1] == '' or ckbzdata1["Value"] == '查询无结果') then
                Dialog:show("提示", "无参考标准信息", "ok")
                return
            end
            local list = Sprite:findChild(rootSprite, 'listViewcankaobiaozhun')
            ListView:removeAllItems(list, true)
            local cankaobiaozhuntext = Sprite:findChild(rootSprite, 'cankaobiaozhuntext')
            local value = ckbzdata1['Value'][0]
            ListView:loadItem(list, Sprite:findChild(rootSprite, 'cankaobiaozhunlistitem'), 1, 'cankaoloadListItem')
            ListView:adjust(list)
            setAllShoworHide(Sprite:findChild(rootSprite, 'cankaobiaozhunShowNode'), 1)
        
        elseif msg == 106 then    ---关键点列表
            if Loading:isShow() then Loading:close() end
            keypointlistdata1 = Http:jsonDecode('keypointlistdata0')
            Log:write('22222222222222222222222222',keypointlistdata1)
            if (keypointlistdata1 == nil or keypointlistdata1["Value"] == nil or keypointlistdata1["Value"] == '' or keypointlistdata1["Total"] == 0 or keypointlistdata1["Total"] == '0') then
                Dialog:show("提示", "关键点列表为空", "ok")
                return
            end
            local list = Sprite:findChild(rootSprite, 'keypointlistView')
            ListView:removeAllItems(list, true)
            local total = keypointlistdata1["Total"]           
            local keypointlistbgImg = Sprite:findChild(rootSprite, 'keypointlistbgImg')
            local hign = 225
            if total < 3 then
                hign = 75*total
            end
            Sprite:setRect(keypointlistbgImg, 52, 219, 376, hign+1)
            Sprite:setRect(list, 52, 219, 376, hign+1)
            ListView:loadItem(list, Sprite:findChild(rootSprite, 'keypointItemNode'), total, 'keypointloadListItem')
            ListView:adjust(list)
            setAllShoworHide(Sprite:findChild(rootSprite, 'keypointlistShowNode'), 1) 
                 
        elseif msg == 110 then    ---查询列表返回结果
            if Loading:isShow() then Loading:close() end
            chaxunlistdata1 = Http:jsonDecode('chaxunlistdata0')
            Log:write('22222222222222222222222222',chaxunlistdata1)
            if (chaxunlistdata1 == nil or chaxunlistdata1["Total"] == nil or chaxunlistdata1["Total"] == 0) then
                Dialog:show("提示", "没有查到本科目的信息", "ok")
                return
            end
            --Log:write('-------------'..chaxunlistdata1["Value"]["supervision_result"])
            local total = chaxunlistdata1["Total"]
            local list = Sprite:findChild(rootSprite, 'chaxunListView')
            ListView:removeAllItems(list, true)
            --local cankaobiaozhuntext = Sprite:findChild(rootSprite, 'cankaobiaozhuntext')
            --local value = ckbzdata1['Value'][0]
            Log:write('ooooooooooooo'..total)
            ListView:loadItem(list, Sprite:findChild(rootSprite, 'chaxunlistitemNode'), total, 'chaxunloadListItem')
            --ListView:adjust(list)
        elseif msg == 111 then    ---查询详情返回结果
            if Loading:isShow() then Loading:close() end
            chaxundetaildata1 = Http:jsonDecode('chaxundetaildata0')
            Log:write('22222222222222222222222222',chaxundetaildata1)
            if (chaxundetaildata1 == nil or chaxundetaildata1["Value"] == nil or chaxunlistdata1["Total"] == nil or chaxunlistdata1["Total"] == 0) then
                Dialog:show("提示", "没有查到录入详情", "ok")
                return
            end
            initPage3()
            
        elseif msg>=201 and msg<=205 then    ---查询详情返回结果
            local ii=(msg-201);
            
            Log:write('=======201==0')
            local upimg_data1 = Http:xmlDecode('upimg_data0'..ii, 'RESULT')
            local url = upimg_data1.URL
            local param = upimg_data1.PARAM
            if param then
                param = param .. '&'
            else
                param = ''
            end

            local tmpSplitImage = Split(param,'&')
            if string.len(allimg)>0 then
                  allimg=allimg..','..string.sub(tmpSplitImage[1],15,-1) 
            else
                  allimg=string.sub(tmpSplitImage[1],15,-1) 
            end
            Log:write('=======201==0=='..allimg)
            local fname = string.sub(imgdata['pic'..ii],lastIndexof( imgdata['pic'..ii],'/')+1,string.len(imgdata['pic'..ii])-4)          
            local poststr ='id=111&markid=&interfaceMainType=2&usercode='..userCode..'&uploadFileName='.. fname..'.jpg'
            local result = Upload:append(url, param..poststr,imgdata['pic'..ii], fname .. '.jpg', 'test', 'jpg')
            imgdata['pic'..ii]=''
            Log:write('=======201==1==')
            if Loading:isShow() then Loading:close() end
            storesubmit()
            
        elseif msg > MSG_NETWORK_ERROR then -- 请求超时
            Log:write('请求超时')
        end
    end
    -- @brief 按键响应处理
    function mainNodeOnKeyUp(sprite, kc)
        if kc == Key.F2 then -- 按下返回键
            Scene:back(true)
            return 1
        end
    end
    ---------------------------------------util functions---------------------------
    function myfunc()
    end
--------页面返回功能    ------------
    function doBack()
        Scene:back(true)
    end
    
-------------录入查询切换功能区-------开始----
    function luruOnSelect()
        leftright = true
        initPage1()
    end
    function chaxunOnSelect()
        leftright = false
        initPage2()
    end
    function initPage1()
        local zhedangBtn = Sprite:findChild(rootSprite,'zhedangBtn')
        Sprite:setProperty(zhedangBtn, 'enable', 'false')
        local leftbarImg = Sprite:findChild(rootSprite, 'leftbarImg')
        local rightbarImg = Sprite:findChild(rootSprite, 'rightbarImg')
        Sprite:setProperty(leftbarImg, 'src', 'file://png/jccl_bt_bg01.png')
        Sprite:setProperty(rightbarImg, 'src', 'file://png/jccl_bt_bg02.png')
        local leftbarLabel = Sprite:findChild(rootSprite, 'leftbarLabel')
        local rightbarLabel = Sprite:findChild(rootSprite, 'rightbarLabel')
        Sprite:setProperty(leftbarLabel, 'color', '#000000')
        Sprite:setProperty(rightbarLabel, 'color', '#ffffff')
        
        local luruNode = Sprite:findChild(rootSprite, 'luruNode')
        Sprite:setProperty(luruNode, 'enable', 'true')
        Sprite:setProperty(luruNode, 'visible', 'true')
        local chaxunNode = Sprite:findChild(rootSprite, 'chaxunNode')
        Sprite:setProperty(chaxunNode, 'enable', 'false')
        Sprite:setProperty(chaxunNode, 'visible', 'false')
        
        local lurujianImg = Sprite:findChild(rootSprite, 'lurujianImg')
        Sprite:setProperty(lurujianImg, 'visible', 'true')
        local chaxunjianImg = Sprite:findChild(rootSprite, 'chaxunjianImg')
        Sprite:setProperty(chaxunjianImg, 'visible', 'false')
        
        local addBtn = Sprite:findChild(rootSprite, 'add')
        Sprite:setProperty(addBtn, 'enable', 'true')
        Sprite:setProperty(addBtn, 'visible', 'true')
        
        local buhegeImg = Sprite:findChild(rootSprite,'buhegeImg')
        local hegeImg = Sprite:findChild(rootSprite,'hegeImg')
        Sprite:setProperty(buhegeImg, 'src', 'file://png/login_checkbox.png')
        Sprite:setProperty(hegeImg, 'src', 'file://png/login_checkbox.png')
        
        local hegeBtn = Sprite:findChild(rootSprite,'hegeBtn')
        local buhegeBtn = Sprite:findChild(rootSprite,'buhegeBtn')
        Sprite:setProperty(hegeBtn,'data', '')
        Sprite:setProperty(buhegeBtn,'data', '0')
        
        allimg = ''
        local pic
        for key, value in pairs(imgdata) do
            pic = Sprite:findChild(rootSprite, key)
            Sprite:setProperty(pic, "normal", '')
            Sprite:setProperty(pic, 'visible', 'false')
            Sprite:setProperty(pic, 'enable', 'false')
        end
        imgdata={pic1='',pic2='',pic3=''}

        local nms = {"start_pointEdit","end_pointEdit","distanceEdit","beizhuEdit"}
        local msg = {"请输入起点","请输入终点","请输入数字",'请输入备注信息'}
        for i=1,#nms do
            local spt = Sprite:findChild(rootSprite, nms[i])
            Sprite:setProperty(spt, 'text', msg[i])
            Sprite:setProperty(spt, 'color', "#c5c6c5")
        end
    end
    
    function initPage2()
        local zhedangBtn = Sprite:findChild(rootSprite,'zhedangBtn')
        Sprite:setProperty(zhedangBtn, 'enable', 'false')
        local leftbarImg = Sprite:findChild(rootSprite, 'leftbarImg')
        local rightbarImg = Sprite:findChild(rootSprite, 'rightbarImg')
        Sprite:setProperty(leftbarImg, 'src', 'file://png/jccl_bt_bg02.png')
        Sprite:setProperty(rightbarImg, 'src', 'file://png/jccl_bt_bg01.png')
        local leftbarLabel = Sprite:findChild(rootSprite, 'leftbarLabel')
        local rightbarLabel = Sprite:findChild(rootSprite, 'rightbarLabel')
        
        local chaxunNode = Sprite:findChild(rootSprite, 'chaxunNode')
        Sprite:setProperty(chaxunNode, 'enable', 'true')
        Sprite:setProperty(chaxunNode, 'visible', 'true')
        local luruNode = Sprite:findChild(rootSprite, 'luruNode')
        Sprite:setProperty(luruNode, 'enable', 'false')
        Sprite:setProperty(luruNode, 'visible', 'false')
        
        local lurujianImg = Sprite:findChild(rootSprite, 'lurujianImg')
        Sprite:setProperty(lurujianImg, 'visible', 'false')
        local chaxunjianImg = Sprite:findChild(rootSprite, 'chaxunjianImg')
        Sprite:setProperty(chaxunjianImg, 'visible', 'true')
        
        local addBtn = Sprite:findChild(rootSprite, 'add')
        Sprite:setProperty(addBtn, 'enable', 'false')
        Sprite:setProperty(addBtn, 'visible', 'false')
        
        Sprite:setProperty(leftbarLabel, 'color', '#ffffff')
        Sprite:setProperty(rightbarLabel, 'color', '#000000')
        local server_chaxunlist1 = server_chaxunlist..'subjectId='..kemuId..'&taskId='..taskId
        Log:write('111111111111111:', server_chaxunlist1)
        Http:request('chaxunlistdata0', server_chaxunlist1, 110, {useCache=false})
        Loading:show(rootSprite)
    end
    -------------录入查询切换功能区-------结束----
    
    -------------科目选择和跳转功能区-------开始----
    function selectSubject()
        UmsAgent:onLoadStart()
        local server_kemuList1 = server_kemuList..fieldId
        --param2 = "professionalcode=001"
        Http:request("subjectlistData0", server_kemuList1, 101, {useCache = false})
    end
    
    function hidesubjectlistNode()
        setAllShoworHide(Sprite:findChild(rootSprite, 'subjectlistShowNode'), 0)
    end
    
    function loadkemuListItem(list, item, index)
        Sprite:setRect(item, 0, 0, 480, 75)
        Sprite:setProperty(item, 'extendstyle', '1111')
        local kemuxuanzeitemBtn = Sprite:findChild(item, 'kemuxuanzeitemBtn')
        local Valuedata = subjectlistData1["Value"][index]
        Sprite:setProperty(kemuxuanzeitemBtn, 'text', '        '..Valuedata['subject_name'])
        Sprite:setProperty(kemuxuanzeitemBtn, 'data', Valuedata['subject_id'])
    end
    function kemuxuanzeitemBtnOnSelect(sprite)
        txt=Sprite:getText(sprite)
        local regHandle = Reg:create("kemuDataRoom")
        --kemuId = Reg:getString(regHandle, "kemuCode")
        Log:write('--------------kaiwa====='..txt)
        setAllShoworHide(Sprite:findChild(rootSprite, 'subjectlistShowNode'), 0)
        if txt == "        进场材料" then
            Reg:setString(regHandle, 'kemuCode', '001')
            Scene:setReturn(Alias.xgq_kemulist, Alias.gdgc_jccl)
            Scene:go(Alias.gdgc_jccl,true)
            elseif txt == "        开挖沟槽" then
            Reg:setString(regHandle, 'kemuCode', '013')
            Scene:setReturn(Alias.xgq_kemulist, Alias.gdgc_kwgc)
            Scene:go(Alias.gdgc_kwgc,true)
            elseif txt == "        管道铺设" then
            Reg:setString(regHandle, 'kemuCode', '014')
            Scene:setReturn(Alias.xgq_kemulist, Alias.gdgc_gdps)
            Scene:go(Alias.gdgc_gdps,true)
            elseif txt == "        管道验收" then
            Reg:setString(regHandle, 'kemuCode', '016')
            Scene:setReturn(Alias.xgq_kemulist, Alias.gdgc_gdys)
            Scene:go(Alias.gdgc_gdys,true)
            elseif txt == "        人手孔" then
            Reg:setString(regHandle, 'kemuCode', '015')
            Scene:setReturn(Alias.xgq_kemulist, Alias.gdgc_rsk)
            Scene:go(Alias.gdgc_rsk,true)
            elseif txt == "        路由复测" then
            Reg:setString(regHandle, 'kemuCode', '002')
            Scene:setReturn(Alias.xgq_kemulist, Alias.gdgc_lyfc)
            Scene:go(Alias.gdgc_lyfc,true)
        end
    end
    -------------科目选择和跳转功能区-------结束----
    
    -------------程式选择功能区-------开始----
    -------------程式选择功能区-------结束----
    
    -------------关键点选择功能区-------开始----
    function keypointBtnOnselect()
        local server_keypointlist1 = server_keypointlist..'subjectId=045'
        Http:request("keypointlistdata0", server_keypointlist1, 106)
    end
    
    function hidekeypointlistNode()
        setAllShoworHide(Sprite:findChild(rootSprite, 'keypointlistShowNode'), 0)
    end
    
    function keypointloadListItem(list, item, index)
        Log:write('--------------listitem'..index)
        Sprite:setRect(item, 0, 0, 376, 75)
        Sprite:setProperty(item, 'extendstyle', '1111')
        local Valuedata = keypointlistdata1["Value"][index]

        local keypointxuanzeitemBtn = Sprite:findChild(item, 'keypointxuanzeitemBtn')
        Log:write('--------------listitem==')
        Sprite:setProperty(keypointxuanzeitemBtn, 'data', Valuedata['key_point_id'])
        Sprite:setProperty(keypointxuanzeitemBtn, 'text', '     '..Valuedata['key_point_name'])
    end
    
    function keypointxuanzeitemBtnOnSelect(sprite)
        local keypointselectNode = Sprite:findChild(rootSprite, 'keypointBtn')  
        local keypointLabel = Sprite:findChild(rootSprite, 'keypointLabel')
        local txt = Sprite:getProperty(sprite, 'text')
        local data = Sprite:getProperty(sprite, 'data')
        Sprite:setProperty(keypointselectNode, 'data', data)
        Sprite:setProperty(keypointLabel, 'text', txt)
        Sprite:setProperty(keypointLabel, 'color', '#0')  
        setAllShoworHide(Sprite:findChild(rootSprite, 'keypointlistShowNode'), 0)
    end
    
    -------------关键点选择功能区-------结束----
    
    -------------参考标准选择功能区-------开始----
    function ckbzBtnOnselect()
        local server_ckbz2 = server_ckbz..kemuId
        Http:request("ckbzdata0", server_ckbz2, 104)
        --Http:request("fusheguanglancankao", url, 122,{useCache = false, method = 'post', postData=param2})
    end
    function cankaoloadListItem(list, item, index)
        Sprite:setRect(item, 0,0,376,805)
        Sprite:setProperty(item, 'extendstyle', '0010')
        local cankaobiaozhuntext = Sprite:findChild(item, 'cankaobiaozhuntext')
        if (ckbzdata1 ~= nil) then
            local value = ckbzdata1['Value'][0]
            if value.check_standard~=nil then
                 local noticeContent = value.check_standard
                  noticeContent = string.gsub(noticeContent, '&%w+;', '')
                  noticeContent = string.gsub(noticeContent, '&nbsp;', '')
                  noticeContent = string.gsub(noticeContent, '<br>','\r\\n' .. '     ')
                  noticeContent = string.gsub(noticeContent, '<br/>','\r\n' .. '     ')
                  noticeContent = string.gsub(noticeContent, '<br />','\r\n' .. '     ')
                  noticeContent = string.gsub(noticeContent, '<p>','\r\n' .. '     ')
                  noticeContent = string.gsub(noticeContent, '</p>','\\n' .. '')
                  noticeContent = string.gsub(noticeContent, '<.->','')				      
			      noticeContent = string.gsub(noticeContent, '\r\n\r\n\t', '\r\n')
                  noticeContent = string.gsub(noticeContent, '$\r\n\t', ' ')
                  Sprite:setProperty(cankaobiaozhuntext, "text", noticeContent)
                  local newscontX, newscontY, newscontW, newscontH = Sprite:getRect(cankaobiaozhuntext)
                  Sprite:setRect(cankaobiaozhuntext, newscontX, 0, newscontW, newscontH)
                  resetListViewItemHeight()  
            end
        end
    end
    function hidecankaobiaozhunSelected()
        setAllShoworHide(Sprite:findChild(rootSprite, 'cankaobiaozhunShowNode'), 0)
    end
    
    -------------参考标准选择功能区-------结束----
    
    -------------合格不合格与参数初始化设置功能区-------开始----
    
    function hegeselect(sprite)
        Sprite:setProperty(sprite,'data', '0')
        local hegeImg = Sprite:findChild(rootSprite,'hegeImg')
        local buhegeImg = Sprite:findChild(rootSprite,'buhegeImg')
        Sprite:setProperty(hegeImg, 'src', 'file://png/login_check.png')
        Sprite:setProperty(buhegeImg, 'src', 'file://png/login_checkbox.png')
       
    end
    function buhegeselect(sprite)
        local hegeBtn = Sprite:findChild(rootSprite,"hegeBtn")
        Sprite:setProperty(hegeBtn,'data', '1')
        local hegeImg = Sprite:findChild(rootSprite,'hegeImg')
        local buhegeImg = Sprite:findChild(rootSprite,'buhegeImg')
        Sprite:setProperty(hegeImg, 'src', 'file://png/login_checkbox.png')
        Sprite:setProperty(buhegeImg, 'src', 'file://png/login_check.png')
    end
        
    function initEditText(sprite)
        Log:write('gavin42:')        
        nms = {"start_pointEdit","end_pointEdit","distanceEdit","beizhuEdit"}
        local spriteName = Sprite:getName(sprite)
        msg = {"请输入起点","请输入终点","请输入数字",'请输入备注信息'}
        local txt= Sprite:getProperty(sprite, 'text')
        for i=1,#msg do
            if txt == msg[i] then
                Sprite:setProperty(sprite, 'text', '')
                Sprite:setProperty(sprite, 'color', '#0')
            end
        end
    end
    
    function lostEditText(sprite)
        Log:write('gavin45:')
        nms = {"start_pointEdit","end_pointEdit","distanceEdit","beizhuEdit"}
        local spriteName = Sprite:getName(sprite)
        msg = {"请输入起点", "请输入终点", "请输入数字", '请输入备注信息'}
        local txt= Sprite:getProperty(sprite, 'text')
        for i=1,#nms do
            if spriteName == nms[i] and txt == ''  then
                Log:write('===='..txt)
                Sprite:setProperty(sprite, 'color', "#c5c6c5")
                Sprite:setProperty(sprite, 'text', msg[i])
            end
        end
    end
    -------------合格不合格与参数初始化设置功能区-------结束----
    
    -------------照相功能区-------开始----
    function btnCamera_Click(sprite)
        cameraSprite = Sprite:getParent(Sprite:getParent(sprite))
        local fileName = os.time()
        --Log:write('------'..getCurDate())
        --onCameraDialog('file://png/main_topbar_bg.jpg', 'jpg')
        local result = System:openCamera('onCameraDialog', 'file://image/' .. fileName .. '.jpg', 'jpg')
        if result == 0 then
            Dialog:show('提示', '相机打开失败!')
            return 1
        end
    end
    ---获取照片
    function onCameraDialog(photoPath, photoType)
        local tmpSplitArray = Split(photoPath,'%.')
        local dest = tmpSplitArray[1] .. 'temp' .. System:getTickTime() .. '.jpg'
        Log:write('目标文件路径为:'..dest)
        local ret = ScaleImageAsJpg(photoPath, dest, 480, 800, 0)
        local r=nil;
        if ret == 1 then
            r= dest
            Log:write('图片压缩成功，压缩后的图片位置为:'..dest)
            else
            r=photoPath
            Log:write('警告：图片压缩失败，使用未压缩的图片:'..photoPath)
        end
        for key, value in pairs(imgdata) do
            if value==nil or value=='' then
                imgdata[key]=r
                break
            end
        end
        --显示图片列表
        reloadImages();
    end
    --重新显示图片列表
    function reloadImages()
        Log:write('gavin3:')
        cameraSprite = Sprite:findChild(rootSprite, 'imageListItem')
        Log:write('gavin33:')
        local j=10;
        for key, value in pairs(imgdata) do
            if value~=nil and value~='' then
                local p=Sprite:findChild(cameraSprite, key)
                Log:write('gavin2:'..key..'==='..value)
                Sprite:setRect(p, j, 0, 130, 130)
                Sprite:setProperty(p, "normal", 'src:'..value)
                Sprite:setProperty(p, "data", value)
                Sprite:setVisible(p,1)
                Sprite:setEnable(p,1)
                j=j+140;
                if j>400 then
                    break;
                end
            end
        end
    end
    --显示原图
    function topic(sprite)
        --创建数据仓库
        local igsrc=Sprite:getData(sprite)
        local reg=Reg:create("PicReg")
        Reg:setString(reg, 'type', 'guandao')
        Reg:setString(reg, "pic", igsrc)
        Scene:setReturn(Alias.gdgc_kwgc, Alias.wjb_orignImg)
        Scene:go(Alias.wjb_orignImg,true)
    end
    --删除图片
    function delPic(sprite)
        Log:write('gavin4:')
        cameraSprite = Sprite:findChild(rootSprite, 'imageListItem')
        local key=Sprite:getData(sprite);
        imgdata[key]='';
        local p=Sprite:findChild(cameraSprite, key);
        Sprite:setVisible(p,0)
        Sprite:setEnable(p,0)
        reloadImages()
    end
    --查找最后一个字符串
    function lastIndexof(s,tag)
        local index=-1
        Log:write(tag)
        while true do
            local i = string.find(s,tag,index+1)
            if i == nil then
                return index
            end
            index = i
        end
    end
    function isok()
        --图片都已添加到队列
        for key, value in pairs(imgdata) do
            if value~=nil or value~='' then
                return
            end
        end
        subform()
    end
    
    -------------照相功能区-------结束----
    
    -------------暂存和提交功能区-------开始----

    function doAdd()
        Log:write('zhendema')
        nms1 = {"start_pointEdit","end_pointEdit","distanceEdit"}
        msg1 = {"请输入起点", "请输入终点", "请输入数字"}
        msg12 = {"请输入起点", "请输入终点", "请输入距离"}
        for i=1,#nms1 do
            spt=Sprite:findChild(rootSprite, nms1[i])
            txt=Sprite:getText(spt)
            if txt==nil or txt=='' or txt==msg1[i] then
                Dialog:show("提示", msg12[i], "ok")
                Sprite:setFocus(spt)
                return
            end
        end
        
        --验证数字
        nms2 = {"distanceEdit"}
        msg2={"距离必须为数字"}
        for i=1,#nms2 do
            txt=Sprite:getText(Sprite:findChild(rootSprite, nms2[i]))
            if txt~=nil and txt ~='' and tonumber(txt)==nil then
                Dialog:show("提示", msg2[i], "ok")
                return
            end
        end
        
        local hegeBtn = Sprite:findChild(rootSprite,'hegeBtn')
        local hege = Sprite:getData(hegeBtn)
        if hege == '' then
            Dialog:show("提示", '请明确评审结果', "ok")
            return
        end
        
        local beizhuEdit = Sprite:findChild(rootSprite,'beizhuEdit')
        local beizhu = Sprite:getText(beizhuEdit)
        if beizhu == '请输入备注信息' or beizhu == '' then
            Dialog:show("提示", '请填写备注信息', "ok")
            return
        end
        
        Dialog:show('提示','请选择暂存还是提交!','zancun_tijiao','doStore2','doSubmit2')
    end
    
    function doStore2()
        Log:write('=======doStore2==0')
        zort = 1
        Loading:show(rootSprite)     
        local i=1;
        for key, value in pairs(imgdata) do
            if value~=nil and value~='' then
                Log:write('=======doStore2==1')
                n=tonumber(string.sub(key,4,-1)) 
                Log:write('=======doStore2==1'..n)
                local fname=string.sub(value,lastIndexof( value,'/')+1,string.len(value)-4)               
                local param2 = 'FILE_NAME='..fname..'&C_TYPE=jpg&C_LEN=' .. IO:fileSize(value)
                Http:request('upimg_data0'..n, server_upimg, 201+n, {useCache = false, method = 'post', postData= param2})  
                i=i+1
            end
            Log:write('=======doStore2==2')
        end
        Log:write('=======doStore2==2=='..i)
        if i==1 then 
            zort = 0
            doStore()
        end   
    end
    
    function doSubmit2()
        Log:write('=======doSubmit2==0')
        zort = 2
        Loading:show(rootSprite)     
        local i=1;
        for key, value in pairs(imgdata) do
            if value~=nil and value~='' then
                Log:write('=======doStore2==1')
                n=tonumber(string.sub(key,4,-1)) 
                Log:write('=======doStore2==1'..n)
                local fname=string.sub(value,lastIndexof( value,'/')+1,string.len(value)-4)               
                local param2 = 'FILE_NAME='..fname..'&C_TYPE=jpg&C_LEN=' .. IO:fileSize(value)
                Http:request('upimg_data0'..n, server_upimg, 201+n, {useCache = false, method = 'post', postData= param2})  
                i=i+1
            end
            Log:write('=======doStore2==2')
        end
        Log:write('=======doStore2==2=='..i)
        if i==1 then 
            zort = 0
            doSubmit()
        end   
    end
    
    function storesubmit()
        --图片都已添加到队列
        for key, value in pairs(imgdata) do
           if value~='' then
              return
           end
        end
        if zort == 1 then
           zort = 0
           doStore()
        elseif zort == 2 then
           zort = 0
           doSubmit()
        end
    end
    
    function doStore()

        
        local param
        local param1 = 'user_id='..userId..'&taskId='..taskId..'&subjectId='..kemuId..'&state=0'
        local param2 = ''
        local quanju1 = {"start_pointEdit","end_pointEdit","distanceEdit"}
        local quanju2={"startpoint","endpoint","distance"}
        for i=1,#quanju1 do
            spt=Sprite:findChild(rootSprite, quanju1[i])
            txt=Sprite:getText(spt)
            param2 = param2..'&'..quanju2[i]..'='..txt
        end
        Log:write('zhendema2')
        local hegeBtn = Sprite:findChild(rootSprite,'hegeBtn')
        local hege = Sprite:getData(hegeBtn)
        local beizhuEdit = Sprite:findChild(rootSprite,'beizhuEdit')
        local beizhu = Sprite:getText(beizhuEdit)
        if beizhu == '请输入备注信息' then
            beizhu = ''
        end
        Log:write('zhendema3')
        local param3 = '&supervisionresult='..hege..'&remark='..beizhu
        param = param1..param2..param3..'&imageAddr='..allimg..'&imageExplain='..'&longitude='..longitude..'&latitude='..latitude..'&locatdetail='..locatdetail
        Log:write('=========='..param)
        Http:request('storedata0', server_kemuSubmit, 102, {useCache=false, method = 'post', postData=param})
        Loading:show(rootSprite)
    end
    function doSubmit()
    
        local hegeBtn = Sprite:findChild(rootSprite,'hegeBtn')
        local hege = Sprite:getData(hegeBtn)
        if hege == '' then
            Dialog:show("提示", '请明确评审结果', "ok")
            return
        end
        
        local param
        local param1 = 'user_id='..userId..'&taskId='..taskId..'&subjectId='..kemuId..'&state=1'
        local param2 = ''
        local quanju1 = {"start_pointEdit","end_pointEdit","distanceEdit"}
        local quanju2={"startpoint","endpoint","distance"}
        for i=1,#quanju1 do
            spt=Sprite:findChild(rootSprite, quanju1[i])
            txt=Sprite:getText(spt)
            param2 = param2..'&'..quanju2[i]..'='..txt
        end
        local hegeBtn = Sprite:findChild(rootSprite,'hegeBtn')
        local hege = Sprite:getData(hegeBtn)
        local beizhuEdit = Sprite:findChild(rootSprite,'beizhuEdit')
        local beizhu = Sprite:getText(beizhuEdit)
        if beizhu == '请输入备注信息' then
            beizhu = ''
        end
        local param3 = '&supervisionresult='..hege..'&remark='..beizhu
        param = param1..param2..param3..'&imageAddr='..allimg..'&imageExplain='..'&longitude='..longitude..'&latitude='..latitude..'&locatdetail='..locatdetail
        Log:write('=========='..param)
        Http:request('storedata0', server_kemuSubmit, 103, {useCache=false, method = 'post', postData=param})
        Loading:show(rootSprite)
    end
    
    -------------暂存和提交功能区-------结束----
    
    -------------查询列表功能区-------开始----
    function chaxunloadListItem(list, item, index)
        Log:write('--------------listitem'..index)
        Sprite:setRect(item, 0, 0, 480, 80)
        Sprite:setProperty(item, 'extendstyle', '1111')
        local Valuedata = chaxunlistdata1["Value"][index]
        Log:write('--------------listitem=='..Valuedata['supervision_time'])
        local dataLabel = Sprite:findChild(item, 'dataLabel')
        local approveLabel = Sprite:findChild(item, 'approveLabel')
        local submitLabel = Sprite:findChild(item, 'submitLabel')
        local dataLabel_s = Sprite:findChild(item, 'dataLabel_s')
        local approveLabel_s = Sprite:findChild(item, 'approveLabel_s')
        local submitLabel_s = Sprite:findChild(item, 'submitLabel_s')
        Log:write('--------------listitem=='..Valuedata['supervision_time'])
        local date = Split(Valuedata['supervision_time'],'-')
        local date2 = Split(date[3],' ')
        Log:write('--------------listitem=='..date[3]..'===')
        Log:write('--------------listitem=='..index..'==='..Valuedata['supervision_time'])
        Sprite:setProperty(dataLabel, 'text', date[1]..'年'..date[2]..'月'..date2[1]..'日')
        Sprite:setProperty(dataLabel_s, 'text', date[1]..'年'..date[2]..'月'..date2[1]..'日')
        
        local kemuitemBtn = Sprite:findChild(item, 'kemuitemBtn')
        Sprite:setProperty(kemuitemBtn, 'data', Valuedata['supervision_result_id'])
        
        Log:write('======'..Valuedata['supervision_result'])
        if Valuedata['supervision_result']=='0' then
            Sprite:setProperty(approveLabel, 'text', '合格')
            Sprite:setProperty(approveLabel_s, 'text', '合格 ')
        elseif Valuedata['supervision_result']=='1' then
            Sprite:setProperty(approveLabel, 'text', '不合格')
            Sprite:setProperty(approveLabel_s, 'text', '不合格 ')
        end
        
        if Valuedata['state']=='0' then
            Sprite:setProperty(submitLabel, 'text', '未提交')
            Sprite:setProperty(submitLabel_s, 'text', '未提交 ')
        elseif Valuedata['state']=='1' then
            Sprite:setProperty(submitLabel, 'text', '提交')
            Sprite:setProperty(submitLabel_s, 'text', '提交 ')
        end
    end
    -------------查询列表功能区-------结束----
        -------------查询详情功能区-------开始----
    function chaxundetailSelected(sprite)
        leftright = false
        local leftbarImg = Sprite:findChild(rootSprite, 'leftbarImg')
        local rightbarImg = Sprite:findChild(rootSprite, 'rightbarImg')
        Sprite:setProperty(leftbarImg, 'src', 'file://png/jccl_bt_bg02.png')
        Sprite:setProperty(rightbarImg, 'src', 'file://png/jccl_bt_bg01.png')
        local leftbarLabel = Sprite:findChild(rootSprite, 'leftbarLabel')
        local rightbarLabel = Sprite:findChild(rootSprite, 'rightbarLabel')
        
        local lurujianImg = Sprite:findChild(rootSprite, 'lurujianImg')
        Sprite:setProperty(lurujianImg, 'visible', 'false')
        local chaxunjianImg = Sprite:findChild(rootSprite, 'chaxunjianImg')
        Sprite:setProperty(chaxunjianImg, 'visible', 'true')
        
        local luruNode = Sprite:findChild(rootSprite, 'luruNode')
        Sprite:setProperty(luruNode, 'enable', 'true')
        Sprite:setProperty(luruNode, 'visible', 'true')
        local chaxunNode = Sprite:findChild(rootSprite, 'chaxunNode')
        Sprite:setProperty(chaxunNode, 'enable', 'false')
        Sprite:setProperty(chaxunNode, 'visible', 'false')
        
        Sprite:setProperty(leftbarLabel, 'color', '#ffffff')
        Sprite:setProperty(rightbarLabel, 'color', '#000000')
        
        local supervisionresultId = Sprite:getData(sprite)
        local server_chaxundetail1 = server_chaxundetail..'supervisionresultId='..supervisionresultId
        Log:write('111111111111111:', server_chaxundetail1)
        Http:request('chaxundetaildata0', server_chaxundetail1, 111, {useCache=false})
        Loading:show(rootSprite)
    end
    
    function initPage3()
        local Valuedata = chaxundetaildata1["Value"][0]
        
        allimg = ''
        local nms = {"start_pointEdit","end_pointEdit","distanceEdit","beizhuEdit"}
        local spt=Sprite:findChild(rootSprite, "start_pointEdit")
        Sprite:setProperty(spt, 'text', Valuedata["start_point"])
        Sprite:setProperty(spt, 'color', '#0')
        spt=Sprite:findChild(rootSprite, "end_pointEdit")
        Sprite:setProperty(spt, 'text', Valuedata["end_point"])
        Sprite:setProperty(spt, 'color', '#0')
        spt=Sprite:findChild(rootSprite, "distanceEdit")
        Sprite:setProperty(spt, 'text', Valuedata["distance"])
        Sprite:setProperty(spt, 'color', '#0')
        spt=Sprite:findChild(rootSprite, "beizhuEdit")
        Sprite:setProperty(spt, 'text', Valuedata["remark"])
        Sprite:setProperty(spt, 'color', '#0')
        
        local buhegeImg = Sprite:findChild(rootSprite,'buhegeImg')
        local hegeImg = Sprite:findChild(rootSprite,'hegeImg')
        local hegedata = Valuedata["supervision_result"]
        if hegedata=='0' then
            Sprite:setProperty(buhegeImg, 'src', 'file://png/login_checkbox.png')
            Sprite:setProperty(hegeImg, 'src', 'file://png/login_check.png')
            else
            Sprite:setProperty(buhegeImg, 'src', 'file://png/login_check.png')
            Sprite:setProperty(hegeImg, 'src', 'file://png/login_checkbox.png')          
        end
        
        allimg = ''
        local pic
        for key, value in pairs(imgdata) do
            pic = Sprite:findChild(rootSprite, key)
            Sprite:setProperty(pic, "normal", '')
            Sprite:setProperty(pic, 'visible', 'false')
            Sprite:setProperty(pic, 'enable', 'false')
        end
        imgdata={pic1='',pic2='',pic3=''}
        local zhedangBtn = Sprite:findChild(rootSprite,'zhedangBtn')
        Sprite:setProperty(zhedangBtn, 'enable', 'true')
    end

    function resetListViewItemHeight()
        local cankaobiaozhuntext = Sprite:findChild(rootSprite, 'cankaobiaozhuntext')
        local item = Sprite:getParent(cankaobiaozhuntext)
        local x,y,w = Sprite:getRect(item)
        local _,_,_,th = Sprite:getRect(cankaobiaozhuntext)
        local height = th
        Sprite:setRect(item, x,y,w,height)
        ListView:setItemToTop(Sprite:getParent(item), 0)
        ListView:adjust(Sprite:getParent(item))
    end
    -------------查询详情功能区-------结束----

    

    

]]>
</root>
